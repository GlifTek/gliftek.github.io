'use strict';(function(){var LIST_NONE='<none>';var _pGlob={};_pGlob.objCache={};_pGlob.fadeAnnotations=!0;_pGlob.pickedObject='';_pGlob.hoveredObject='';_pGlob.mediaElements={};_pGlob.loadedFile='';_pGlob.states=[];_pGlob.percentage=0;_pGlob.openedFile='';_pGlob.xrSessionAcquired=!1;_pGlob.xrSessionCallbacks=[];_pGlob.screenCoords=new v3d.Vector2();_pGlob.intervalTimers={};_pGlob.AXIS_X=new v3d.Vector3(1,0,0);_pGlob.AXIS_Y=new v3d.Vector3(0,1,0);_pGlob.AXIS_Z=new v3d.Vector3(0,0,1);_pGlob.MIN_DRAG_SCALE=10e-4;_pGlob.SET_OBJ_ROT_EPS=1e-8;_pGlob.vec2Tmp=new v3d.Vector2();_pGlob.vec2Tmp2=new v3d.Vector2();_pGlob.vec3Tmp=new v3d.Vector3();_pGlob.vec3Tmp2=new v3d.Vector3();_pGlob.vec3Tmp3=new v3d.Vector3();_pGlob.vec3Tmp4=new v3d.Vector3();_pGlob.eulerTmp=new v3d.Euler();_pGlob.eulerTmp2=new v3d.Euler();_pGlob.quatTmp=new v3d.Quaternion();_pGlob.quatTmp2=new v3d.Quaternion();_pGlob.colorTmp=new v3d.Color();_pGlob.mat4Tmp=new v3d.Matrix4();_pGlob.planeTmp=new v3d.Plane();_pGlob.raycasterTmp=new v3d.Raycaster();var PL=v3d.PL=v3d.PL||{};v3d.puzzles=PL;PL.procedures=PL.procedures||{};PL.execInitPuzzles=function(options){var appInstance=null;var app=null;var _initGlob={};_initGlob.percentage=0;_initGlob.output={initOptions:{fadeAnnotations:!0,useBkgTransp:!1,preserveDrawBuf:!1,useCompAssets:!1,useFullscreen:!0,useCustomPreloader:!1,preloaderStartCb:function(){},preloaderProgressCb:function(){},preloaderEndCb:function(){},}}
_initGlob.container=options!==undefined&&'container' in options?options.container:"";var PROC={};_initGlob.output.initOptions.fadeAnnotations=!0;_initGlob.output.initOptions.useBkgTransp=!1;_initGlob.output.initOptions.preserveDrawBuf=!1;_initGlob.output.initOptions.useCompAssets=!1;_initGlob.output.initOptions.useFullscreen=!0;return _initGlob.output}
PL.init=function(appInstance,initOptions){var app=appInstance;initOptions=initOptions||{};if('fadeAnnotations' in initOptions){_pGlob.fadeAnnotations=initOptions.fadeAnnotations}
this.procedures.SWITCH_FLARE=SWITCH_FLARE;this.procedures.MAIN=MAIN;this.procedures.LENS_FLARES_PROCEDURES=LENS_FLARES_PROCEDURES;this.procedures.FADE_IN=FADE_IN;this.procedures.SWITCH_FLARE_FADE=SWITCH_FLARE_FADE;this.procedures.LENS_FLARE_DELUXE_1=LENS_FLARE_DELUXE_1;this.procedures.INIT_RAYS_SETTINGS_1=INIT_RAYS_SETTINGS_1;this.procedures.INIT_BOKEH_SETTINGS_1=INIT_BOKEH_SETTINGS_1;this.procedures.SET_VARIABLES=SET_VARIABLES;this.procedures.SET_CAM_AND_LIGHT=SET_CAM_AND_LIGHT;this.procedures.INIT_GLOW_SETTINGS_1=INIT_GLOW_SETTINGS_1;this.procedures.CAMERA_CONSTRAINTS=CAMERA_CONSTRAINTS;this.procedures.CHANGE_BG_AND_FLARE=CHANGE_BG_AND_FLARE;this.procedures.CLICK_NEXT_BUTTON=CLICK_NEXT_BUTTON;this.procedures.DISABLE_RENDERING=DISABLE_RENDERING;this.procedures.LENS_FLARE_DELUXE_2=LENS_FLARE_DELUXE_2;this.procedures.INIT_RAYS_SETTINGS_2=INIT_RAYS_SETTINGS_2;this.procedures.INIT_BOKEH_SETTINGS_2=INIT_BOKEH_SETTINGS_2;this.procedures.INIT_GLOW_SETTINGS_2=INIT_GLOW_SETTINGS_2;this.procedures.LENS_FLARE_DELUXE_3=LENS_FLARE_DELUXE_3;this.procedures.INIT_RAYS_SETTINGS_3=INIT_RAYS_SETTINGS_3;this.procedures.INIT_BOKEH_SETTINGS_3=INIT_BOKEH_SETTINGS_3;this.procedures.INIT_GLOW_SETTINGS_3=INIT_GLOW_SETTINGS_3;var PROC={"SWITCH_FLARE":SWITCH_FLARE,"MAIN":MAIN,"LENS_FLARES_PROCEDURES":LENS_FLARES_PROCEDURES,"FADE_IN":FADE_IN,"SWITCH_FLARE_FADE":SWITCH_FLARE_FADE,"LENS_FLARE_DELUXE_1":LENS_FLARE_DELUXE_1,"INIT_RAYS_SETTINGS_1":INIT_RAYS_SETTINGS_1,"INIT_BOKEH_SETTINGS_1":INIT_BOKEH_SETTINGS_1,"SET_VARIABLES":SET_VARIABLES,"SET_CAM_AND_LIGHT":SET_CAM_AND_LIGHT,"INIT_GLOW_SETTINGS_1":INIT_GLOW_SETTINGS_1,"CAMERA_CONSTRAINTS":CAMERA_CONSTRAINTS,"CHANGE_BG_AND_FLARE":CHANGE_BG_AND_FLARE,"CLICK_NEXT_BUTTON":CLICK_NEXT_BUTTON,"DISABLE_RENDERING":DISABLE_RENDERING,"LENS_FLARE_DELUXE_2":LENS_FLARE_DELUXE_2,"INIT_RAYS_SETTINGS_2":INIT_RAYS_SETTINGS_2,"INIT_BOKEH_SETTINGS_2":INIT_BOKEH_SETTINGS_2,"INIT_GLOW_SETTINGS_2":INIT_GLOW_SETTINGS_2,"LENS_FLARE_DELUXE_3":LENS_FLARE_DELUXE_3,"INIT_RAYS_SETTINGS_3":INIT_RAYS_SETTINGS_3,"INIT_BOKEH_SETTINGS_3":INIT_BOKEH_SETTINGS_3,"INIT_GLOW_SETTINGS_3":INIT_GLOW_SETTINGS_3,};var lens_flare_counter,RAYS_01,BOKEH_01,GLOW_01,RAYS_2,BOKEH_2,GLOW_2,RAYS_3,BOKEH_3,GLOW_3,LIST_bg_images,center_alpha_distance_02;function SWITCH_FLARE(){lens_flare_counter=(typeof lens_flare_counter=='number'?lens_flare_counter:0)+1;if(lens_flare_counter<=3){console.log('lens_flare_counter: '+String(lens_flare_counter));SWITCH_FLARE_FADE()}else if(lens_flare_counter>3){lens_flare_counter=1;console.log('lens_flare_counter reset to: '+String(lens_flare_counter));SWITCH_FLARE_FADE()}}
function setScreenScale(factor){if(!appInstance.useHiDPIRenderPass)
appInstance.renderer.setPixelRatio(factor);if(appInstance.postprocessing)
appInstance.postprocessing.composer.setPixelRatio(factor);appInstance.onResize()}
function MAIN(){setScreenScale(1.5);FADE_IN();SET_VARIABLES();SET_CAM_AND_LIGHT();CAMERA_CONSTRAINTS();CLICK_NEXT_BUTTON();LENS_FLARES_PROCEDURES();DISABLE_RENDERING()}
function setImageBackground(){return(function(imageURLInput,){mainFunction();function mainFunction(){let bgTexture=new THREE.TextureLoader().load(imageURLInput);bgTexture.minFilter=THREE.LinearFilter;app.scene.background=bgTexture;app.scene.background.encoding=THREE.sRGBEncoding}}).apply(null,arguments)}
function LENS_FLARES_PROCEDURES(){setImageBackground('./img/bg_clouds_pink_purple.jpg',)
INIT_RAYS_SETTINGS_1();INIT_GLOW_SETTINGS_1();INIT_BOKEH_SETTINGS_1();INIT_RAYS_SETTINGS_2();INIT_GLOW_SETTINGS_2();INIT_BOKEH_SETTINGS_2();INIT_RAYS_SETTINGS_3();INIT_GLOW_SETTINGS_3();INIT_BOKEH_SETTINGS_3();LENS_FLARE_DELUXE_1()}
function screenFade(){return(function(screenFade_ID_Input,screenFade_Z_Index_Input,typeDropdown,screenFade_Pause_Input,screenFade_Duration_Input,colorInput_1_PICKER,colorInput_1_TEXT,delete_When_Done_Checkbox,whenDone_Statement_Input,){const puzzleName='Print To Modal Card';eval(`window.${screenFade_ID_Input} = { faded: null };`);if(!screenFade_ID_Input){console.log('[ GLIFTEK ]: The',puzzleName,'plugin puzzle is missing an input!')}else{mainFunction()};function mainFunction(){function setColorFromInputs(colorInput_TEXT,colorInput_PICKER){let colorInput_esc;if(typeof colorInput_TEXT=='undefined'||typeof colorInput_TEXT==null||colorInput_TEXT==''){colorInput_esc=colorInput_PICKER;console.log(colorInput_PICKER,'supplied. using PICKER.')}else{colorInput_esc=colorInput_TEXT;console.log(colorInput_TEXT,'supplied. using TEXT.')}
return colorInput_esc};const colorInput_1esc=setColorFromInputs(colorInput_1_TEXT,colorInput_1_PICKER);console.log('colorInput_1esc:',colorInput_1esc);let computedColorDiv=document.createElement("div");computedColorDiv.id='computedColorDiv-'+screenFade_ID_Input;document.body.appendChild(computedColorDiv);function RGBA_from_color_input(color,alpha){if(color=='transparent'||color==null||typeof color=='undefined'){return'rgba(0, 0, 0, 0)'}else{computedColorDiv.style.color=color;let computedColor=window.getComputedStyle(computedColorDiv).color;console.log('computedColor for: ',color,':',computedColor);let len=computedColor.length;let computedColor_RGBA='rgba('+computedColor.substring(4,len-1)+", "+alpha+')';console.log('computedColor_RGBA for: ',color,':',computedColor_RGBA);return computedColor_RGBA}};const screenFadeColor=RGBA_from_color_input(colorInput_1esc,1);console.log('screenFadeColor: ',screenFadeColor);computedColorDiv.remove();let styleVar=setstyleVar();let style=document.createElement('style');style.id='screenFade-'+screenFade_ID_Input;style.innerHTML=styleVar;document.head.appendChild(style);let screenFade_Div=document.createElement('div');screenFade_Div.id=screenFade_ID_Input;screenFade_Div.className='screenFade-'+screenFade_ID_Input;getBGcolor();function getBGcolor(){if(typeDropdown=='in'){screenFade_Div.style.backgroundColor='rgba(0,0,0,0)';console.log('screenFade_Div.style.backgroundColor:',screenFade_Div.style.backgroundColor)}else if(typeDropdown=='out'){screenFade_Div.style.backgroundColor=screenFadeColor;console.log('screenFade_Div.style.backgroundColor:',screenFade_Div.style.backgroundColor)}}
const container=document.getElementById('v3d-container');container.appendChild(screenFade_Div);setTimeout(function(){animateScreenFade()},(screenFade_Pause_Input*1000));function animateScreenFade(){const animationType='animation-screen-fade-'+typeDropdown+'-'+screenFade_ID_Input;screenFade_Div.style.animationName=animationType;console.log('screenFade_Div.style.animationName:',screenFade_Div.style.animationName);screenFade_Div.addEventListener('animationend',function(event){if(event.animationName==animationType);{screenFade_Div.removeEventListener('animationend',null);screenFadeDisplay();let screenFadeState=eval(`${screenFade_ID_Input}.faded = '${typeDropdown}';`);console.log('screenFadeState:',screenFadeState);whenDone_Statement_Input()}});function screenFadeDisplay(){if(typeDropdown=='in'){screenFade_Div.style.display='block';console.log('screenFade_Div.style.display:',screenFade_Div.style.display);deleteWhenDone()}else if(typeDropdown=='out'){screenFade_Div.style.display='none';console.log('screenFade_Div.style.display:',screenFade_Div.style.display);deleteWhenDone()}}
function deleteWhenDone(){if(delete_When_Done_Checkbox==!0){screenFade_Div.remove()}}};function setstyleVar(){let result=`
#computedColorDiv-${screenFade_ID_Input}{height: 0px;width: 0px;display: none;z-index = -10;}.screenFade-${screenFade_ID_Input}{display: block;position: fixed;z-index: ${screenFade_Z_Index_Input};left: 0;top: 0;height: 100%;width: 100%;overflow: hidden;pointer-events: none;animation-duration:${screenFade_Duration_Input}s;animation-timing-function: ease-in-out;}@keyframes animation-screen-fade-in-${screenFade_ID_Input}{from{background-color: rgba(0,0,0,0);}to{background-color: ${screenFadeColor};}}@keyframes animation-screen-fade-out-${screenFade_ID_Input}{from {background-color: ${screenFadeColor};}to{background-color: rgba(0,0,0,0);}}`;return result}}}).apply(null,arguments)}
function FADE_IN(){screenFade('screenFade_1',10,'out',1.5,1,'#000000','',!0,function(){},)}
function enableRendering(){appInstance.enableRendering()}
function disableRendering(enableSSAA){appInstance.ssaaOnPause=enableSSAA;appInstance.disableRendering(1)}
function SWITCH_FLARE_FADE(){screenFade('screenFade_2',10,'in',0,0.25,'#000000','',!0,function(){enableRendering();CHANGE_BG_AND_FLARE();screenFade('screenFade_3',10,'out',0.5,0.25,'#000000','',!0,function(){disableRendering(!0)},)},)}
function createLenseFlareFunction(){return(function(nameInput,objInput,activeCheckboxRAYS,flareSettingsRAYS,flareMasterSizeRAYS,flareMasterOpacityRAYS,activeCheckboxGLOW,flareSettingsGLOW,flareMasterSizeGLOW,flareMasterOpacityGLOW,activeCheckboxBOKEH,flareSettingsBOKEH,flareMasterSizeBOKEH,flareMasterOpacityBOKEH,flareMasterSize,flareMasterOpacity){const puzzleName="Lense Flare Deluxe";let readyToAddRAYS=!1,readyToAddGLOW=!1,readyToAddBOKEH=!1;const LIST_flareArgsRAYS=["rays","symmetrical","rayWidth","raySharpness","randomSeed","rotate","feBlur","opacity"],LIST_flareArgsGLOW=["toneCenter","toneInner","toneMid","toneOuter","toneEdge","rotate","feBlur","opacity"],LIST_flareArgsBOKEH=["shape","color","vert","rotate","feBlur","opacity"],varToString=e=>Object.keys(e)[0],renderer=app.renderer;renderer.outputEncoding=THREE.sRGBEncoding,renderer.antialias=!0;const scene=app.scene,camera=app.camera;let textureLoader=new THREE.TextureLoader,clock=new THREE.Clock,LIST_lensFlareRAYS=[];LIST_lensFlareRAYS.name="LIST_lensFlareRAYS";let LIST_lensFlareGLOW=[];LIST_lensFlareGLOW.name="LIST_lensFlareGLOW";let LIST_lensFlareBOKEH=[];LIST_lensFlareBOKEH.name="LIST_lensFlareBOKEH";let LIST_lensFlareALL=[LIST_lensFlareRAYS,LIST_lensFlareGLOW,LIST_lensFlareBOKEH],lensflare,light,selectedLight,MAP_LF_Bokeh_Polygons=new Map,BOKEH_line,BOKEH_circle,BOKEH_ellipse,BOKEH_triangle,BOKEH_square,BOKEH_pentagon,BOKEH_hexagon,BOKEH_heptagon,BOKEH_octagon,BOKEH_nonagon;function mainFunction(){function checkboxFALSEcheck(){0==activeCheckboxRAYS&&0==activeCheckboxGLOW&&0==activeCheckboxBOKEH?console.log("[ GLIFTEK ] Plugins: Lens Flare Deluxe all settings disabled."):function(){0==activeCheckboxRAYS&&(readyToAddRAYS=!0);!function(){0==activeCheckboxGLOW&&(readyToAddGLOW=!0);!function(){0==activeCheckboxBOKEH&&(readyToAddBOKEH=!0);init()}()}()}()}function init(){loadAllLensFlareTextures(),promiseFunctionOBJ(objInput,function(e){light=scene.getObjectByName(e),checkboxTRUEcheck(),waitToAddAllFlares()})}function checkboxTRUEcheck(){if(1==activeCheckboxRAYS)if(flareSettingsRAYS)arrayCheck(flareSettingsRAYS);else{console.log("[ GLIFTEK ]: Lens Flare Deluxe Rays settings missing. Using default settings."),(flareSettingsRAYS=[]).name="flareSettingsRAYS";const e=new Map([["type","RAYS"],["shape","RAYS"],["rays",12],["nameInput","default_rays_01"],["symmetrical",!1],["rayWidth",1],["raySharpness",.9],["randomSeed",10],["rotate",0],["feBlur",.2],["opacity",.9],["size",500],["distance",0],["color","teal"]]),t=new Map([["type","RAYS"],["shape","RAYS"],["rays",6],["nameInput","default_rays_01"],["symmetrical",!0],["rayWidth",1],["raySharpness",.9],["randomSeed",0],["rotate",0],["feBlur",.1],["opacity",.98],["size",600],["distance",0],["color","cyan"]]);flareSettingsRAYS.push(e),flareSettingsRAYS.push(t),makeFlares(flareSettingsRAYS)}if(1==activeCheckboxGLOW)if(flareSettingsGLOW)arrayCheck(flareSettingsGLOW);else{console.log("[ GLIFTEK ]: Lens Flare Deluxe Glow settings missing. Using default settings."),(flareSettingsGLOW=[]).name="flareSettingsGLOW";const e=new Map([["type","GLOW"],["shape","GLOW_circle"],["toneCenter",0],["toneInner",.2],["toneMid",.3],["toneOuter",.99],["toneEdge",1],["rotate",0],["feBlur",0],["opacity",.6],["size",300],["distance",1e-4],["color","darkorange"]]),t=new Map([["type","GLOW"],["shape","GLOW_circle"],["toneCenter",0],["toneInner",.1],["toneMid",.2],["toneOuter",.99],["toneEdge",1],["rotate",0],["feBlur",0],["opacity",.5],["size",700],["distance",0],["color","yellow"]]);flareSettingsGLOW.push(e),flareSettingsGLOW.push(t),makeFlares(flareSettingsGLOW)}if(1==activeCheckboxBOKEH)if(flareSettingsBOKEH)arrayCheck(flareSettingsBOKEH);else{console.log("[ GLIFTEK ]: Lens Flare Deluxe Bokeh settings missing. Using default settings."),(flareSettingsBOKEH=[]).name="flareSettingsBOKEH";const e=new Map([["type","BOKEH"],["shape","BOKEH_hexagon"],["vert",0],["rotate",0],["feBlur",.2],["opacity",.6],["size",1],["distance",.9],["color","cyan"]]),t=new Map([["type","BOKEH"],["shape","BOKEH_hexagon"],["vert",2],["rotate",0],["feBlur",.2],["opacity",.6],["size",1],["distance",0],["color","cyan"]]);flareSettingsBOKEH.push(e),flareSettingsBOKEH.push(t),makeFlares(flareSettingsBOKEH)}}function arrayCheck(e){if(Array.isArray(e))Array.isArray(e)&&(e.name="flareSettings"+e[0].get("type"),makeFlares(e));else{const t=[];t.name="flareSettings"+e.get("type"),t.push(e),console.log("settings:",t),makeFlares(t)}}function svgUriEncode(e){let t=encodeURIComponent(" <svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' "+e+"</svg>");return"data:image/svg+xml,".concat(t)}function makeFlares(flareSettings){let textureFlare,flareSettingsIterations=flareSettings.length;for(let i=0;i<flareSettingsIterations;i++){const item=flareSettings[i],itemType=item.get("type"),itemDistance=item.get("distance");let args,flareArgsRAYS=[],flareArgsGLOW=[],flareArgsBOKEH=[];function makeArgsList(e,t){return e.forEach(e=>t.push(item.get(e))),t}function flareCaseFunction(flareType){makeFlareElement(makeTextureFlare(makeArgsList(eval(`LIST_flareArgs${flareType}`),eval(`flareArgs${flareType}`))),eval(`flareMasterSize${flareType}`)*flareMasterSize,itemDistance,ifLastSettingsIteration)}switch(itemType){case"RAYS":case"GLOW":flareCaseFunction(itemType);break;case"BOKEH":const e=[60,70,120,70];let t;t=0!==itemDistance?[.6*itemDistance,.7*itemDistance,.9*itemDistance,2*itemDistance]:[.6,.7,.9,2];const a=e.length;for(let l=0;l<a;l++)makeFlareElement(makeTextureFlare(makeArgsList(LIST_flareArgsBOKEH,flareArgsBOKEH)),e[l]*flareMasterSizeBOKEH*flareMasterSize*1.5,t[l],ifLastSettingsIteration,l)}function makeTextureFlare(args){let shapeOrType;shapeOrType="BOKEH"==itemType?"type":"shape";const svgCodeName="svgCode_"+item.get(shapeOrType);console.log("svgCodeName, args",svgCodeName,...args);const svgData=eval(svgCodeName)(...args),textureFlare=textureLoader.load(svgData);return textureFlare.name="textureFlare"+itemType+"_"+i,textureFlare}function makeFlareElement(textureFlare,sizeMultiplier,itemDistance,callback,iteration){const flareColor=new THREE.Color(item.get("color")),newFlare=new THREE.LensflareElement(textureFlare,item.get("size")*sizeMultiplier,itemDistance,flareColor);"BOKEH"!==itemType&&(iteration=i),newFlare.name="lensFlare"+itemType+"_"+iteration;let list="LIST_lensFlare"+itemType;eval(list).push(newFlare),callback(itemType)}function ifLastSettingsIteration(){i+1==flareSettingsIterations&&readyToAddFunc(itemType)}function readyToAddFunc(e){switch(e){case"RAYS":readyToAddRAYS=!0;break;case"GLOW":readyToAddGLOW=!0;break;case"BOKEH":readyToAddBOKEH=!0}}}}function createLensFlareObject(){(lensflare=new THREE.Lensflare).name=nameInput,light.add(lensflare)}function waitToAddAllFlares(){createLensFlareObject();var e=setInterval(()=>{1==readyToAddRAYS&&1==readyToAddGLOW&&1==readyToAddBOKEH&&(clearInterval(e),function(){function e(){1==activeCheckboxGLOW?addLensFlareElementsToLensFlareObject(LIST_lensFlareGLOW,t):t()}function t(){1==activeCheckboxBOKEH?addLensFlareElementsToLensFlareObject(LIST_lensFlareBOKEH,done):done()}1==activeCheckboxRAYS?addLensFlareElementsToLensFlareObject(LIST_lensFlareRAYS,e):e()}())},100)}function addLensFlareElementsToLensFlareObject(e,t){for(let a=0;a<e.length;a++){let l=e[a];lensflare.addElement(l),console.log("lensflare",lensflare),a==e.length-1&&t()}}function done(){}function svgCode_RAYS(e,t,a,l,n,o,r,i){0!==n&&(n>10||n<1)&&(console.log('[ GLIFTEK ]: Lens Flare Rays Settings puzzle "random ray lengths" input must be between 1 and 10. Set to 0 to disable. Setting to 0.'),alert('[ GLIFTEK ]: Lens Flare Rays Settings puzzle "random ray lengths" input must be between 1 and 10. Set to 0 to disable. Setting to 0'));let s="",c="";function f(t){return`<g transform=\n            'rotate(${360/e*t},300,300)'>\n            <use \n            class='rayUse' \n            xlink:href='#raySymbol'\t\t\t\t\n            transform='scale(${function(e){if(0==e)return 1;if(e>10||e<1)return 1;return.1*(Math.floor(Math.random()*e)+1)}(n)},${a})'/>\n            </g>`}if(1==t){c="",e%2!=0&&(e++,console.log('[ GLIFTEK ] Lens Flare Rays Settings: Only an even number of rays can be symmetrical. Changing "ray count" up to: ',e));for(let t=0;t<e/2;t++)s+=f(t)}else if(0==t){c="mask:url(#mask)";for(let t=0;t<e;t++)s+=f(t)}return svgUriEncode(`\n            width='600'\n            height='600' \n            viewBox='0 0 600 600'>\n\n            <style type="text/css"> \n            .rayUse {\n                transform-origin: center;\n            }\n            .rayElipse {\n                mix-blend-mode:screen;\n                fill:url(#radial-gradient);\n            }\n            </style>\n\n                <defs>\n\n                    <mask id="mask"> \n                        <rect x='0' y='285' width='300' height='30' fill='#ffffff' /> \n                    </mask>\n\n                    <radialGradient id='radial-gradient' \n\n                        cx='300' \n                        cy='300' \n                        r='150'\n\n                        gradientTransform='translate(-300 290.9) scale(2 0.03)' gradientUnits='userSpaceOnUse'\n                        >\n                        \n                        <stop offset='0.15' \n                        stop-color='#fff' \n                        stop-opacity='1'\n                        />\n\n                        <stop offset='${1-.1*l}' \n                        stop-color='#fff' \n                        stop-opacity='0'\n                        />\n\n                    </radialGradient>\n                \n                    <filter id='blur' x='-.1' y='-.1' >\n                    <feGaussianBlur in='SourceGraphic' stdDeviation='${r}' />\n                    </filter>\n                </defs>\n                <g style="isolation:isolate">\n                    <symbol id='raySymbol' viewBox='0 0 600 600' >\n                        <g style='${c}' \n                        transform='\n                        translate(0,0)\n                        '>\n                            <ellipse class='rayElipse' cx='300' cy='300' rx='300' ry='5' />\n                        </g>\n                    </symbol>\n                </g>\n                \n                <g ${`transform='rotate(${o},300,300)' opacity='${i*flareMasterOpacityRAYS*flareMasterOpacity}' filter='url(#blur)'`}> ${s} </g>\n            \n        `)}function svgCode_GLOW_hexagon(e,t,a,l,n,o,r,i){let s=svgUriEncode(`\n\n        width='100'\n        height='100'\n        viewBox='-10 -10 110 110'>\n\n        <defs>\n        <filter id='blur' x='-.1' y='-.1' >\n        <feGaussianBlur in='SourceGraphic' stdDeviation='${r}' />\n        </filter>\n        </defs>\n        ${BOKEH_hexagon}\n        \n        id='glow' \n        style='fill:gray'\n        filter='url(#blur)' \n        transform='rotate(${o},50,50)'\n        opacity='${i*flareMasterOpacityGLOW*flareMasterOpacity}'\t\t\n        />\n\n        <g > <use xlink:href='#glow' /> </g>\n            \n        `);return console.log("result from svgCode_GLOW_hexagon: ",s),s}function svgCode_GLOW_circle(e,t,a,l,n,o,r,i){return svgUriEncode(`\n\n        width='100'\n        height='100'\n        viewBox='0 0 100 100'>\n\n        <defs>\n        <radialGradient id='radial-gradient' cx='50' cy='50' r='50' gradientUnits='userSpaceOnUse'>\n\n        <stop offset='${e}' style='stop-color: #000; stop-opacity: 0'/>\n        <stop offset='${t}' style='stop-color: #fff; stop-opacity: .5'/>\n        <stop offset='${a}' style='stop-color: #fff; stop-opacity: 1'/>\n        <stop offset='${l}' style='stop-color: #fff; stop-opacity: .5'/>\n        <stop offset='${n}' style='stop-color: #fff; stop-opacity: 0'/>\n\n        </radialGradient>\n\n        <g style='isolation:isolate'>\n\n            <g id='glow'>\n\n                <circle cx='50' cy='50' r='50' style='mix-blend-mode:screen;fill:url(#radial-gradient)' />\n\n            </g>\n\n        </g>\n\n        </defs>\n        <g > ${`<use xlink:href='#glow' opacity='${i*flareMasterOpacityGLOW}'/>`} </g>\n            \n        `)}function svgCode_GLOW_ellipse(e,t,a,l,n,o,r,i){return svgUriEncode(`\n\n        width='100'\n        height='100'\n        viewBox='0 0 100 100'>\n\n        <defs>\n        <radialGradient id='radial-gradient' cx='50' cy='50' r='50' gradientUnits='userSpaceOnUse'>\n\n        <stop offset='${e}' style='stop-color: #000; stop-opacity: 0'/>\n        <stop offset='${t}' style='stop-color: #fff; stop-opacity: .5'/>\n        <stop offset='${a}' style='stop-color: #fff; stop-opacity: 1'/>\n        <stop offset='${l}' style='stop-color: #fff; stop-opacity: .5'/>\n        <stop offset='${n}' style='stop-color: #fff; stop-opacity: 0'/>\n\n        </radialGradient>\n\n        <g style='isolation:isolate'>\n\n            <g id='glow'>\n\n                <ellipse cx='50' cy='50' rx='50' ry='25' style='mix-blend-mode:screen;fill:url(#radial-gradient)' />\n\n            </g>\n\n        </g>\n\n        </defs>\n        <g > ${`<use xlink:href='#glow' opacity='${i*flareMasterOpacityGLOW}'/>`} </g>\n            \n        `)}function svgCode_GLOW_square(e,t,a,l,n,o,r,i){return svgUriEncode(`\n\n        width='100'\n        height='100'\n        viewBox='0 0 100 100'>\n\n        <defs>\n        <radialGradient id='radial-gradient' cx='50' cy='50' r='50' gradientUnits='userSpaceOnUse'>\n        \n        <stop offset='${e}' style='stop-color: #000; stop-opacity: 0'/>\n        <stop offset='${t}' style='stop-color: #fff; stop-opacity: .5'/>\n        <stop offset='${a}' style='stop-color: #fff; stop-opacity: 1'/>\n        <stop offset='${l}' style='stop-color: #fff; stop-opacity: .5'/>\n        <stop offset='${n}' style='stop-color: #fff; stop-opacity: 0'/>\n\n        </radialGradient>\n\n        <g style='isolation:isolate'>\n        <g id='glow'>\n\n        <rect cx='50' cy='50' r='50' style='mix-blend-mode:screen;fill:url(#radial-gradient)' />\n\n        </g>\n        </g>\n        </defs>\n        <g > ${`<use xlink:href='#glow' opacity='${i*flareMasterOpacityGLOW*flareMasterOpacity}'/>`} </g>\n            \n        `)}function svgCode_BOKEH(shape,color,vert,rotate,feBlur,opacity){const width=100,height=100,vBminX=0,vBminY=0,vBwidth=100,vBheight=100,translateX=0,translateY=0,scaleX=1,scaleY=1;let result=svgUriEncode(`\n            width='${width}'\n            height='${height}'\n            viewBox='${vBminX} ${vBminY}\n            ${vBwidth} ${vBheight}'>\n            <defs>\n                <filter id="blur" x="-.1" y="-.1" >\n                <feGaussianBlur in='SourceGraphic' stdDeviation='${feBlur}' />\n                </filter>\n            </defs>\n            ${eval(shape)} \n            style='fill:${color}'\n            opacity='\n            ${opacity*flareMasterOpacityBOKEH*flareMasterOpacity}'\n            filter='url(#blur)'\n            transform='\n            translate(${translateX},${translateY})\n            scale(${scaleX},${scaleY})\n            rotate(${rotate},${width/2},${height/2})\n        '/>\n        `);return result}function loadAllLensFlareTextures(){MAP_LF_Bokeh_Polygons.set("line","<line x1='50' y1='20' x2='80' y2='50' style ='stroke:gray;stroke-width:5'"),MAP_LF_Bokeh_Polygons.set("circle","<circle cx='50' cy='50' r='50' "),MAP_LF_Bokeh_Polygons.set("ellipse","<ellipse cx='50' cy='50' rx='50' ry='25' "),MAP_LF_Bokeh_Polygons.set("triangle","<polygon points='50 20 84.64 80 15.36 80 50 20'"),MAP_LF_Bokeh_Polygons.set("square","<rect x='20' y='20' width='60' height='60'"),MAP_LF_Bokeh_Polygons.set("pentagon","<polygon points='50 13.82 88.04 41.46 73.51 86.18 26.49 86.18 11.96 41.46 50 13.82'"),MAP_LF_Bokeh_Polygons.set("hexagon","<polygon points = '50.04 10 84.66 30.04 84.62 70.04 49.96 90 15.34 69.96 15.38 29.96 50.04 10'"),MAP_LF_Bokeh_Polygons.set("heptagon","<polygon points='50 11.98 81.27 27.04 89 60.88 67.36 88.02 32.65 88.02 11 60.88 18.73 27.04 50 11.98'"),MAP_LF_Bokeh_Polygons.set("octagon","<polygon points='65.31 13.04 86.95 34.69 86.95 65.31 65.31 86.95 34.69 86.95 13.04 65.31 13.04 34.69 34.69 13.04 65.31 13.04'"),MAP_LF_Bokeh_Polygons.set("nonagon","<polygon points='50 11.21 75.71 20.56 89.39 44.26 84.64 71.21 63.68 88.79 36.32 88.79 15.36 71.21 10.61 44.26 24.29 20.56 50 11.21'"),BOKEH_line=MAP_LF_Bokeh_Polygons.get("line"),BOKEH_circle=MAP_LF_Bokeh_Polygons.get("circle"),BOKEH_ellipse=MAP_LF_Bokeh_Polygons.get("ellipse"),BOKEH_triangle=MAP_LF_Bokeh_Polygons.get("triangle"),BOKEH_square=MAP_LF_Bokeh_Polygons.get("square"),BOKEH_pentagon=MAP_LF_Bokeh_Polygons.get("pentagon"),BOKEH_hexagon=MAP_LF_Bokeh_Polygons.get("hexagon"),BOKEH_heptagon=MAP_LF_Bokeh_Polygons.get("heptagon"),BOKEH_octagon=MAP_LF_Bokeh_Polygons.get("octagon"),BOKEH_nonagon=MAP_LF_Bokeh_Polygons.get("nonagon")}function lensFlareJS(){!function(){class e extends THREE.Mesh{constructor(){super(e.Geometry,new THREE.MeshBasicMaterial({opacity:0,transparent:!0})),this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;const a=new THREE.Vector3,l=new THREE.Vector3,n=new THREE.DataTexture(new Uint8Array(768),16,16,THREE.RGBFormat);n.minFilter=THREE.NearestFilter,n.magFilter=THREE.NearestFilter,n.wrapS=THREE.ClampToEdgeWrapping,n.wrapT=THREE.ClampToEdgeWrapping;const o=new THREE.DataTexture(new Uint8Array(768),16,16,THREE.RGBFormat);o.minFilter=THREE.NearestFilter,o.magFilter=THREE.NearestFilter,o.wrapS=THREE.ClampToEdgeWrapping,o.wrapT=THREE.ClampToEdgeWrapping;const r=e.Geometry,i=new THREE.RawShaderMaterial({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:"\n\n                    precision highp float;\n\n                    uniform vec3 screenPosition;\n                    uniform vec2 scale;\n\n                    attribute vec3 position;\n\n                    void main() {\n\n                        gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );\n\n                    }",fragmentShader:"\n\n                    precision highp float;\n\n                    void main() {\n\n                        gl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );\n\n                    }",depthTest:!0,depthWrite:!1,transparent:!1}),s=new THREE.RawShaderMaterial({uniforms:{map:{value:n},scale:{value:null},screenPosition:{value:null}},vertexShader:"\n\n                    precision highp float;\n\n                    uniform vec3 screenPosition;\n                    uniform vec2 scale;\n\n                    attribute vec3 position;\n                    attribute vec2 uv;\n\n                    varying vec2 vUV;\n\n                    void main() {\n\n                        vUV = uv;\n\n                        gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );\n\n                    }",fragmentShader:"\n\n                    precision highp float;\n\n                    uniform sampler2D map;\n\n                    varying vec2 vUV;\n\n                    void main() {\n\n                        gl_FragColor = texture2D( map, vUV );\n\n                    }",depthTest:!1,depthWrite:!1,transparent:!1}),c=new THREE.Mesh(r,i),f=[],p=t.Shader,d=new THREE.RawShaderMaterial({uniforms:{map:{value:null},occlusionMap:{value:o},color:{value:new THREE.Color(16777215)},scale:{value:new THREE.Vector2},screenPosition:{value:new THREE.Vector3}},vertexShader:p.vertexShader,fragmentShader:p.fragmentShader,blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1}),g=new THREE.Mesh(r,d);this.addElement=function(e){f.push(e)};const y=new THREE.Vector2,m=new THREE.Vector2,u=new THREE.Box2,h=new THREE.Vector4;this.onBeforeRender=function(e,t,p){e.getCurrentViewport(h);const E=h.w/h.z,k=h.z/2,_=h.w/2;let v=16/h.w;if(y.set(v*E,v),u.min.set(h.x,h.y),u.max.set(h.x+(h.z-16),h.y+(h.w-16)),l.setFromMatrixPosition(this.matrixWorld),l.applyMatrix4(p.matrixWorldInverse),!(l.z>0)&&(a.copy(l).applyMatrix4(p.projectionMatrix),m.x=h.x+a.x*k+k-8,m.y=h.y+a.y*_+_-8,u.containsPoint(m))){e.copyFramebufferToTexture(m,n);let t=i.uniforms;t.scale.value=y,t.screenPosition.value=a,e.renderBufferDirect(p,null,r,i,c,null),e.copyFramebufferToTexture(m,o),(t=s.uniforms).scale.value=y,t.screenPosition.value=a,e.renderBufferDirect(p,null,r,s,c,null);const l=2*-a.x,u=2*-a.y;for(let t=0,n=f.length;t<n;t++){const n=f[t],o=d.uniforms;o.color.value.copy(n.color),o.map.value=n.texture,o.screenPosition.value.x=a.x+l*n.distance,o.screenPosition.value.y=a.y+u*n.distance,v=n.size/h.w;const i=h.w/h.z;o.scale.value.set(v*i,v),d.uniformsNeedUpdate=!0,e.renderBufferDirect(p,null,r,d,g,null)}}},this.dispose=function(){i.dispose(),s.dispose(),d.dispose(),n.dispose(),o.dispose();for(let e=0,t=f.length;e<t;e++)f[e].texture.dispose()}}}e.prototype.isLensflare=!0;class t{constructor(e,t=1,a=0,l=new THREE.Color(16777215)){this.texture=e,this.size=t,this.distance=a,this.color=l}}t.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:"\n\n            precision highp float;\n\n            uniform vec3 screenPosition;\n            uniform vec2 scale;\n\n            uniform sampler2D occlusionMap;\n\n            attribute vec3 position;\n            attribute vec2 uv;\n\n            varying vec2 vUV;\n            varying float vVisibility;\n\n            void main() {\n\n                vUV = uv;\n\n                vec2 pos = position.xy;\n\n                vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\n\n                vVisibility =        visibility.r / 9.0;\n                vVisibility *= 1.0 - visibility.g / 9.0;\n                vVisibility *=       visibility.b / 9.0;\n\n                gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n\n            }",fragmentShader:"\n\n            precision highp float;\n\n            uniform sampler2D map;\n            uniform vec3 color;\n\n            varying vec2 vUV;\n            varying float vVisibility;\n\n            void main() {\n\n                vec4 texture = texture2D( map, vUV );\n                texture.a *= vVisibility;\n                gl_FragColor = texture;\n                gl_FragColor.rgb *= color;\n\n            }"},e.Geometry=function(){const e=new THREE.BufferGeometry,t=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),a=new THREE.InterleavedBuffer(t,5);return e.setIndex([0,1,2,0,2,3]),e.setAttribute("position",new THREE.InterleavedBufferAttribute(a,3,0,!1)),e.setAttribute("uv",new THREE.InterleavedBufferAttribute(a,2,3,!1)),e}(),THREE.Lensflare=e,THREE.LensflareElement=t}()}function promiseFunctionOBJ(e,t){(function(t){var a=Date.now();return new Promise(function l(n,o){console.log("[ GLIFTEK Plugins ]:\n'",puzzleName,"'puzzle is looking for",e),app.scene.getObjectByName(e)?n(app.scene.getObjectByName(e)):t&&Date.now()-a>=t?(o(new Error("timeout.",e,"not found!")),console.log("[ GLIFTEK Plugins ]:\n 'timeout.'",e,"not found!"),alert("[ GLIFTEK Plugins ]:\n 'timeout.'",e,"not found!")):setTimeout(l.bind(this,n,o),30)})})(1e4).then(function(){t(e)})}function promiseFunctionVAR(e,t){(function(t){var a=Date.now();return new Promise(function l(n,o){console.log("[ GLIFTEK Plugins ]:\n'",puzzleName,"'puzzle is looking for",e),"undefined"!==e?(n(e),console.log("[ GLIFTEK Plugins ]:",e.name,"found!")):t&&Date.now()-a>=t?(o(new Error("timeout.",e,"not found!")),console.log("[ GLIFTEK Plugins ]:\n 'timeout.'",e,"not found!"),alert("[ GLIFTEK Plugins ]:\n 'timeout.'",e,"not found!")):setTimeout(l.bind(this,n,o),30)})})(1e4).then(function(){t(e)})}window.lensflareJS_var||(window.lensflareJS_var=lensFlareJS()),checkboxFALSEcheck()}objInput&&"<none>"!=objInput?mainFunction():console.log("[ GLIFTEK ]: The ",puzzleName,"plugin puzzle is missing an input!")}).apply(null,arguments)}
function LENS_FLARE_DELUXE_1(){createLenseFlareFunction('myLensFlare_A','Lens_Flare_Point_Light',!0,RAYS_01,1.5,0.95,!0,GLOW_01,1,0.95,!0,BOKEH_01,0.75,0.75,0.65,0.95)}
function lensFlareSettingsRAYS(){return(function(e,l,a,t,i,r,n,d,o,s,p,c){return new Map([["type","RAYS"],["shape","RAYS"],["rays",e],["nameInput",l],["symmetrical",a],["rayWidth",t],["raySharpness",i],["randomSeed",r],["rotate",n],["feBlur",d],["opacity",o],["size",s],["distance",p],["color",c]])}).apply(null,arguments)}
function INIT_RAYS_SETTINGS_1(){RAYS_01=[lensFlareSettingsRAYS(6,'name',!0,3,0,9,0,0.1,0.9,900,0,'#ffff66',),lensFlareSettingsRAYS(9,'name',!1,3,1,3,0,0.1,0.9,1200,0.001,'#ffcc66',),lensFlareSettingsRAYS(64,'name',!0,3,0,5,23,2,0.5,500,0.002,'#ffffcc',)]}
function lensFlareSettingsBOKEH(){return(function(e,l,t,a,o,n,i,p){return new Map([["type","BOKEH"],["shape",e],["vert",l],["rotate",t],["feBlur",a],["opacity",o],["size",n],["distance",i],["color",p]])}).apply(null,arguments)}
function INIT_BOKEH_SETTINGS_1(){BOKEH_01=[lensFlareSettingsBOKEH('BOKEH_hexagon',0,0,0.2,0.6,1,0.9,'#ff9900',),lensFlareSettingsBOKEH('BOKEH_hexagon',0,0,0.8,0.5,2,0,'#ffff00',)]}
function SET_VARIABLES(){lens_flare_counter=1;LIST_bg_images=['./img/bg_clouds_pink_purple.jpg','./img/bg_blue_dark_cloudy.jpg','./img/bg_clouds_godrays_02.jpg'];GLOW_2=null;center_alpha_distance_02=null}
function notIgnoredObj(obj){return obj.type!=='AmbientLight'&&obj.name!==''&&!(obj.isMesh&&obj.isMaterialGeneratedMesh)&&!obj.isAuxClippingMesh}
function getObjectByName(objName){var objFound;var runTime=_pGlob!==undefined;objFound=runTime?_pGlob.objCache[objName]:null;if(objFound&&objFound.name===objName)
return objFound;appInstance.scene.traverse(function(obj){if(!objFound&&notIgnoredObj(obj)&&(obj.name==objName)){objFound=obj;if(runTime){_pGlob.objCache[objName]=objFound}}});return objFound}
function getAllObjectNames(){var objNameList=[];appInstance.scene.traverse(function(obj){if(notIgnoredObj(obj))
objNameList.push(obj.name)});return objNameList}
function getObjectNamesByGroupName(targetGroupName){var objNameList=[];appInstance.scene.traverse(function(obj){if(notIgnoredObj(obj)){var groupNames=obj.groupNames;if(!groupNames)
return;for(var i=0;i<groupNames.length;i++){var groupName=groupNames[i];if(groupName==targetGroupName){objNameList.push(obj.name)}}}});return objNameList}
function retrieveObjectNames(objNames){var acc=[];retrieveObjectNamesAcc(objNames,acc);return acc.filter(function(name){return name})}
function retrieveObjectNamesAcc(currObjNames,acc){if(typeof currObjNames=="string"){acc.push(currObjNames)}else if(Array.isArray(currObjNames)&&currObjNames[0]=="GROUP"){var newObj=getObjectNamesByGroupName(currObjNames[1]);for(var i=0;i<newObj.length;i++)
acc.push(newObj[i]);}else if(Array.isArray(currObjNames)&&currObjNames[0]=="ALL_OBJECTS"){var newObj=getAllObjectNames();for(var i=0;i<newObj.length;i++)
acc.push(newObj[i]);}else if(Array.isArray(currObjNames)){for(var i=0;i<currObjNames.length;i++)
retrieveObjectNamesAcc(currObjNames[i],acc);}}
function getCoordSystem(){var scene=appInstance.scene;if(scene&&"v3d" in scene.userData&&"coordSystem" in scene.userData.v3d){return scene.userData.v3d.coordSystem}else{return'Z_UP_RIGHT'}}
function coordsTransform(coords,from,to,noSignChange){if(from==to)
return coords;var y=coords.y,z=coords.z;if(from=='Z_UP_RIGHT'&&to=='Y_UP_RIGHT'){coords.y=z;coords.z=noSignChange?y:-y}else if(from=='Y_UP_RIGHT'&&to=='Z_UP_RIGHT'){coords.y=noSignChange?z:-z;coords.z=y}else{console.error('coordsTransform: Unsupported coordinate space')}
return coords}
var eulerV3DToBlenderShortest=function(){var eulerTmp=new v3d.Euler();var eulerTmp2=new v3d.Euler();var vec3Tmp=new v3d.Vector3();return function(euler,dest){var eulerBlender=eulerTmp.copy(euler).reorder('YZX');var eulerBlenderAlt=eulerTmp2.copy(eulerBlender).makeAlternative();var len=eulerBlender.toVector3(vec3Tmp).lengthSq();var lenAlt=eulerBlenderAlt.toVector3(vec3Tmp).lengthSq();dest.copy(len<lenAlt?eulerBlender:eulerBlenderAlt);return coordsTransform(dest,'Y_UP_RIGHT','Z_UP_RIGHT')}}();function RotationInterface(){this._userRotation=new v3d.Euler(0,0,0,'ZYX');this._actualRotation=new v3d.Euler()}
Object.assign(RotationInterface,{initObject:function(obj){if(obj.userData.v3d.puzzles===undefined){obj.userData.v3d.puzzles={}}
if(obj.userData.v3d.puzzles.rotationInterface===undefined){obj.userData.v3d.puzzles.rotationInterface=new RotationInterface()}
var rotUI=obj.userData.v3d.puzzles.rotationInterface;rotUI.updateFromObject(obj);return rotUI}});Object.assign(RotationInterface.prototype,{updateFromObject:function(obj){var SYNC_ROT_EPS=1e-8;if(!this._actualRotation.equalsEps(obj.rotation,SYNC_ROT_EPS)){this._actualRotation.copy(obj.rotation);this._updateUserRotFromActualRot()}},getActualRotation:function(euler){return euler.copy(this._actualRotation)},setUserRotation:function(euler){this._userRotation.set(euler.x,euler.y,euler.z);this._updateActualRotFromUserRot()},getUserRotation:function(euler){return euler.copy(this._userRotation)},_updateUserRotFromActualRot:function(){var order=this._userRotation.order;this._userRotation.copy(this._actualRotation).reorder(order)},_updateActualRotFromUserRot:function(){var order=this._actualRotation.order;this._actualRotation.copy(this._userRotation).reorder(order)}});function setObjTransform(objSelector,mode,vector,offset){var x=vector[0];var y=vector[1];var z=vector[2];var objNames=retrieveObjectNames(objSelector);function setObjProp(obj,prop,val){if(!offset){obj[mode][prop]=val}else{if(mode!="scale")
obj[mode][prop]+=val;else obj[mode][prop]*=val}}
var inputsUsed=_pGlob.vec3Tmp.set(Number(x!==''),Number(y!==''),Number(z!==''));var coords=_pGlob.vec3Tmp2.set(x||0,y||0,z||0);if(mode==='rotation'){coords.multiplyScalar(v3d.MathUtils.DEG2RAD)}
var coordSystem=getCoordSystem();coordsTransform(inputsUsed,coordSystem,'Y_UP_RIGHT',!0);coordsTransform(coords,coordSystem,'Y_UP_RIGHT',mode==='scale');for(var i=0;i<objNames.length;i++){var objName=objNames[i];if(!objName)continue;var obj=getObjectByName(objName);if(!obj)continue;if(mode==='rotation'&&coordSystem=='Z_UP_RIGHT'){var euler=eulerV3DToBlenderShortest(obj.rotation,_pGlob.eulerTmp);coordsTransform(euler,coordSystem,'Y_UP_RIGHT');if(inputsUsed.x)euler.x=offset?euler.x+coords.x:coords.x;if(inputsUsed.y)euler.y=offset?euler.y+coords.y:coords.y;if(inputsUsed.z)euler.z=offset?euler.z+coords.z:coords.z;euler.order="YZX";euler.reorder(obj.rotation.order);obj.rotation.copy(euler)}else if(mode==='rotation'&&coordSystem=='Y_UP_RIGHT'){var rotUI=RotationInterface.initObject(obj);var euler=rotUI.getUserRotation(_pGlob.eulerTmp);if(inputsUsed.x)euler.x=offset?euler.x+coords.x:coords.x;if(inputsUsed.y)euler.y=offset?euler.y+coords.y:coords.y;if(inputsUsed.z)euler.z=offset?euler.z+coords.z:coords.z;rotUI.setUserRotation(euler);rotUI.getActualRotation(obj.rotation)}else{if(inputsUsed.x)setObjProp(obj,"x",coords.x);if(inputsUsed.y)setObjProp(obj,"y",coords.y);if(inputsUsed.z)setObjProp(obj,"z",coords.z)}
obj.updateMatrixWorld(!0)}}
function tweenCamera(posOrObj,targetOrObj,duration,doSlot,movementType){var camera=appInstance.getCamera();if(Array.isArray(posOrObj)){var worldPos=_pGlob.vec3Tmp.fromArray(posOrObj);worldPos=coordsTransform(worldPos,getCoordSystem(),'Y_UP_RIGHT')}else if(posOrObj){var posObj=getObjectByName(posOrObj);if(!posObj)return;var worldPos=posObj.getWorldPosition(_pGlob.vec3Tmp)}else{var worldPos=camera.getWorldPosition(_pGlob.vec3Tmp)}
if(Array.isArray(targetOrObj)){var worldTarget=_pGlob.vec3Tmp2.fromArray(targetOrObj);worldTarget=coordsTransform(worldTarget,getCoordSystem(),'Y_UP_RIGHT')}else{var targObj=getObjectByName(targetOrObj);if(!targObj)return;var worldTarget=targObj.getWorldPosition(_pGlob.vec3Tmp2)}
duration=Math.max(0,duration);if(appInstance.controls&&appInstance.controls.tween){if(!appInstance.controls.inTween){appInstance.controls.tween(worldPos,worldTarget,duration,doSlot,movementType)}}else{if(camera.parent){camera.parent.worldToLocal(worldPos)}
camera.position.copy(worldPos);camera.lookAt(worldTarget);doSlot()}}
function SET_CAM_AND_LIGHT(){setObjTransform('Lens_Flare_Point_Light','position',[2.75,224638.07,7844.53],!0);tweenCamera('','Lens_Flare_Point_Light',0.0001,function(){},0)}
function lensFlareSettingsGLOW(){return(function(e,l,t,a,o,n,i,p,d,c,s,r,_){return new Map([["type","GLOW"],["nameInput",e],["shape",l],["toneCenter",t],["toneInner",a],["toneMid",o],["toneOuter",n],["toneEdge",i],["rotate",p],["feBlur",d],["opacity",c],["size",s],["distance",r],["color",_]])}).apply(null,arguments)}
function INIT_GLOW_SETTINGS_1(){GLOW_01=[lensFlareSettingsGLOW('name','GLOW_circle',0,0,0.7,0.85,1,0,0.4,0.4,150,0,'#ffff66',),lensFlareSettingsGLOW('name','GLOW_circle',0,0,0.7,0.85,1,0,0.6,0.4,300,0,'#ff9900',)]}
function objConstraintAddLimit(constraintName,objSelector,mode,min,max,targetObjName,dist,distLimitMode){var objNames;if(mode=='DISTANCE'){if(!targetObjName)return;var targetObj=getObjectByName(targetObjName);if(!targetObj)return}
objNames=retrieveObjectNames(objSelector);for(var i=0;i<objNames.length;i++){var objName=objNames[i];if(!objName)continue;var obj=getObjectByName(objName);if(!obj||!obj.constraints)continue;for(var j=obj.constraints.length-1;j>=0;j--){if(obj.constraints[j].name==constraintName){obj.constraints.splice(j,1)}}
var coordSystem=getCoordSystem();switch(mode){case 'POS_X':case 'POS_Y':case 'POS_Z':var cons=new v3d.LimitLocationConstraint();cons.name=constraintName;if(coordSystem=='Z_UP_RIGHT')
var compIndex=mode=='POS_X'?0:(mode=='POS_Y'?2:1);else var compIndex=mode=='POS_X'?0:(mode=='POS_Y'?1:2);if(coordSystem=='Z_UP_RIGHT'&&mode=='POS_Y'){cons.min.setComponent(compIndex,-max);cons.max.setComponent(compIndex,-min)}else{cons.min.setComponent(compIndex,min);cons.max.setComponent(compIndex,max)}
obj.constraints.push(cons);break;case 'ROT_X':case 'ROT_Y':case 'ROT_Z':var cons=new v3d.LimitRotationConstraint();cons.name=constraintName;if(coordSystem=='Z_UP_RIGHT')
cons.axis=mode=='ROT_X'?'X':(mode=='ROT_Y'?'Z':'Y');else cons.axis=mode=='ROT_X'?'X':(mode=='ROT_Y'?'Y':'Z');if(coordSystem=='Z_UP_RIGHT'&&mode=='ROT_Y'){cons.min=v3d.MathUtils.degToRad(-max);cons.max=v3d.MathUtils.degToRad(-min)}else{cons.min=v3d.MathUtils.degToRad(min);cons.max=v3d.MathUtils.degToRad(max)}
obj.constraints.push(cons);break;case 'SCALE_X':case 'SCALE_Y':case 'SCALE_Z':var cons=new v3d.LimitScaleConstraint();cons.name=constraintName;if(coordSystem=='Z_UP_RIGHT')
var compIndex=mode=='SCALE_X'?0:(mode=='SCALE_Y'?2:1);else var compIndex=mode=='SCALE_X'?0:(mode=='SCALE_Y'?1:2);cons.min.setComponent(compIndex,min);cons.max.setComponent(compIndex,max);obj.constraints.push(cons);break;case 'DISTANCE':var cons=new v3d.LimitDistanceConstraint(targetObj);cons.name=constraintName;cons.distance=dist;cons.limitMode=distLimitMode;obj.constraints.push(cons);break}}}
function CAMERA_CONSTRAINTS(){objConstraintAddLimit('myConst_Cam_pos_X','Camera','POS_X',80,80,'',0,'LIMITDIST_ONSURFACE');objConstraintAddLimit('myConst_Cam_pos_Y','Camera','POS_Y',224540,224540,'',0,'LIMITDIST_ONSURFACE');objConstraintAddLimit('myConst_Cam_pos_Z','Camera','POS_Z',7820,7870,'',0,'LIMITDIST_ONSURFACE');objConstraintAddLimit('myConst_Cam_rot_X','Camera','ROT_X',0,0,'',0,'LIMITDIST_ONSURFACE');objConstraintAddLimit('myConst_Cam_rot_Y','Camera','ROT_Y',0,2.5,'',0,'LIMITDIST_ONSURFACE');objConstraintAddLimit('myConst_Cam_rot_Z','Camera','ROT_Z',6,70,'',0,'LIMITDIST_ONSURFACE')}
function removeObject(objSelector){var objNames=retrieveObjectNames(objSelector);for(var i=0;i<objNames.length;i++){var objName=objNames[i]
if(!objName)
continue;var obj=getObjectByName(objName);if(!obj||!obj.parent)
continue;obj.parent.remove(obj);_pGlob.objCache={}}}
function CHANGE_BG_AND_FLARE(){if(lens_flare_counter==1){setImageBackground('./img/bg_clouds_pink_purple.jpg',)
removeObject('myLensFlare_C');LENS_FLARE_DELUXE_1()}else if(lens_flare_counter==2){setImageBackground('./img/bg_blue_dark_cloudy.jpg',)
removeObject('myLensFlare_A');LENS_FLARE_DELUXE_2()}else if(lens_flare_counter==3){setImageBackground('./img/city_lights_01.jpg',)
removeObject('myLensFlare_B');LENS_FLARE_DELUXE_3()}}
function getElements(ids,isParent){var elems=[];if(Array.isArray(ids)&&ids[0]!='CONTAINER'&&ids[0]!='WINDOW'&&ids[0]!='DOCUMENT'&&ids[0]!='BODY'&&ids[0]!='QUERYSELECTOR'){for(var i=0;i<ids.length;i++)
elems.push(getElement(ids[i],isParent));}else{elems.push(getElement(ids,isParent))}
return elems}
function getElement(id,isParent){var elem;if(Array.isArray(id)&&id[0]=='CONTAINER'){if(appInstance!==null){elem=appInstance.container}else if(typeof _initGlob!=='undefined'){var id=_initGlob.container;if(isParent){elem=parent.document.getElementById(id)}else{elem=document.getElementById(id)}}}else if(Array.isArray(id)&&id[0]=='WINDOW'){if(isParent)
elem=parent;else elem=window}else if(Array.isArray(id)&&id[0]=='DOCUMENT'){if(isParent)
elem=parent.document;else elem=document}else if(Array.isArray(id)&&id[0]=='BODY'){if(isParent)
elem=parent.document.body;else elem=document.body}else if(Array.isArray(id)&&id[0]=='QUERYSELECTOR'){if(isParent)
elem=parent.document.querySelector(id);else elem=document.querySelector(id)}else{if(isParent)
elem=parent.document.getElementById(id);else elem=document.getElementById(id)}
return elem}
function setHTMLElemStyle(prop,value,ids,isParent){var elems=getElements(ids,isParent);for(var i=0;i<elems.length;i++){var elem=elems[i];if(!elem||!elem.style)
continue;elem.style[prop]=value}}
function initObjectPicking(callback,eventType,mouseDownUseTouchStart,mouseButtons){var elem=appInstance.renderer.domElement;elem.addEventListener(eventType,pickListener);if(v3d.PL.editorEventListeners)
v3d.PL.editorEventListeners.push([elem,eventType,pickListener]);if(eventType=='mousedown'){var touchEventName=mouseDownUseTouchStart?'touchstart':'touchend';elem.addEventListener(touchEventName,pickListener);if(v3d.PL.editorEventListeners)
v3d.PL.editorEventListeners.push([elem,touchEventName,pickListener])}else if(eventType=='dblclick'){var prevTapTime=0;function doubleTapCallback(event){var now=new Date().getTime();var timesince=now-prevTapTime;if(timesince<600&&timesince>0){pickListener(event);prevTapTime=0;return}
prevTapTime=new Date().getTime()}
var touchEventName=mouseDownUseTouchStart?'touchstart':'touchend';elem.addEventListener(touchEventName,doubleTapCallback);if(v3d.PL.editorEventListeners)
v3d.PL.editorEventListeners.push([elem,touchEventName,doubleTapCallback])}
var raycaster=new v3d.Raycaster();function pickListener(event){if(!appInstance.getCamera())
return;event.preventDefault();var xNorm=0,yNorm=0;if(event instanceof MouseEvent){if(mouseButtons&&mouseButtons.indexOf(event.button)==-1)
return;xNorm=event.offsetX/elem.clientWidth;yNorm=event.offsetY/elem.clientHeight}else if(event instanceof TouchEvent){var rect=elem.getBoundingClientRect();xNorm=(event.changedTouches[0].clientX-rect.left)/rect.width;yNorm=(event.changedTouches[0].clientY-rect.top)/rect.height}
_pGlob.screenCoords.x=xNorm*2-1;_pGlob.screenCoords.y=-yNorm*2+1;raycaster.setFromCamera(_pGlob.screenCoords,appInstance.getCamera(!0));var objList=[];appInstance.scene.traverse(function(obj){objList.push(obj)});var intersects=raycaster.intersectObjects(objList);callback(intersects,event)}}
function objectsIncludeObj(objNames,testedObjName){if(!testedObjName)return!1;for(var i=0;i<objNames.length;i++){if(testedObjName==objNames[i]){return!0}else{var obj=getObjectByName(objNames[i]);if(obj&&obj.type=="Group"){for(var j=0;j<obj.children.length;j++){if(testedObjName==obj.children[j].name){return!0}}}}}
return!1}
function getPickedObjectName(obj){if(obj.isMesh&&obj.isMaterialGeneratedMesh&&obj.parent){return obj.parent.name}else{return obj.name}}
initObjectPicking(function(intersects,event){var prevHovered=_pGlob.hoveredObject;var currHovered='';_pGlob.objHoverInfo=_pGlob.objHoverInfo||[];var lastIntersectIndex=Infinity;_pGlob.objHoverInfo.forEach(function(el){var maxIntersects=el.xRay?intersects.length:Math.min(1,intersects.length);for(var i=0;i<maxIntersects;i++){var obj=intersects[i].object;var objName=getPickedObjectName(obj);if(objectsIncludeObj(retrieveObjectNames(el.objSelector),objName)&&i<=lastIntersectIndex){currHovered=objName;lastIntersectIndex=i}}});if(prevHovered==currHovered)return;_pGlob.objHoverInfo.forEach(function(el){if(objectsIncludeObj(retrieveObjectNames(el.objSelector),prevHovered)){_pGlob.hoveredObject=prevHovered;el.callbacks[1](event)}});_pGlob.objHoverInfo.forEach(function(el){if(objectsIncludeObj(retrieveObjectNames(el.objSelector),currHovered)){_pGlob.hoveredObject=currHovered;el.callbacks[0](event)}});_pGlob.hoveredObject=currHovered},'mousemove',!1);function registerOnHover(objSelector,xRay,cbOver,cbOut){_pGlob.objHoverInfo=_pGlob.objHoverInfo||[];_pGlob.objHoverInfo.push({objSelector:objSelector,callbacks:[cbOver,cbOut],xRay:xRay})}
function registerOnClick(objSelector,xRay,doubleClick,mouseButtons,cbDo,cbIfMissedDo){_pGlob.objClickInfo=_pGlob.objClickInfo||[];_pGlob.objClickInfo.push({objSelector:objSelector,callbacks:[cbDo,cbIfMissedDo]});initObjectPicking(function(intersects,event){var isPicked=!1;var maxIntersects=xRay?intersects.length:Math.min(1,intersects.length);for(var i=0;i<maxIntersects;i++){var obj=intersects[i].object;var objName=getPickedObjectName(obj);var objNames=retrieveObjectNames(objSelector);if(objectsIncludeObj(objNames,objName)){_pGlob.pickedObject=objName;isPicked=!0;cbDo(event)}}
if(!isPicked){_pGlob.pickedObject='';cbIfMissedDo(event)}},doubleClick?'dblclick':'mousedown',!1,mouseButtons)}
function CLICK_NEXT_BUTTON(){registerOnHover('hitbox',!0,function(){setHTMLElemStyle('cursor','pointer',['CONTAINER'],!1)},function(){setHTMLElemStyle('cursor','default',['CONTAINER'],!1)});registerOnClick('hitbox',!0,!1,[0,1,2],function(){SWITCH_FLARE()},function(){})}
function whenMoved(objSelector,velocity,cbStart,cbMove,cbStop){_pGlob.objMovementInfos=_pGlob.objMovementInfos||{};function savePreviousCoords(objName,obj,prevIsMoving){if(_pGlob.objMovementInfos[objName]){var info=_pGlob.objMovementInfos[objName];info.prevPosX=obj.position.x;info.prevPosY=obj.position.y;info.prevPosZ=obj.position.z;info.prevRotX=obj.rotation.x;info.prevRotY=obj.rotation.y;info.prevRotZ=obj.rotation.z;info.prevScaX=obj.scale.x;info.prevScaY=obj.scale.y;info.prevScaZ=obj.scale.z;info.prevIsMoving=prevIsMoving}else{var info={prevPosX:obj.position.x,prevPosY:obj.position.y,prevPosZ:obj.position.z,prevRotX:obj.rotation.x,prevRotY:obj.rotation.y,prevRotZ:obj.rotation.z,prevScaX:obj.scale.x,prevScaY:obj.scale.y,prevScaZ:obj.scale.z,prevIsMoving:prevIsMoving};_pGlob.objMovementInfos[objName]=info}
return info}
function checkMoving(objName,obj,elapsed){var info=_pGlob.objMovementInfos[objName]||savePreviousCoords(objName,obj,!1);var delta=velocity*elapsed;var isMoving=Math.abs(obj.position.x-info.prevPosX)>delta||Math.abs(obj.position.y-info.prevPosY)>delta||Math.abs(obj.position.z-info.prevPosZ)>delta||Math.abs(obj.rotation.x-info.prevRotX)>delta||Math.abs(obj.rotation.y-info.prevRotY)>delta||Math.abs(obj.rotation.z-info.prevRotZ)>delta||Math.abs(obj.scale.x-info.prevScaX)>delta||Math.abs(obj.scale.y-info.prevScaY)>delta||Math.abs(obj.scale.z-info.prevScaZ)>delta;if(!info.prevIsMoving&&isMoving){cbStart(objName);savePreviousCoords(objName,obj,!0)}else if(info.prevIsMoving&&isMoving){cbMove(objName);savePreviousCoords(objName,obj,!0)}else if(info.prevIsMoving&&!isMoving){cbStop(objName);savePreviousCoords(objName,obj,!1)}else{savePreviousCoords(objName,obj,!1)}}
function addToRender(objSelector){function renderCb(elapsed,timeline){var objNames=retrieveObjectNames(objSelector);for(var i=0;i<objNames.length;i++){var objName=objNames[i];var obj=getObjectByName(objName);if(!obj)
return;checkMoving(objName,obj,elapsed)}}
appInstance.renderCallbacks.push(renderCb);if(v3d.PL.editorRenderCallbacks)
v3d.PL.editorRenderCallbacks.push([appInstance,renderCb])}
addToRender(objSelector)}
function DISABLE_RENDERING(){disableRendering(!0);whenMoved('Camera',0.01,function(){enableRendering()},function(){},function(){disableRendering(!0)})}
function LENS_FLARE_DELUXE_2(){createLenseFlareFunction('myLensFlare_B','Lens_Flare_Point_Light',!0,RAYS_2,0.4,0.75,!0,GLOW_2,0.125,0.6,!0,BOKEH_2,1,0.95,2.25,0.8)}
function INIT_RAYS_SETTINGS_2(){RAYS_2=[lensFlareSettingsRAYS(2,'anamorphic',!0,0.7,8,0,0,0,0.9,10000,0,'#3366ff',),lensFlareSettingsRAYS(32,'shimmer_1',!1,0.5,3,2.5,23,0,0.8,2400,0.002,'#3366ff',),lensFlareSettingsRAYS(32,'shimmer_2',!1,0.5,3,2.5,45,0,0.8,2400,0.002,'#33ccff',),lensFlareSettingsRAYS(64,'shimmer_3',!1,0.25,0,4,0,0,0.8,1600,0.003,'#99ffff',)]}
function INIT_BOKEH_SETTINGS_2(){BOKEH_2=[lensFlareSettingsBOKEH('BOKEH_triangle',0,15,0.2,0.5,1,0.9,'#ccffff',),lensFlareSettingsBOKEH('BOKEH_triangle',0,15,0.2,0.3,0.5,0.5,'#66ffff',)]}
function INIT_GLOW_SETTINGS_2(){GLOW_2=[lensFlareSettingsGLOW('inner glow','GLOW_hexagon',0,0.2,0.7,1,1,0,4,0.9,350,0,'#ccffff',),lensFlareSettingsGLOW('outer circle','GLOW_circle',0.55,0.65,0.85,0.95,1,0,7,0.4,1500,0,'#00ffff',),lensFlareSettingsGLOW('accent elipse','GLOW_ellipse',0.55,0.65,0.85,0.95,1,0,7,0.2,1500,0,'#00ffff',)]}
function LENS_FLARE_DELUXE_3(){createLenseFlareFunction('myLensFlare_C','Lens_Flare_Point_Light',!0,RAYS_3,0.4,0.9,!0,GLOW_3,0.5,0.9,!0,BOKEH_3,1,0.95,1,0.8)}
function INIT_RAYS_SETTINGS_3(){RAYS_3=[lensFlareSettingsRAYS(32,'shimmer_1',!1,1,3,2.5,23,0,0.8,6000,0.002,'#ff6600',),lensFlareSettingsRAYS(32,'shimmer_2',!1,5,3,8,45,0,0.8,2400,0.002,'#993300',)]}
function INIT_BOKEH_SETTINGS_3(){BOKEH_3=[lensFlareSettingsBOKEH('BOKEH_ellipse',0,0,0.2,0.5,1,0.9,'#ffff99',),lensFlareSettingsBOKEH('BOKEH_ellipse',0,0,0.2,0.3,0.5,0.5,'#ffff66',)]}
function INIT_GLOW_SETTINGS_3(){GLOW_3=[lensFlareSettingsGLOW('inner glow','GLOW_circle',0,0.2,0.5,0.6,0.7,0,10,0.9,600,0,'#ffcc66',),lensFlareSettingsGLOW('name','GLOW_circle',0,0.2,0.7,0.8,0.9,0,4,0.5,800,0,'#cc9933',)]}
MAIN()}})()