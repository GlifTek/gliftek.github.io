"use strict";!function(){var LIST_NONE="<none>",_pGlob={objCache:{},fadeAnnotations:!0,pickedObject:"",hoveredObject:"",mediaElements:{},loadedFile:"",states:[],percentage:0,openedFile:"",xrSessionAcquired:!1,xrSessionCallbacks:[]};_pGlob.screenCoords=new v3d.Vector2,_pGlob.intervalTimers={},_pGlob.AXIS_X=new v3d.Vector3(1,0,0),_pGlob.AXIS_Y=new v3d.Vector3(0,1,0),_pGlob.AXIS_Z=new v3d.Vector3(0,0,1),_pGlob.MIN_DRAG_SCALE=.001,_pGlob.SET_OBJ_ROT_EPS=1e-8,_pGlob.vec2Tmp=new v3d.Vector2,_pGlob.vec2Tmp2=new v3d.Vector2,_pGlob.vec3Tmp=new v3d.Vector3,_pGlob.vec3Tmp2=new v3d.Vector3,_pGlob.vec3Tmp3=new v3d.Vector3,_pGlob.vec3Tmp4=new v3d.Vector3,_pGlob.eulerTmp=new v3d.Euler,_pGlob.eulerTmp2=new v3d.Euler,_pGlob.quatTmp=new v3d.Quaternion,_pGlob.quatTmp2=new v3d.Quaternion,_pGlob.colorTmp=new v3d.Color,_pGlob.mat4Tmp=new v3d.Matrix4,_pGlob.planeTmp=new v3d.Plane,_pGlob.raycasterTmp=new v3d.Raycaster;var PL=v3d.PL=v3d.PL||{};v3d.puzzles=PL,PL.procedures=PL.procedures||{},PL.execInitPuzzles=function(e){var n=null,t={percentage:0,output:{initOptions:{fadeAnnotations:!0,useBkgTransp:!1,preserveDrawBuf:!1,useCompAssets:!1,useFullscreen:!0,useCustomPreloader:!1,preloaderStartCb:function(){},preloaderProgressCb:function(){},preloaderEndCb:function(){}}}};t.container=void 0!==e&&"container"in e?e.container:"",this.procedures.INIT=l,this.procedures.SET_BG_GRADIENT=u,this.procedures.LOAD_BG_SKY_IMAGE_GRADIENT=p;var o,r,a,i,s={INIT:l,SET_BG_GRADIENT:u,LOAD_BG_SKY_IMAGE_GRADIENT:p};function l(){p()}function c(e,o){var r;if(Array.isArray(e)&&"CONTAINER"==e[0]){if(null!==n)r=n.container;else if(void 0!==t){e=t.container;r=o?parent.document.getElementById(e):document.getElementById(e)}}else r=Array.isArray(e)&&"WINDOW"==e[0]?o?parent:window:Array.isArray(e)&&"DOCUMENT"==e[0]?o?parent.document:document:Array.isArray(e)&&"BODY"==e[0]?o?parent.document.body:document.body:Array.isArray(e)&&"QUERYSELECTOR"==e[0]?o?parent.document.querySelector(e):document.querySelector(e):o?parent.document.getElementById(e):document.getElementById(e);return r}function _(e,n,t,o){for(var r=function(e,n){var t=[];if(Array.isArray(e)&&"CONTAINER"!=e[0]&&"WINDOW"!=e[0]&&"DOCUMENT"!=e[0]&&"BODY"!=e[0]&&"QUERYSELECTOR"!=e[0])for(var o=0;o<e.length;o++)t.push(c(e[o],n));else t.push(c(e,n));return t}(t,o),a=0;a<r.length;a++){var i=r[a];i&&i.style&&(i.style[e]=n)}}function u(){i=["linear-gradient(",o="#0d427b",",",a=" #dc8f17",")"].join(""),console.log("bg-gradient: "+String(i)),_("backgroundImage",i,["CONTAINER"],!0)}function p(){r='// var bgTexture = new THREE.TextureLoader().load("images/background/space.png");\n// bgTexture.minFilter = THREE.LinearFilter;\n// scene.background = bgTexture;\nvar bgTexture = new THREE.TextureLoader()\n.load(window.gliftek_SVGs.lensflare.bg_sky_gradient);\n\nbgTexture.minFilter = THREE.LinearFilter;\napp.scene.background = bgTexture;';var e=Object.defineProperties({},{color_1:{get:function(){return o},set:function(e){o=e}},EXEC_load_bg:{get:function(){return r},set:function(e){r=e}},color_2:{get:function(){return a},set:function(e){a=e}},"bg-gradient":{get:function(){return i},set:function(e){i=e}}});Function("app","v3d","VARS","PROC",r)(n,v3d,e,s)}return t.output.initOptions.fadeAnnotations=!0,t.output.initOptions.useBkgTransp=!0,t.output.initOptions.preserveDrawBuf=!1,t.output.initOptions.useCompAssets=!1,t.output.initOptions.useFullscreen=!0,t.output},PL.init=function(appInstance,initOptions){var app=appInstance;initOptions=initOptions||{},"fadeAnnotations"in initOptions&&(_pGlob.fadeAnnotations=initOptions.fadeAnnotations),this.procedures.SWITCH_FLARE=SWITCH_FLARE,this.procedures.LENS_FLARES_PROCEDURES=LENS_FLARES_PROCEDURES,this.procedures.MAIN=MAIN,this.procedures.FADE_IN=FADE_IN,this.procedures.SWITCH_FLARE_FADE=SWITCH_FLARE_FADE,this.procedures.LENS_FLARE_DELUXE_1=LENS_FLARE_DELUXE_1,this.procedures.INIT_RAYS_SETTINGS_1=INIT_RAYS_SETTINGS_1,this.procedures.INIT_BOKEH_SETTINGS_1=INIT_BOKEH_SETTINGS_1,this.procedures.SET_VARIABLES=SET_VARIABLES,this.procedures.SET_CAM_AND_LIGHT=SET_CAM_AND_LIGHT,this.procedures.INIT_GLOW_SETTINGS_1=INIT_GLOW_SETTINGS_1,this.procedures.CAMERA_CONSTRAINTS=CAMERA_CONSTRAINTS,this.procedures.CHANGE_BG_AND_FLARE=CHANGE_BG_AND_FLARE,this.procedures.CLICK_NEXT_BUTTON=CLICK_NEXT_BUTTON,this.procedures.LENS_FLARE_DELUXE_2=LENS_FLARE_DELUXE_2,this.procedures.INIT_RAYS_SETTINGS_2=INIT_RAYS_SETTINGS_2,this.procedures.INIT_BOKEH_SETTINGS_2=INIT_BOKEH_SETTINGS_2,this.procedures.INIT_GLOW_SETTINGS_2=INIT_GLOW_SETTINGS_2,this.procedures.LENS_FLARE_DELUXE_3=LENS_FLARE_DELUXE_3,this.procedures.INIT_RAYS_SETTINGS_3=INIT_RAYS_SETTINGS_3,this.procedures.INIT_BOKEH_SETTINGS_3=INIT_BOKEH_SETTINGS_3,this.procedures.INIT_GLOW_SETTINGS_3=INIT_GLOW_SETTINGS_3;var PROC={SWITCH_FLARE:SWITCH_FLARE,LENS_FLARES_PROCEDURES:LENS_FLARES_PROCEDURES,MAIN:MAIN,FADE_IN:FADE_IN,SWITCH_FLARE_FADE:SWITCH_FLARE_FADE,LENS_FLARE_DELUXE_1:LENS_FLARE_DELUXE_1,INIT_RAYS_SETTINGS_1:INIT_RAYS_SETTINGS_1,INIT_BOKEH_SETTINGS_1:INIT_BOKEH_SETTINGS_1,SET_VARIABLES:SET_VARIABLES,SET_CAM_AND_LIGHT:SET_CAM_AND_LIGHT,INIT_GLOW_SETTINGS_1:INIT_GLOW_SETTINGS_1,CAMERA_CONSTRAINTS:CAMERA_CONSTRAINTS,CHANGE_BG_AND_FLARE:CHANGE_BG_AND_FLARE,CLICK_NEXT_BUTTON:CLICK_NEXT_BUTTON,LENS_FLARE_DELUXE_2:LENS_FLARE_DELUXE_2,INIT_RAYS_SETTINGS_2:INIT_RAYS_SETTINGS_2,INIT_BOKEH_SETTINGS_2:INIT_BOKEH_SETTINGS_2,INIT_GLOW_SETTINGS_2:INIT_GLOW_SETTINGS_2,LENS_FLARE_DELUXE_3:LENS_FLARE_DELUXE_3,INIT_RAYS_SETTINGS_3:INIT_RAYS_SETTINGS_3,INIT_BOKEH_SETTINGS_3:INIT_BOKEH_SETTINGS_3,INIT_GLOW_SETTINGS_3:INIT_GLOW_SETTINGS_3},lens_flare_counter,RAYS_01,BOKEH_01,GLOW_01,RAYS_2,BOKEH_2,GLOW_2,RAYS_3,BOKEH_3,GLOW_3,LIST_bg_images,center_alpha_distance_02;function SWITCH_FLARE(){(lens_flare_counter=("number"==typeof lens_flare_counter?lens_flare_counter:0)+1)<=3?(console.log("lens_flare_counter: "+String(lens_flare_counter)),SWITCH_FLARE_FADE()):lens_flare_counter>3&&(lens_flare_counter=1,console.log("lens_flare_counter reset to: "+String(lens_flare_counter)),SWITCH_FLARE_FADE())}function setImageBackground(){return function(e){!function(){let n=(new THREE.TextureLoader).load(e);n.minFilter=THREE.LinearFilter,app.scene.background=n,app.scene.background.encoding=THREE.sRGBEncoding}()}.apply(null,arguments)}function LENS_FLARES_PROCEDURES(){setImageBackground("./img/bg_clouds_pink_purple.jpg"),INIT_RAYS_SETTINGS_1(),INIT_GLOW_SETTINGS_1(),INIT_BOKEH_SETTINGS_1(),INIT_RAYS_SETTINGS_2(),INIT_GLOW_SETTINGS_2(),INIT_BOKEH_SETTINGS_2(),INIT_RAYS_SETTINGS_3(),INIT_GLOW_SETTINGS_3(),INIT_BOKEH_SETTINGS_3(),LENS_FLARE_DELUXE_1()}function setScreenScale(e){appInstance.useHiDPIRenderPass||appInstance.renderer.setPixelRatio(e),appInstance.postprocessing&&appInstance.postprocessing.composer.setPixelRatio(e),appInstance.onResize()}function MAIN(){setScreenScale(1.5),FADE_IN(),SET_VARIABLES(),SET_CAM_AND_LIGHT(),CAMERA_CONSTRAINTS(),CLICK_NEXT_BUTTON(),LENS_FLARES_PROCEDURES()}function screenFade(){return function(screenFade_ID_Input,screenFade_Z_Index_Input,typeDropdown,screenFade_Pause_Input,screenFade_Duration_Input,colorInput_1_PICKER,colorInput_1_TEXT,delete_When_Done_Checkbox,whenDone_Statement_Input){const puzzleName="Print To Modal Card";function mainFunction(){function setColorFromInputs(e,n){let t;return void 0===e||null==typeof e||""==e?(t=n,console.log(n,"supplied. using PICKER.")):(t=e,console.log(e,"supplied. using TEXT.")),t}const colorInput_1esc=setColorFromInputs(colorInput_1_TEXT,colorInput_1_PICKER);console.log("colorInput_1esc:",colorInput_1esc);let computedColorDiv=document.createElement("div");function RGBA_from_color_input(e,n){if("transparent"==e||null==e||void 0===e)return"rgba(0, 0, 0, 0)";{computedColorDiv.style.color=e;let t=window.getComputedStyle(computedColorDiv).color;console.log("computedColor for: ",e,":",t);let o=t.length,r="rgba("+t.substring(4,o-1)+", "+n+")";return console.log("computedColor_RGBA for: ",e,":",r),r}}computedColorDiv.id="computedColorDiv-"+screenFade_ID_Input,document.body.appendChild(computedColorDiv);const screenFadeColor=RGBA_from_color_input(colorInput_1esc,1);console.log("screenFadeColor: ",screenFadeColor),computedColorDiv.remove();let styleVar=setstyleVar(),style=document.createElement("style");style.id="screenFade-"+screenFade_ID_Input,style.innerHTML=styleVar,document.head.appendChild(style);let screenFade_Div=document.createElement("div");function getBGcolor(){"in"==typeDropdown?(screenFade_Div.style.backgroundColor="rgba(0,0,0,0)",console.log("screenFade_Div.style.backgroundColor:",screenFade_Div.style.backgroundColor)):"out"==typeDropdown&&(screenFade_Div.style.backgroundColor=screenFadeColor,console.log("screenFade_Div.style.backgroundColor:",screenFade_Div.style.backgroundColor))}screenFade_Div.id=screenFade_ID_Input,screenFade_Div.className="screenFade-"+screenFade_ID_Input,getBGcolor();const container=document.getElementById("v3d-container");function animateScreenFade(){const animationType="animation-screen-fade-"+typeDropdown+"-"+screenFade_ID_Input;function screenFadeDisplay(){"in"==typeDropdown?(screenFade_Div.style.display="block",console.log("screenFade_Div.style.display:",screenFade_Div.style.display),deleteWhenDone()):"out"==typeDropdown&&(screenFade_Div.style.display="none",console.log("screenFade_Div.style.display:",screenFade_Div.style.display),deleteWhenDone())}function deleteWhenDone(){1==delete_When_Done_Checkbox&&screenFade_Div.remove()}screenFade_Div.style.animationName=animationType,console.log("screenFade_Div.style.animationName:",screenFade_Div.style.animationName),screenFade_Div.addEventListener("animationend",function(event){event.animationName;{screenFade_Div.removeEventListener("animationend",null),screenFadeDisplay();let screenFadeState=eval(`${screenFade_ID_Input}.faded = '${typeDropdown}';`);console.log("screenFadeState:",screenFadeState),whenDone_Statement_Input()}})}function setstyleVar(){return`\n                #computedColorDiv-${screenFade_ID_Input}\n                {\n                    height: 0px;\n                    width: 0px;\n                    display: none;\n                    z-index = -10;\n                }\n\n                .screenFade-${screenFade_ID_Input}\n                {\n                    display: block;\n                    position: fixed;\n                    z-index: ${screenFade_Z_Index_Input};\n                    left: 0;\n                    top: 0;\n                    height: 100%;\n                    width: 100%;\n                    overflow: hidden;\n                    pointer-events: none;\n\n                    animation-duration: ${screenFade_Duration_Input}s;\n                    animation-timing-function: ease-in-out;\n                }\n\n\n                @keyframes animation-screen-fade-in-${screenFade_ID_Input}\n                {\n                    from {\n                        background-color: rgba(0,0,0,0);\n                    }\n                    to {\n                        background-color: ${screenFadeColor};\n                    }\n                }\n\n\n                @keyframes animation-screen-fade-out-${screenFade_ID_Input}\n                {\n                    from {\n                        background-color: ${screenFadeColor};\n                    }\n                    to {\n                        background-color: rgba(0,0,0,0);\n                    }\n                }\n\n                `}container.appendChild(screenFade_Div),setTimeout(function(){animateScreenFade()},1e3*screenFade_Pause_Input)}eval(`window.${screenFade_ID_Input} = { faded: null };`),screenFade_ID_Input?mainFunction():console.log("[ GLIFTEK ]: The",puzzleName,"plugin puzzle is missing an input!")}.apply(null,arguments)}function FADE_IN(){screenFade("screenFade_1",10,"out",1.5,1,"#000000","",!0,function(){})}function SWITCH_FLARE_FADE(){screenFade("screenFade_2",10,"in",0,.25,"#000000","",!0,function(){CHANGE_BG_AND_FLARE(),screenFade("screenFade_3",10,"out",.5,.25,"#000000","",!0,function(){})})}function createLenseFlareFunction(){return function(nameInput,objInput,activeCheckboxRAYS,flareSettingsRAYS,flareMasterSizeRAYS,flareMasterOpacityRAYS,activeCheckboxGLOW,flareSettingsGLOW,flareMasterSizeGLOW,flareMasterOpacityGLOW,activeCheckboxBOKEH,flareSettingsBOKEH,flareMasterSizeBOKEH,flareMasterOpacityBOKEH,flareMasterSize,flareMasterOpacity){const puzzleName="Lense Flare Deluxe";let readyToAddRAYS=!1,readyToAddGLOW=!1,readyToAddBOKEH=!1;const LIST_flareArgsRAYS=["rays","symmetrical","rayWidth","raySharpness","randomSeed","rotate","feBlur","opacity"],LIST_flareArgsGLOW=["toneCenter","toneInner","toneMid","toneOuter","toneEdge","rotate","feBlur","opacity"],LIST_flareArgsBOKEH=["shape","color","vert","rotate","feBlur","opacity"],varToString=e=>Object.keys(e)[0],renderer=app.renderer;renderer.outputEncoding=THREE.sRGBEncoding,renderer.antialias=!0;const scene=app.scene,camera=app.camera;let textureLoader=new THREE.TextureLoader,clock=new THREE.Clock,LIST_lensFlareRAYS=[];LIST_lensFlareRAYS.name="LIST_lensFlareRAYS";let LIST_lensFlareGLOW=[];LIST_lensFlareGLOW.name="LIST_lensFlareGLOW";let LIST_lensFlareBOKEH=[];LIST_lensFlareBOKEH.name="LIST_lensFlareBOKEH";let LIST_lensFlareALL=[LIST_lensFlareRAYS,LIST_lensFlareGLOW,LIST_lensFlareBOKEH],lensflare,light,selectedLight,MAP_LF_Bokeh_Polygons=new Map,BOKEH_line,BOKEH_circle,BOKEH_ellipse,BOKEH_triangle,BOKEH_square,BOKEH_pentagon,BOKEH_hexagon,BOKEH_heptagon,BOKEH_octagon,BOKEH_nonagon;function mainFunction(){function checkboxFALSEcheck(){0==activeCheckboxRAYS&&0==activeCheckboxGLOW&&0==activeCheckboxBOKEH?console.log("[ GLIFTEK ] Plugins: Lens Flare Deluxe all settings disabled."):(0==activeCheckboxRAYS&&(readyToAddRAYS=!0),0==activeCheckboxGLOW&&(readyToAddGLOW=!0),0==activeCheckboxBOKEH&&(readyToAddBOKEH=!0),init())}function init(){loadAllLensFlareTextures(),promiseFunctionOBJ(objInput,function(e){light=scene.getObjectByName(e),checkboxTRUEcheck(),waitToAddAllFlares()})}function checkboxTRUEcheck(){if(1==activeCheckboxRAYS)if(flareSettingsRAYS)arrayCheck(flareSettingsRAYS);else{console.log("[ GLIFTEK ]: Lens Flare Deluxe Rays settings missing. Using default settings."),(flareSettingsRAYS=[]).name="flareSettingsRAYS";const e=new Map([["type","RAYS"],["shape","RAYS"],["rays",12],["nameInput","default_rays_01"],["symmetrical",!1],["rayWidth",1],["raySharpness",.9],["randomSeed",10],["rotate",0],["feBlur",.2],["opacity",.9],["size",500],["distance",0],["color","teal"]]),n=new Map([["type","RAYS"],["shape","RAYS"],["rays",6],["nameInput","default_rays_01"],["symmetrical",!0],["rayWidth",1],["raySharpness",.9],["randomSeed",0],["rotate",0],["feBlur",.1],["opacity",.98],["size",600],["distance",0],["color","cyan"]]);flareSettingsRAYS.push(e),flareSettingsRAYS.push(n),makeFlares(flareSettingsRAYS)}if(1==activeCheckboxGLOW)if(flareSettingsGLOW)arrayCheck(flareSettingsGLOW);else{console.log("[ GLIFTEK ]: Lens Flare Deluxe Glow settings missing. Using default settings."),(flareSettingsGLOW=[]).name="flareSettingsGLOW";const e=new Map([["type","GLOW"],["shape","GLOW_circle"],["toneCenter",0],["toneInner",.2],["toneMid",.3],["toneOuter",.99],["toneEdge",1],["rotate",0],["feBlur",0],["opacity",.6],["size",300],["distance",1e-4],["color","darkorange"]]),n=new Map([["type","GLOW"],["shape","GLOW_circle"],["toneCenter",0],["toneInner",.1],["toneMid",.2],["toneOuter",.99],["toneEdge",1],["rotate",0],["feBlur",0],["opacity",.5],["size",700],["distance",0],["color","yellow"]]);flareSettingsGLOW.push(e),flareSettingsGLOW.push(n),makeFlares(flareSettingsGLOW)}if(1==activeCheckboxBOKEH)if(flareSettingsBOKEH)arrayCheck(flareSettingsBOKEH);else{console.log("[ GLIFTEK ]: Lens Flare Deluxe Bokeh settings missing. Using default settings."),(flareSettingsBOKEH=[]).name="flareSettingsBOKEH";const e=new Map([["type","BOKEH"],["shape","BOKEH_hexagon"],["vert",0],["rotate",0],["feBlur",.2],["opacity",.6],["size",1],["distance",.9],["color","cyan"]]),n=new Map([["type","BOKEH"],["shape","BOKEH_hexagon"],["vert",2],["rotate",0],["feBlur",.2],["opacity",.6],["size",1],["distance",0],["color","cyan"]]);flareSettingsBOKEH.push(e),flareSettingsBOKEH.push(n),makeFlares(flareSettingsBOKEH)}}function arrayCheck(e){if(Array.isArray(e))Array.isArray(e)&&(e.name="flareSettings"+e[0].get("type"),makeFlares(e));else{const n=[];n.name="flareSettings"+e.get("type"),n.push(e),console.log("settings:",n),makeFlares(n)}}function svgUriEncode(e){let n=encodeURIComponent(" <svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' "+e+"</svg>");return"data:image/svg+xml,".concat(n)}function makeFlares(flareSettings){let textureFlare,flareSettingsIterations=flareSettings.length;for(let i=0;i<flareSettingsIterations;i++){const item=flareSettings[i],itemType=item.get("type"),itemDistance=item.get("distance");let args,flareArgsRAYS=[],flareArgsGLOW=[],flareArgsBOKEH=[];function makeArgsList(e,n){return e.forEach(e=>n.push(item.get(e))),n}function flareCaseFunction(flareType){makeFlareElement(makeTextureFlare(makeArgsList(eval(`LIST_flareArgs${flareType}`),eval(`flareArgs${flareType}`))),eval(`flareMasterSize${flareType}`)*flareMasterSize,itemDistance,ifLastSettingsIteration)}switch(itemType){case"RAYS":case"GLOW":flareCaseFunction(itemType);break;case"BOKEH":const e=[60,70,120,70];let n;n=0!==itemDistance?[.6*itemDistance,.7*itemDistance,.9*itemDistance,2*itemDistance]:[.6,.7,.9,2];const t=e.length;for(let o=0;o<t;o++)makeFlareElement(makeTextureFlare(makeArgsList(LIST_flareArgsBOKEH,flareArgsBOKEH)),e[o]*flareMasterSizeBOKEH*flareMasterSize*1.5,n[o],ifLastSettingsIteration,o)}function makeTextureFlare(args){let shapeOrType;shapeOrType="BOKEH"==itemType?"type":"shape";const svgCodeName="svgCode_"+item.get(shapeOrType);console.log("svgCodeName, args",svgCodeName,...args);const svgData=eval(svgCodeName)(...args),textureFlare=textureLoader.load(svgData);return textureFlare.name="textureFlare"+itemType+"_"+i,textureFlare}function makeFlareElement(textureFlare,sizeMultiplier,itemDistance,callback,iteration){const flareColor=new THREE.Color(item.get("color")),newFlare=new THREE.LensflareElement(textureFlare,item.get("size")*sizeMultiplier,itemDistance,flareColor);"BOKEH"!==itemType&&(iteration=i),newFlare.name="lensFlare"+itemType+"_"+iteration;let list="LIST_lensFlare"+itemType;eval(list).push(newFlare),callback(itemType)}function ifLastSettingsIteration(){i+1==flareSettingsIterations&&readyToAddFunc(itemType)}function readyToAddFunc(e){switch(e){case"RAYS":readyToAddRAYS=!0;break;case"GLOW":readyToAddGLOW=!0;break;case"BOKEH":readyToAddBOKEH=!0}}}}function createLensFlareObject(){(lensflare=new THREE.Lensflare).name=nameInput,light.add(lensflare)}function waitToAddAllFlares(){createLensFlareObject();var e=setInterval(()=>{1==readyToAddRAYS&&1==readyToAddGLOW&&1==readyToAddBOKEH&&(clearInterval(e),function(){function e(){1==activeCheckboxGLOW?addLensFlareElementsToLensFlareObject(LIST_lensFlareGLOW,n):n()}function n(){1==activeCheckboxBOKEH?addLensFlareElementsToLensFlareObject(LIST_lensFlareBOKEH,done):done()}1==activeCheckboxRAYS?addLensFlareElementsToLensFlareObject(LIST_lensFlareRAYS,e):e()}())},100)}function addLensFlareElementsToLensFlareObject(e,n){for(let t=0;t<e.length;t++){let o=e[t];lensflare.addElement(o),console.log("lensflare",lensflare),t==e.length-1&&n()}}function done(){}function svgCode_RAYS(e,n,t,o,r,a,i,s){0!==r&&(r>10||r<1)&&(console.log('[ GLIFTEK ]: Lens Flare Rays Settings puzzle "random ray lengths" input must be between 1 and 10. Set to 0 to disable. Setting to 0.'),alert('[ GLIFTEK ]: Lens Flare Rays Settings puzzle "random ray lengths" input must be between 1 and 10. Set to 0 to disable. Setting to 0'));let l="",c="";function _(n){return`<g transform=\n            'rotate(${360/e*n},300,300)'>\n            <use \n            class='rayUse' \n            xlink:href='#raySymbol'\t\t\t\t\n            transform='scale(${function(e){return 0==e?1:e>10||e<1?1:.1*(Math.floor(Math.random()*e)+1)}(r)},${t})'/>\n            </g>`}if(1==n){c="",e%2!=0&&(e++,console.log('[ GLIFTEK ] Lens Flare Rays Settings: Only an even number of rays can be symmetrical. Changing "ray count" up to: ',e));for(let n=0;n<e/2;n++)l+=_(n)}else if(0==n){c="mask:url(#mask)";for(let n=0;n<e;n++)l+=_(n)}return svgUriEncode(`\n            width='600'\n            height='600' \n            viewBox='0 0 600 600'>\n\n            <style type="text/css"> \n            .rayUse {\n                transform-origin: center;\n            }\n            .rayElipse {\n                mix-blend-mode:screen;\n                fill:url(#radial-gradient);\n            }\n            </style>\n\n                <defs>\n\n                    <mask id="mask"> \n                        <rect x='0' y='285' width='300' height='30' fill='#ffffff' /> \n                    </mask>\n\n                    <radialGradient id='radial-gradient' \n\n                        cx='300' \n                        cy='300' \n                        r='150'\n\n                        gradientTransform='translate(-300 290.9) scale(2 0.03)' gradientUnits='userSpaceOnUse'\n                        >\n                        \n                        <stop offset='0.15' \n                        stop-color='#fff' \n                        stop-opacity='1'\n                        />\n\n                        <stop offset='${1-.1*o}' \n                        stop-color='#fff' \n                        stop-opacity='0'\n                        />\n\n                    </radialGradient>\n                \n                    <filter id='blur' x='-.1' y='-.1' >\n                    <feGaussianBlur in='SourceGraphic' stdDeviation='${i}' />\n                    </filter>\n                </defs>\n                <g style="isolation:isolate">\n                    <symbol id='raySymbol' viewBox='0 0 600 600' >\n                        <g style='${c}' \n                        transform='\n                        translate(0,0)\n                        '>\n                            <ellipse class='rayElipse' cx='300' cy='300' rx='300' ry='5' />\n                        </g>\n                    </symbol>\n                </g>\n                \n                <g ${`transform='rotate(${a},300,300)' opacity='${s*flareMasterOpacityRAYS*flareMasterOpacity}' filter='url(#blur)'`}> ${l} </g>\n            \n        `)}function svgCode_GLOW_hexagon(e,n,t,o,r,a,i,s){let l=svgUriEncode(`\n\n        width='100'\n        height='100'\n        viewBox='-10 -10 110 110'>\n\n        <defs>\n        <filter id='blur' x='-.1' y='-.1' >\n        <feGaussianBlur in='SourceGraphic' stdDeviation='${i}' />\n        </filter>\n        </defs>\n        ${BOKEH_hexagon}\n        \n        id='glow' \n        style='fill:gray'\n        filter='url(#blur)' \n        transform='rotate(${a},50,50)'\n        opacity='${s*flareMasterOpacityGLOW*flareMasterOpacity}'\t\t\n        />\n\n        <g > <use xlink:href='#glow' /> </g>\n            \n        `);return console.log("result from svgCode_GLOW_hexagon: ",l),l}function svgCode_GLOW_circle(e,n,t,o,r,a,i,s){return svgUriEncode(`\n\n        width='100'\n        height='100'\n        viewBox='0 0 100 100'>\n\n        <defs>\n        <radialGradient id='radial-gradient' cx='50' cy='50' r='50' gradientUnits='userSpaceOnUse'>\n\n        <stop offset='${e}' style='stop-color: #000; stop-opacity: 0'/>\n        <stop offset='${n}' style='stop-color: #fff; stop-opacity: .5'/>\n        <stop offset='${t}' style='stop-color: #fff; stop-opacity: 1'/>\n        <stop offset='${o}' style='stop-color: #fff; stop-opacity: .5'/>\n        <stop offset='${r}' style='stop-color: #fff; stop-opacity: 0'/>\n\n        </radialGradient>\n\n        <g style='isolation:isolate'>\n\n            <g id='glow'>\n\n                <circle cx='50' cy='50' r='50' style='mix-blend-mode:screen;fill:url(#radial-gradient)' />\n\n            </g>\n\n        </g>\n\n        </defs>\n        <g > ${`<use xlink:href='#glow' opacity='${s*flareMasterOpacityGLOW}'/>`} </g>\n            \n        `)}function svgCode_GLOW_ellipse(e,n,t,o,r,a,i,s){return svgUriEncode(`\n\n        width='100'\n        height='100'\n        viewBox='0 0 100 100'>\n\n        <defs>\n        <radialGradient id='radial-gradient' cx='50' cy='50' r='50' gradientUnits='userSpaceOnUse'>\n\n        <stop offset='${e}' style='stop-color: #000; stop-opacity: 0'/>\n        <stop offset='${n}' style='stop-color: #fff; stop-opacity: .5'/>\n        <stop offset='${t}' style='stop-color: #fff; stop-opacity: 1'/>\n        <stop offset='${o}' style='stop-color: #fff; stop-opacity: .5'/>\n        <stop offset='${r}' style='stop-color: #fff; stop-opacity: 0'/>\n\n        </radialGradient>\n\n        <g style='isolation:isolate'>\n\n            <g id='glow'>\n\n                <ellipse cx='50' cy='50' rx='50' ry='25' style='mix-blend-mode:screen;fill:url(#radial-gradient)' />\n\n            </g>\n\n        </g>\n\n        </defs>\n        <g > ${`<use xlink:href='#glow' opacity='${s*flareMasterOpacityGLOW}'/>`} </g>\n            \n        `)}function svgCode_GLOW_square(e,n,t,o,r,a,i,s){return svgUriEncode(`\n\n        width='100'\n        height='100'\n        viewBox='0 0 100 100'>\n\n        <defs>\n        <radialGradient id='radial-gradient' cx='50' cy='50' r='50' gradientUnits='userSpaceOnUse'>\n        \n        <stop offset='${e}' style='stop-color: #000; stop-opacity: 0'/>\n        <stop offset='${n}' style='stop-color: #fff; stop-opacity: .5'/>\n        <stop offset='${t}' style='stop-color: #fff; stop-opacity: 1'/>\n        <stop offset='${o}' style='stop-color: #fff; stop-opacity: .5'/>\n        <stop offset='${r}' style='stop-color: #fff; stop-opacity: 0'/>\n\n        </radialGradient>\n\n        <g style='isolation:isolate'>\n        <g id='glow'>\n\n        <rect cx='50' cy='50' r='50' style='mix-blend-mode:screen;fill:url(#radial-gradient)' />\n\n        </g>\n        </g>\n        </defs>\n        <g > ${`<use xlink:href='#glow' opacity='${s*flareMasterOpacityGLOW*flareMasterOpacity}'/>`} </g>\n            \n        `)}function svgCode_BOKEH(shape,color,vert,rotate,feBlur,opacity){const width=100,height=100,vBminX=0,vBminY=0,vBwidth=100,vBheight=100,translateX=0,translateY=0,scaleX=1,scaleY=1;let result=svgUriEncode(`\n            width='${width}'\n            height='${height}'\n            viewBox='${vBminX} ${vBminY}\n            ${vBwidth} ${vBheight}'>\n            <defs>\n                <filter id="blur" x="-.1" y="-.1" >\n                <feGaussianBlur in='SourceGraphic' stdDeviation='${feBlur}' />\n                </filter>\n            </defs>\n            ${eval(shape)} \n            style='fill:${color}'\n            opacity='\n            ${opacity*flareMasterOpacityBOKEH*flareMasterOpacity}'\n            filter='url(#blur)'\n            transform='\n            translate(${translateX},${translateY})\n            scale(${scaleX},${scaleY})\n            rotate(${rotate},${width/2},${height/2})\n        '/>\n        `);return result}function loadAllLensFlareTextures(){MAP_LF_Bokeh_Polygons.set("line","<line x1='50' y1='20' x2='80' y2='50' style ='stroke:gray;stroke-width:5'"),MAP_LF_Bokeh_Polygons.set("circle","<circle cx='50' cy='50' r='50' "),MAP_LF_Bokeh_Polygons.set("ellipse","<ellipse cx='50' cy='50' rx='50' ry='25' "),MAP_LF_Bokeh_Polygons.set("triangle","<polygon points='50 20 84.64 80 15.36 80 50 20'"),MAP_LF_Bokeh_Polygons.set("square","<rect x='20' y='20' width='60' height='60'"),MAP_LF_Bokeh_Polygons.set("pentagon","<polygon points='50 13.82 88.04 41.46 73.51 86.18 26.49 86.18 11.96 41.46 50 13.82'"),MAP_LF_Bokeh_Polygons.set("hexagon","<polygon points = '50.04 10 84.66 30.04 84.62 70.04 49.96 90 15.34 69.96 15.38 29.96 50.04 10'"),MAP_LF_Bokeh_Polygons.set("heptagon","<polygon points='50 11.98 81.27 27.04 89 60.88 67.36 88.02 32.65 88.02 11 60.88 18.73 27.04 50 11.98'"),MAP_LF_Bokeh_Polygons.set("octagon","<polygon points='65.31 13.04 86.95 34.69 86.95 65.31 65.31 86.95 34.69 86.95 13.04 65.31 13.04 34.69 34.69 13.04 65.31 13.04'"),MAP_LF_Bokeh_Polygons.set("nonagon","<polygon points='50 11.21 75.71 20.56 89.39 44.26 84.64 71.21 63.68 88.79 36.32 88.79 15.36 71.21 10.61 44.26 24.29 20.56 50 11.21'"),BOKEH_line=MAP_LF_Bokeh_Polygons.get("line"),BOKEH_circle=MAP_LF_Bokeh_Polygons.get("circle"),BOKEH_ellipse=MAP_LF_Bokeh_Polygons.get("ellipse"),BOKEH_triangle=MAP_LF_Bokeh_Polygons.get("triangle"),BOKEH_square=MAP_LF_Bokeh_Polygons.get("square"),BOKEH_pentagon=MAP_LF_Bokeh_Polygons.get("pentagon"),BOKEH_hexagon=MAP_LF_Bokeh_Polygons.get("hexagon"),BOKEH_heptagon=MAP_LF_Bokeh_Polygons.get("heptagon"),BOKEH_octagon=MAP_LF_Bokeh_Polygons.get("octagon"),BOKEH_nonagon=MAP_LF_Bokeh_Polygons.get("nonagon")}function lensFlareJS(){!function(){class e extends THREE.Mesh{constructor(){super(e.Geometry,new THREE.MeshBasicMaterial({opacity:0,transparent:!0})),this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;const t=new THREE.Vector3,o=new THREE.Vector3,r=new THREE.DataTexture(new Uint8Array(768),16,16,THREE.RGBFormat);r.minFilter=THREE.NearestFilter,r.magFilter=THREE.NearestFilter,r.wrapS=THREE.ClampToEdgeWrapping,r.wrapT=THREE.ClampToEdgeWrapping;const a=new THREE.DataTexture(new Uint8Array(768),16,16,THREE.RGBFormat);a.minFilter=THREE.NearestFilter,a.magFilter=THREE.NearestFilter,a.wrapS=THREE.ClampToEdgeWrapping,a.wrapT=THREE.ClampToEdgeWrapping;const i=e.Geometry,s=new THREE.RawShaderMaterial({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:"\n\n                    precision highp float;\n\n                    uniform vec3 screenPosition;\n                    uniform vec2 scale;\n\n                    attribute vec3 position;\n\n                    void main() {\n\n                        gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );\n\n                    }",fragmentShader:"\n\n                    precision highp float;\n\n                    void main() {\n\n                        gl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );\n\n                    }",depthTest:!0,depthWrite:!1,transparent:!1}),l=new THREE.RawShaderMaterial({uniforms:{map:{value:r},scale:{value:null},screenPosition:{value:null}},vertexShader:"\n\n                    precision highp float;\n\n                    uniform vec3 screenPosition;\n                    uniform vec2 scale;\n\n                    attribute vec3 position;\n                    attribute vec2 uv;\n\n                    varying vec2 vUV;\n\n                    void main() {\n\n                        vUV = uv;\n\n                        gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );\n\n                    }",fragmentShader:"\n\n                    precision highp float;\n\n                    uniform sampler2D map;\n\n                    varying vec2 vUV;\n\n                    void main() {\n\n                        gl_FragColor = texture2D( map, vUV );\n\n                    }",depthTest:!1,depthWrite:!1,transparent:!1}),c=new THREE.Mesh(i,s),_=[],u=n.Shader,p=new THREE.RawShaderMaterial({uniforms:{map:{value:null},occlusionMap:{value:a},color:{value:new THREE.Color(16777215)},scale:{value:new THREE.Vector2},screenPosition:{value:new THREE.Vector3}},vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1}),d=new THREE.Mesh(i,p);this.addElement=function(e){_.push(e)};const f=new THREE.Vector2,g=new THREE.Vector2,E=new THREE.Box2,m=new THREE.Vector4;this.onBeforeRender=function(e,n,u){e.getCurrentViewport(m);const T=m.w/m.z,S=m.z/2,y=m.w/2;let v=16/m.w;if(f.set(v*T,v),E.min.set(m.x,m.y),E.max.set(m.x+(m.z-16),m.y+(m.w-16)),o.setFromMatrixPosition(this.matrixWorld),o.applyMatrix4(u.matrixWorldInverse),!(o.z>0)&&(t.copy(o).applyMatrix4(u.projectionMatrix),g.x=m.x+t.x*S+S-8,g.y=m.y+t.y*y+y-8,E.containsPoint(g))){e.copyFramebufferToTexture(g,r);let n=s.uniforms;n.scale.value=f,n.screenPosition.value=t,e.renderBufferDirect(u,null,i,s,c,null),e.copyFramebufferToTexture(g,a),(n=l.uniforms).scale.value=f,n.screenPosition.value=t,e.renderBufferDirect(u,null,i,l,c,null);const o=2*-t.x,E=2*-t.y;for(let n=0,r=_.length;n<r;n++){const r=_[n],a=p.uniforms;a.color.value.copy(r.color),a.map.value=r.texture,a.screenPosition.value.x=t.x+o*r.distance,a.screenPosition.value.y=t.y+E*r.distance,v=r.size/m.w;const s=m.w/m.z;a.scale.value.set(v*s,v),p.uniformsNeedUpdate=!0,e.renderBufferDirect(u,null,i,p,d,null)}}},this.dispose=function(){s.dispose(),l.dispose(),p.dispose(),r.dispose(),a.dispose();for(let e=0,n=_.length;e<n;e++)_[e].texture.dispose()}}}e.prototype.isLensflare=!0;class n{constructor(e,n=1,t=0,o=new THREE.Color(16777215)){this.texture=e,this.size=n,this.distance=t,this.color=o}}n.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:"\n\n            precision highp float;\n\n            uniform vec3 screenPosition;\n            uniform vec2 scale;\n\n            uniform sampler2D occlusionMap;\n\n            attribute vec3 position;\n            attribute vec2 uv;\n\n            varying vec2 vUV;\n            varying float vVisibility;\n\n            void main() {\n\n                vUV = uv;\n\n                vec2 pos = position.xy;\n\n                vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\n\n                vVisibility =        visibility.r / 9.0;\n                vVisibility *= 1.0 - visibility.g / 9.0;\n                vVisibility *=       visibility.b / 9.0;\n\n                gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n\n            }",fragmentShader:"\n\n            precision highp float;\n\n            uniform sampler2D map;\n            uniform vec3 color;\n\n            varying vec2 vUV;\n            varying float vVisibility;\n\n            void main() {\n\n                vec4 texture = texture2D( map, vUV );\n                texture.a *= vVisibility;\n                gl_FragColor = texture;\n                gl_FragColor.rgb *= color;\n\n            }"},e.Geometry=function(){const e=new THREE.BufferGeometry,n=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),t=new THREE.InterleavedBuffer(n,5);return e.setIndex([0,1,2,0,2,3]),e.setAttribute("position",new THREE.InterleavedBufferAttribute(t,3,0,!1)),e.setAttribute("uv",new THREE.InterleavedBufferAttribute(t,2,3,!1)),e}(),THREE.Lensflare=e,THREE.LensflareElement=n}()}function promiseFunctionOBJ(e,n){var t;(t=Date.now(),new Promise(function n(o,r){console.log("[ GLIFTEK Plugins ]:\n'",puzzleName,"'puzzle is looking for",e),app.scene.getObjectByName(e)?o(app.scene.getObjectByName(e)):Date.now()-t>=1e4?(r(new Error("timeout.",e,"not found!")),console.log("[ GLIFTEK Plugins ]:\n 'timeout.'",e,"not found!"),alert("[ GLIFTEK Plugins ]:\n 'timeout.'",e,"not found!")):setTimeout(n.bind(this,o,r),30)})).then(function(){n(e)})}function promiseFunctionVAR(e,n){var t;(t=Date.now(),new Promise(function n(o,r){console.log("[ GLIFTEK Plugins ]:\n'",puzzleName,"'puzzle is looking for",e),"undefined"!==e?(o(e),console.log("[ GLIFTEK Plugins ]:",e.name,"found!")):Date.now()-t>=1e4?(r(new Error("timeout.",e,"not found!")),console.log("[ GLIFTEK Plugins ]:\n 'timeout.'",e,"not found!"),alert("[ GLIFTEK Plugins ]:\n 'timeout.'",e,"not found!")):setTimeout(n.bind(this,o,r),30)})).then(function(){n(e)})}window.lensflareJS_var||(window.lensflareJS_var=lensFlareJS()),checkboxFALSEcheck()}objInput&&"<none>"!=objInput?mainFunction():console.log("[ GLIFTEK ]: The ",puzzleName,"plugin puzzle is missing an input!")}.apply(null,arguments)}function LENS_FLARE_DELUXE_1(){createLenseFlareFunction("myLensFlare_A","Lens_Flare_Point_Light",!0,RAYS_01,1.5,.95,!0,GLOW_01,1,.95,!0,BOKEH_01,.75,.75,.65,.95)}function lensFlareSettingsRAYS(){return function(e,n,t,o,r,a,i,s,l,c,_,u){return new Map([["type","RAYS"],["shape","RAYS"],["rays",e],["nameInput",n],["symmetrical",t],["rayWidth",o],["raySharpness",r],["randomSeed",a],["rotate",i],["feBlur",s],["opacity",l],["size",c],["distance",_],["color",u]])}.apply(null,arguments)}function INIT_RAYS_SETTINGS_1(){RAYS_01=[lensFlareSettingsRAYS(6,"name",!0,3,0,9,0,.1,.9,900,0,"#ffff66"),lensFlareSettingsRAYS(9,"name",!1,3,1,3,0,.1,.9,1200,.001,"#ffcc66"),lensFlareSettingsRAYS(64,"name",!0,3,0,5,23,2,.5,500,.002,"#ffffcc")]}function lensFlareSettingsBOKEH(){return function(e,n,t,o,r,a,i,s){return new Map([["type","BOKEH"],["shape",e],["vert",n],["rotate",t],["feBlur",o],["opacity",r],["size",a],["distance",i],["color",s]])}.apply(null,arguments)}function INIT_BOKEH_SETTINGS_1(){BOKEH_01=[lensFlareSettingsBOKEH("BOKEH_hexagon",0,0,.2,.6,1,.9,"#ff9900"),lensFlareSettingsBOKEH("BOKEH_hexagon",0,0,.8,.5,2,0,"#ffff00")]}function SET_VARIABLES(){lens_flare_counter=1,LIST_bg_images=["./img/bg_clouds_pink_purple.jpg","./img/bg_blue_dark_cloudy.jpg","./img/bg_clouds_godrays_02.jpg"],GLOW_2=null,center_alpha_distance_02=null}function notIgnoredObj(e){return!("AmbientLight"===e.type||""===e.name||e.isMesh&&e.isMaterialGeneratedMesh||e.isAuxClippingMesh)}function getObjectByName(e){var n,t=void 0!==_pGlob;return(n=t?_pGlob.objCache[e]:null)&&n.name===e?n:(appInstance.scene.traverse(function(o){!n&&notIgnoredObj(o)&&o.name==e&&(n=o,t&&(_pGlob.objCache[e]=n))}),n)}function getAllObjectNames(){var e=[];return appInstance.scene.traverse(function(n){notIgnoredObj(n)&&e.push(n.name)}),e}function getObjectNamesByGroupName(e){var n=[];return appInstance.scene.traverse(function(t){if(notIgnoredObj(t)){var o=t.groupNames;if(!o)return;for(var r=0;r<o.length;r++){o[r]==e&&n.push(t.name)}}}),n}function retrieveObjectNames(e){var n=[];return retrieveObjectNamesAcc(e,n),n.filter(function(e){return e})}function retrieveObjectNamesAcc(e,n){if("string"==typeof e)n.push(e);else if(Array.isArray(e)&&"GROUP"==e[0])for(var t=getObjectNamesByGroupName(e[1]),o=0;o<t.length;o++)n.push(t[o]);else if(Array.isArray(e)&&"ALL_OBJECTS"==e[0])for(t=getAllObjectNames(),o=0;o<t.length;o++)n.push(t[o]);else if(Array.isArray(e))for(o=0;o<e.length;o++)retrieveObjectNamesAcc(e[o],n)}function getCoordSystem(){var e=appInstance.scene;return e&&"v3d"in e.userData&&"coordSystem"in e.userData.v3d?e.userData.v3d.coordSystem:"Z_UP_RIGHT"}function coordsTransform(e,n,t,o){if(n==t)return e;var r=e.y,a=e.z;return"Z_UP_RIGHT"==n&&"Y_UP_RIGHT"==t?(e.y=a,e.z=o?r:-r):"Y_UP_RIGHT"==n&&"Z_UP_RIGHT"==t?(e.y=o?a:-a,e.z=r):console.error("coordsTransform: Unsupported coordinate space"),e}var eulerV3DToBlenderShortest=(eulerTmp=new v3d.Euler,eulerTmp2=new v3d.Euler,vec3Tmp=new v3d.Vector3,function(e,n){var t=eulerTmp.copy(e).reorder("YZX"),o=eulerTmp2.copy(t).makeAlternative(),r=t.toVector3(vec3Tmp).lengthSq(),a=o.toVector3(vec3Tmp).lengthSq();return n.copy(r<a?t:o),coordsTransform(n,"Y_UP_RIGHT","Z_UP_RIGHT")}),eulerTmp,eulerTmp2,vec3Tmp;function RotationInterface(){this._userRotation=new v3d.Euler(0,0,0,"ZYX"),this._actualRotation=new v3d.Euler}function setObjTransform(e,n,t,o){var r=t[0],a=t[1],i=t[2],s=retrieveObjectNames(e);function l(e,t,r){o?"scale"!=n?e[n][t]+=r:e[n][t]*=r:e[n][t]=r}var c=_pGlob.vec3Tmp.set(Number(""!==r),Number(""!==a),Number(""!==i)),_=_pGlob.vec3Tmp2.set(r||0,a||0,i||0);"rotation"===n&&_.multiplyScalar(v3d.MathUtils.DEG2RAD);var u=getCoordSystem();coordsTransform(c,u,"Y_UP_RIGHT",!0),coordsTransform(_,u,"Y_UP_RIGHT","scale"===n);for(var p=0;p<s.length;p++){var d=s[p];if(d){var f=getObjectByName(d);if(f){if("rotation"===n&&"Z_UP_RIGHT"==u)coordsTransform(E=eulerV3DToBlenderShortest(f.rotation,_pGlob.eulerTmp),u,"Y_UP_RIGHT"),c.x&&(E.x=o?E.x+_.x:_.x),c.y&&(E.y=o?E.y+_.y:_.y),c.z&&(E.z=o?E.z+_.z:_.z),E.order="YZX",E.reorder(f.rotation.order),f.rotation.copy(E);else if("rotation"===n&&"Y_UP_RIGHT"==u){var g=RotationInterface.initObject(f),E=g.getUserRotation(_pGlob.eulerTmp);c.x&&(E.x=o?E.x+_.x:_.x),c.y&&(E.y=o?E.y+_.y:_.y),c.z&&(E.z=o?E.z+_.z:_.z),g.setUserRotation(E),g.getActualRotation(f.rotation)}else c.x&&l(f,"x",_.x),c.y&&l(f,"y",_.y),c.z&&l(f,"z",_.z);f.updateMatrixWorld(!0)}}}}function tweenCamera(e,n,t,o,r){var a=appInstance.getCamera();if(Array.isArray(e))s=coordsTransform(s=_pGlob.vec3Tmp.fromArray(e),getCoordSystem(),"Y_UP_RIGHT");else if(e){var i=getObjectByName(e);if(!i)return;var s=i.getWorldPosition(_pGlob.vec3Tmp)}else s=a.getWorldPosition(_pGlob.vec3Tmp);if(Array.isArray(n)){c=coordsTransform(c=_pGlob.vec3Tmp2.fromArray(n),getCoordSystem(),"Y_UP_RIGHT")}else{var l=getObjectByName(n);if(!l)return;var c=l.getWorldPosition(_pGlob.vec3Tmp2)}t=Math.max(0,t),appInstance.controls&&appInstance.controls.tween?appInstance.controls.inTween||appInstance.controls.tween(s,c,t,o,r):(a.parent&&a.parent.worldToLocal(s),a.position.copy(s),a.lookAt(c),o())}function SET_CAM_AND_LIGHT(){setObjTransform("Lens_Flare_Point_Light","position",[2.75,224638.07,7844.53],!0),tweenCamera("","Lens_Flare_Point_Light",1e-4,function(){},0)}function lensFlareSettingsGLOW(){return function(e,n,t,o,r,a,i,s,l,c,_,u,p){return new Map([["type","GLOW"],["nameInput",e],["shape",n],["toneCenter",t],["toneInner",o],["toneMid",r],["toneOuter",a],["toneEdge",i],["rotate",s],["feBlur",l],["opacity",c],["size",_],["distance",u],["color",p]])}.apply(null,arguments)}function INIT_GLOW_SETTINGS_1(){GLOW_01=[lensFlareSettingsGLOW("name","GLOW_circle",0,0,.7,.85,1,0,.4,.4,150,0,"#ffff66"),lensFlareSettingsGLOW("name","GLOW_circle",0,0,.7,.85,1,0,.6,.4,300,0,"#ff9900")]}function objConstraintAddLimit(e,n,t,o,r,a,i,s){var l;if("DISTANCE"==t){if(!a)return;var c=getObjectByName(a);if(!c)return}l=retrieveObjectNames(n);for(var _=0;_<l.length;_++){var u=l[_];if(u){var p=getObjectByName(u);if(p&&p.constraints){for(var d=p.constraints.length-1;d>=0;d--)p.constraints[d].name==e&&p.constraints.splice(d,1);var f=getCoordSystem();switch(t){case"POS_X":case"POS_Y":case"POS_Z":if((E=new v3d.LimitLocationConstraint).name=e,"Z_UP_RIGHT"==f)var g="POS_X"==t?0:"POS_Y"==t?2:1;else g="POS_X"==t?0:"POS_Y"==t?1:2;"Z_UP_RIGHT"==f&&"POS_Y"==t?(E.min.setComponent(g,-r),E.max.setComponent(g,-o)):(E.min.setComponent(g,o),E.max.setComponent(g,r)),p.constraints.push(E);break;case"ROT_X":case"ROT_Y":case"ROT_Z":(E=new v3d.LimitRotationConstraint).name=e,E.axis="Z_UP_RIGHT"==f?"ROT_X"==t?"X":"ROT_Y"==t?"Z":"Y":"ROT_X"==t?"X":"ROT_Y"==t?"Y":"Z","Z_UP_RIGHT"==f&&"ROT_Y"==t?(E.min=v3d.MathUtils.degToRad(-r),E.max=v3d.MathUtils.degToRad(-o)):(E.min=v3d.MathUtils.degToRad(o),E.max=v3d.MathUtils.degToRad(r)),p.constraints.push(E);break;case"SCALE_X":case"SCALE_Y":case"SCALE_Z":if((E=new v3d.LimitScaleConstraint).name=e,"Z_UP_RIGHT"==f)g="SCALE_X"==t?0:"SCALE_Y"==t?2:1;else g="SCALE_X"==t?0:"SCALE_Y"==t?1:2;E.min.setComponent(g,o),E.max.setComponent(g,r),p.constraints.push(E);break;case"DISTANCE":var E;(E=new v3d.LimitDistanceConstraint(c)).name=e,E.distance=i,E.limitMode=s,p.constraints.push(E)}}}}}function CAMERA_CONSTRAINTS(){objConstraintAddLimit("myConst_Cam_pos_X","Camera","POS_X",80,80,void 0,void 0,void 0),objConstraintAddLimit("myConst_Cam_pos_Y","Camera","POS_Y",224540,224540,void 0,void 0,void 0),objConstraintAddLimit("myConst_Cam_pos_Z","Camera","POS_Z",7820,7870,void 0,void 0,void 0),objConstraintAddLimit("myConst_Cam_rot_X","Camera","ROT_X",0,0,void 0,void 0,void 0),objConstraintAddLimit("myConst_Cam_rot_Y","Camera","ROT_Y",0,2.5,void 0,void 0,void 0),objConstraintAddLimit("myConst_Cam_rot_Z","Camera","ROT_Z",6,70,void 0,void 0,void 0)}function removeObject(e){for(var n=retrieveObjectNames(e),t=0;t<n.length;t++){var o=n[t];if(o){var r=getObjectByName(o);r&&r.parent&&(r.parent.remove(r),_pGlob.objCache={})}}}function CHANGE_BG_AND_FLARE(){1==lens_flare_counter?(setImageBackground("./img/bg_clouds_pink_purple.jpg"),removeObject("myLensFlare_C"),LENS_FLARE_DELUXE_1()):2==lens_flare_counter?(setImageBackground("./img/bg_blue_dark_cloudy.jpg"),removeObject("myLensFlare_A"),LENS_FLARE_DELUXE_2()):3==lens_flare_counter&&(setImageBackground("./img/city_lights_01.jpg"),removeObject("myLensFlare_B"),LENS_FLARE_DELUXE_3())}function getElements(e,n){var t=[];if(Array.isArray(e)&&"CONTAINER"!=e[0]&&"WINDOW"!=e[0]&&"DOCUMENT"!=e[0]&&"BODY"!=e[0]&&"QUERYSELECTOR"!=e[0])for(var o=0;o<e.length;o++)t.push(getElement(e[o],n));else t.push(getElement(e,n));return t}function getElement(e,n){var t;if(Array.isArray(e)&&"CONTAINER"==e[0]){if(null!==appInstance)t=appInstance.container;else if("undefined"!=typeof _initGlob){e=_initGlob.container;t=n?parent.document.getElementById(e):document.getElementById(e)}}else t=Array.isArray(e)&&"WINDOW"==e[0]?n?parent:window:Array.isArray(e)&&"DOCUMENT"==e[0]?n?parent.document:document:Array.isArray(e)&&"BODY"==e[0]?n?parent.document.body:document.body:Array.isArray(e)&&"QUERYSELECTOR"==e[0]?n?parent.document.querySelector(e):document.querySelector(e):n?parent.document.getElementById(e):document.getElementById(e);return t}function setHTMLElemStyle(e,n,t,o){for(var r=getElements(t,o),a=0;a<r.length;a++){var i=r[a];i&&i.style&&(i.style[e]=n)}}function initObjectPicking(e,n,t,o){var r=appInstance.renderer.domElement;if(r.addEventListener(n,c),v3d.PL.editorEventListeners&&v3d.PL.editorEventListeners.push([r,n,c]),"mousedown"==n){var a=t?"touchstart":"touchend";r.addEventListener(a,c),v3d.PL.editorEventListeners&&v3d.PL.editorEventListeners.push([r,a,c])}else if("dblclick"==n){var i=0;function s(e){var n=(new Date).getTime()-i;if(n<600&&n>0)return c(e),void(i=0);i=(new Date).getTime()}a=t?"touchstart":"touchend";r.addEventListener(a,s),v3d.PL.editorEventListeners&&v3d.PL.editorEventListeners.push([r,a,s])}var l=new v3d.Raycaster;function c(n){if(appInstance.getCamera()){n.preventDefault();var t=0,a=0;if(n instanceof MouseEvent){if(o&&-1==o.indexOf(n.button))return;t=n.offsetX/r.clientWidth,a=n.offsetY/r.clientHeight}else if(n instanceof TouchEvent){var i=r.getBoundingClientRect();t=(n.changedTouches[0].clientX-i.left)/i.width,a=(n.changedTouches[0].clientY-i.top)/i.height}_pGlob.screenCoords.x=2*t-1,_pGlob.screenCoords.y=2*-a+1,l.setFromCamera(_pGlob.screenCoords,appInstance.getCamera(!0));var s=[];appInstance.scene.traverse(function(e){s.push(e)});var c=l.intersectObjects(s);e(c,n)}}}function objectsIncludeObj(e,n){if(!n)return!1;for(var t=0;t<e.length;t++){if(n==e[t])return!0;var o=getObjectByName(e[t]);if(o&&"Group"==o.type)for(var r=0;r<o.children.length;r++)if(n==o.children[r].name)return!0}return!1}function getPickedObjectName(e){return e.isMesh&&e.isMaterialGeneratedMesh&&e.parent?e.parent.name:e.name}function registerOnHover(e,n,t,o){_pGlob.objHoverInfo=_pGlob.objHoverInfo||[],_pGlob.objHoverInfo.push({objSelector:e,callbacks:[t,o],xRay:n})}function registerOnClick(e,n,t,o,r,a){_pGlob.objClickInfo=_pGlob.objClickInfo||[],_pGlob.objClickInfo.push({objSelector:e,callbacks:[r,a]}),initObjectPicking(function(t,o){for(var i=!1,s=n?t.length:Math.min(1,t.length),l=0;l<s;l++){var c=getPickedObjectName(t[l].object);objectsIncludeObj(retrieveObjectNames(e),c)&&(_pGlob.pickedObject=c,i=!0,r(o))}i||(_pGlob.pickedObject="",a(o))},t?"dblclick":"mousedown",!1,o)}function CLICK_NEXT_BUTTON(){registerOnHover("hitbox",!0,function(){setHTMLElemStyle("cursor","pointer",["CONTAINER"],!1)},function(){setHTMLElemStyle("cursor","default",["CONTAINER"],!1)}),registerOnClick("hitbox",!0,!1,[0,1,2],function(){SWITCH_FLARE()},function(){})}function LENS_FLARE_DELUXE_2(){createLenseFlareFunction("myLensFlare_B","Lens_Flare_Point_Light",!0,RAYS_2,.4,.75,!0,GLOW_2,.125,.6,!0,BOKEH_2,1,.95,2.25,.8)}function INIT_RAYS_SETTINGS_2(){RAYS_2=[lensFlareSettingsRAYS(2,"anamorphic",!0,.7,8,0,0,0,.9,1e4,0,"#3366ff"),lensFlareSettingsRAYS(32,"shimmer_1",!1,.5,3,2.5,23,0,.8,2400,.002,"#3366ff"),lensFlareSettingsRAYS(32,"shimmer_2",!1,.5,3,2.5,45,0,.8,2400,.002,"#33ccff"),lensFlareSettingsRAYS(64,"shimmer_3",!1,.25,0,4,0,0,.8,1600,.003,"#99ffff")]}function INIT_BOKEH_SETTINGS_2(){BOKEH_2=[lensFlareSettingsBOKEH("BOKEH_triangle",0,15,.2,.5,1,.9,"#ccffff"),lensFlareSettingsBOKEH("BOKEH_triangle",0,15,.2,.3,.5,.5,"#66ffff")]}function INIT_GLOW_SETTINGS_2(){GLOW_2=[lensFlareSettingsGLOW("inner glow","GLOW_hexagon",0,.2,.7,1,1,0,4,.9,350,0,"#ccffff"),lensFlareSettingsGLOW("outer circle","GLOW_circle",.55,.65,.85,.95,1,0,7,.4,1500,0,"#00ffff"),lensFlareSettingsGLOW("accent elipse","GLOW_ellipse",.55,.65,.85,.95,1,0,7,.2,1500,0,"#00ffff")]}function LENS_FLARE_DELUXE_3(){createLenseFlareFunction("myLensFlare_C","Lens_Flare_Point_Light",!0,RAYS_3,.4,.9,!0,GLOW_3,.5,.9,!0,BOKEH_3,1,.95,1,.8)}function INIT_RAYS_SETTINGS_3(){RAYS_3=[lensFlareSettingsRAYS(32,"shimmer_1",!1,1,3,2.5,23,0,.8,6e3,.002,"#ff6600"),lensFlareSettingsRAYS(32,"shimmer_2",!1,5,3,8,45,0,.8,2400,.002,"#993300")]}function INIT_BOKEH_SETTINGS_3(){BOKEH_3=[lensFlareSettingsBOKEH("BOKEH_ellipse",0,0,.2,.5,1,.9,"#ffff99"),lensFlareSettingsBOKEH("BOKEH_ellipse",0,0,.2,.3,.5,.5,"#ffff66")]}function INIT_GLOW_SETTINGS_3(){GLOW_3=[lensFlareSettingsGLOW("inner glow","GLOW_circle",0,.2,.5,.6,.7,0,10,.9,600,0,"#ffcc66"),lensFlareSettingsGLOW("name","GLOW_circle",0,.2,.7,.8,.9,0,4,.5,800,0,"#cc9933")]}Object.assign(RotationInterface,{initObject:function(e){void 0===e.userData.v3d.puzzles&&(e.userData.v3d.puzzles={}),void 0===e.userData.v3d.puzzles.rotationInterface&&(e.userData.v3d.puzzles.rotationInterface=new RotationInterface);var n=e.userData.v3d.puzzles.rotationInterface;return n.updateFromObject(e),n}}),Object.assign(RotationInterface.prototype,{updateFromObject:function(e){this._actualRotation.equalsEps(e.rotation,1e-8)||(this._actualRotation.copy(e.rotation),this._updateUserRotFromActualRot())},getActualRotation:function(e){return e.copy(this._actualRotation)},setUserRotation:function(e){this._userRotation.set(e.x,e.y,e.z),this._updateActualRotFromUserRot()},getUserRotation:function(e){return e.copy(this._userRotation)},_updateUserRotFromActualRot:function(){var e=this._userRotation.order;this._userRotation.copy(this._actualRotation).reorder(e)},_updateActualRotFromUserRot:function(){var e=this._actualRotation.order;this._actualRotation.copy(this._userRotation).reorder(e)}}),initObjectPicking(function(e,n){var t=_pGlob.hoveredObject,o="";_pGlob.objHoverInfo=_pGlob.objHoverInfo||[];var r=1/0;_pGlob.objHoverInfo.forEach(function(n){for(var t=n.xRay?e.length:Math.min(1,e.length),a=0;a<t;a++){var i=getPickedObjectName(e[a].object);objectsIncludeObj(retrieveObjectNames(n.objSelector),i)&&a<=r&&(o=i,r=a)}}),t!=o&&(_pGlob.objHoverInfo.forEach(function(e){objectsIncludeObj(retrieveObjectNames(e.objSelector),t)&&(_pGlob.hoveredObject=t,e.callbacks[1](n))}),_pGlob.objHoverInfo.forEach(function(e){objectsIncludeObj(retrieveObjectNames(e.objSelector),o)&&(_pGlob.hoveredObject=o,e.callbacks[0](n))}),_pGlob.hoveredObject=o)},"mousemove",!1),MAIN()}}();