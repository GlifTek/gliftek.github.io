'use strict';(function(){var LIST_NONE="<none>",_pGlob={};_pGlob.objCache={},_pGlob.fadeAnnotations=!0,_pGlob.pickedObject="",_pGlob.hoveredObject="",_pGlob.mediaElements={},_pGlob.loadedFile="",_pGlob.states=[],_pGlob.percentage=0,_pGlob.openedFile="",_pGlob.xrSessionAcquired=!1,_pGlob.xrSessionCallbacks=[],_pGlob.screenCoords=new v3d.Vector2,_pGlob.intervalTimers={},_pGlob.AXIS_X=new v3d.Vector3(1,0,0),_pGlob.AXIS_Y=new v3d.Vector3(0,1,0),_pGlob.AXIS_Z=new v3d.Vector3(0,0,1),_pGlob.MIN_DRAG_SCALE=.001,_pGlob.SET_OBJ_ROT_EPS=1e-8,_pGlob.vec2Tmp=new v3d.Vector2,_pGlob.vec2Tmp2=new v3d.Vector2,_pGlob.vec3Tmp=new v3d.Vector3,_pGlob.vec3Tmp2=new v3d.Vector3,_pGlob.vec3Tmp3=new v3d.Vector3,_pGlob.vec3Tmp4=new v3d.Vector3,_pGlob.eulerTmp=new v3d.Euler,_pGlob.eulerTmp2=new v3d.Euler,_pGlob.quatTmp=new v3d.Quaternion,_pGlob.quatTmp2=new v3d.Quaternion,_pGlob.colorTmp=new v3d.Color,_pGlob.mat4Tmp=new v3d.Matrix4,_pGlob.planeTmp=new v3d.Plane,_pGlob.raycasterTmp=new v3d.Raycaster;var PL=v3d.PL=v3d.PL||{};v3d.puzzles=PL,PL.procedures=PL.procedures||{},PL.execInitPuzzles=function(e){var t={};t.percentage=0,t.output={initOptions:{fadeAnnotations:!0,useBkgTransp:!1,preserveDrawBuf:!1,useCompAssets:!1,useFullscreen:!0,useCustomPreloader:!1,preloaderStartCb:function(){},preloaderProgressCb:function(){},preloaderEndCb:function(){}}},t.container=void 0!==e&&"container"in e?e.container:"";return t.output.initOptions.fadeAnnotations=!0,t.output.initOptions.useBkgTransp=!1,t.output.initOptions.preserveDrawBuf=!1,t.output.initOptions.useCompAssets=!1,t.output.initOptions.useFullscreen=!0,t.output},PL.init=function(appInstance,initOptions){function SWITCH_FLARE(){lens_flare_counter=("number"==typeof lens_flare_counter?lens_flare_counter:0)+1,3>=lens_flare_counter?(console.log("lens_flare_counter: "+(lens_flare_counter+"")),SWITCH_FLARE_FADE()):3<lens_flare_counter&&(lens_flare_counter=1,console.log("lens_flare_counter reset to: "+(lens_flare_counter+"")),SWITCH_FLARE_FADE())}function setScreenScale(e){appInstance.useHiDPIRenderPass||appInstance.renderer.setPixelRatio(e),appInstance.postprocessing&&appInstance.postprocessing.composer.setPixelRatio(e),appInstance.onResize()}function MAIN(){setScreenScale(1.5),FADE_IN(),SET_VARIABLES(),SET_CAM_AND_LIGHT(),CAMERA_CONSTRAINTS(),CLICK_NEXT_BUTTON(),LENS_FLARES_PROCEDURES(),DISABLE_RENDERING()}function setImageBackground(){return function(e){(function(){let t=new THREE.TextureLoader().load(e);t.minFilter=THREE.LinearFilter,app.scene.background=t,app.scene.background.encoding=THREE.sRGBEncoding})()}.apply(null,arguments)}function LENS_FLARES_PROCEDURES(){setImageBackground("./img/bg_clouds_pink_purple.jpg"),INIT_RAYS_SETTINGS_1(),INIT_GLOW_SETTINGS_1(),INIT_BOKEH_SETTINGS_1(),INIT_RAYS_SETTINGS_2(),INIT_GLOW_SETTINGS_2(),INIT_BOKEH_SETTINGS_2(),INIT_RAYS_SETTINGS_3(),INIT_GLOW_SETTINGS_3(),INIT_BOKEH_SETTINGS_3(),LENS_FLARE_DELUXE_1()}function screenFade(){return function(screenFade_ID_Input,screenFade_Z_Index_Input,typeDropdown,screenFade_Pause_Input,screenFade_Duration_Input,colorInput_1_PICKER,colorInput_1_TEXT,delete_When_Done_Checkbox,whenDone_Statement_Input){function mainFunction(){function setColorFromInputs(e,t){let o;return"undefined"==typeof e||null==typeof e||""==e?(o=t,console.log(t,"supplied. using PICKER.")):(o=e,console.log(e,"supplied. using TEXT.")),o}function RGBA_from_color_input(e,t){if("transparent"==e||null==e||"undefined"==typeof e)return"rgba(0, 0, 0, 0)";else{computedColorDiv.style.color=e;let o=window.getComputedStyle(computedColorDiv).color;console.log("computedColor for: ",e,":",o);let n=o.length,r="rgba("+o.substring(4,n-1)+", "+t+")";return console.log("computedColor_RGBA for: ",e,":",r),r}}function getBGcolor(){"in"==typeDropdown?(screenFade_Div.style.backgroundColor="rgba(0,0,0,0)",console.log("screenFade_Div.style.backgroundColor:",screenFade_Div.style.backgroundColor)):"out"==typeDropdown&&(screenFade_Div.style.backgroundColor=screenFadeColor,console.log("screenFade_Div.style.backgroundColor:",screenFade_Div.style.backgroundColor))}function animateScreenFade(){function screenFadeDisplay(){"in"==typeDropdown?(screenFade_Div.style.display="block",console.log("screenFade_Div.style.display:",screenFade_Div.style.display),deleteWhenDone()):"out"==typeDropdown&&(screenFade_Div.style.display="none",console.log("screenFade_Div.style.display:",screenFade_Div.style.display),deleteWhenDone())}function deleteWhenDone(){!0==delete_When_Done_Checkbox&&screenFade_Div.remove()}const animationType="animation-screen-fade-"+typeDropdown+"-"+screenFade_ID_Input;screenFade_Div.style.animationName=animationType,console.log("screenFade_Div.style.animationName:",screenFade_Div.style.animationName),screenFade_Div.addEventListener("animationend",function(event){if(event.animationName==animationType);{screenFade_Div.removeEventListener("animationend",null),screenFadeDisplay();let screenFadeState=eval(`${screenFade_ID_Input}.faded = '${typeDropdown}';`);console.log("screenFadeState:",screenFadeState),whenDone_Statement_Input()}})}function setstyleVar(){return`
#computedColorDiv-${screenFade_ID_Input}{height: 0px;width: 0px;display: none;z-index = -10;}.screenFade-${screenFade_ID_Input}{display: block;position: fixed;z-index: ${screenFade_Z_Index_Input};left: 0;top: 0;height: 100%;width: 100%;overflow: hidden;pointer-events: none;animation-duration: ${screenFade_Duration_Input}s;animation-timing-function: ease-in-out;}@keyframes animation-screen-fade-in-${screenFade_ID_Input}{from {background-color: rgba(0,0,0,0);}to {background-color: ${screenFadeColor};}}@keyframes animation-screen-fade-out-${screenFade_ID_Input}{from {background-color: ${screenFadeColor};}to {background-color: rgba(0,0,0,0);}}`}const colorInput_1esc=setColorFromInputs(colorInput_1_TEXT,colorInput_1_PICKER);console.log("colorInput_1esc:",colorInput_1esc);let computedColorDiv=document.createElement("div");computedColorDiv.id="computedColorDiv-"+screenFade_ID_Input,document.body.appendChild(computedColorDiv);const screenFadeColor=RGBA_from_color_input(colorInput_1esc,1);console.log("screenFadeColor: ",screenFadeColor),computedColorDiv.remove();let styleVar=setstyleVar(),style=document.createElement("style");style.id="screenFade-"+screenFade_ID_Input,style.innerHTML=styleVar,document.head.appendChild(style);let screenFade_Div=document.createElement("div");screenFade_Div.id=screenFade_ID_Input,screenFade_Div.className="screenFade-"+screenFade_ID_Input,getBGcolor();const container=document.getElementById("v3d-container");container.appendChild(screenFade_Div),setTimeout(function(){animateScreenFade()},1e3*screenFade_Pause_Input)}const puzzleName="Print To Modal Card";eval(`window.${screenFade_ID_Input} = { faded: null };`),screenFade_ID_Input?mainFunction():console.log("[ GLIFTEK ]: The","Print To Modal Card","plugin puzzle is missing an input!")}.apply(null,arguments)}function FADE_IN(){screenFade("screenFade_1",10,"out",1.5,1,"#000000","",!0,function(){})}function enableRendering(){appInstance.enableRendering()}function disableRendering(e){appInstance.ssaaOnPause=e,appInstance.disableRendering(1)}function SWITCH_FLARE_FADE(){screenFade("screenFade_2",10,"in",0,.25,"#000000","",!0,function(){enableRendering(),CHANGE_BG_AND_FLARE(),screenFade("screenFade_3",10,"out",.5,.25,"#000000","",!0,function(){disableRendering(!0)})})}function createLenseFlareFunction(){return function(nameInput,objInput,activeCheckboxRAYS,flareSettingsRAYS,flareMasterSizeRAYS,flareMasterOpacityRAYS,activeCheckboxGLOW,flareSettingsGLOW,flareMasterSizeGLOW,flareMasterOpacityGLOW,activeCheckboxBOKEH,flareSettingsBOKEH,flareMasterSizeBOKEH,flareMasterOpacityBOKEH,flareMasterSize,flareMasterOpacity){function mainFunction(){function checkboxFALSEcheck(){0==activeCheckboxRAYS&&0==activeCheckboxGLOW&&0==activeCheckboxBOKEH?console.log("[ GLIFTEK ] Plugins: Lens Flare Deluxe all settings disabled."):function(){0==activeCheckboxRAYS&&(readyToAddRAYS=!0),!function(){0==activeCheckboxGLOW&&(readyToAddGLOW=!0),!function(){0==activeCheckboxBOKEH&&(readyToAddBOKEH=!0),init()}()}()}()}function init(){loadAllLensFlareTextures(),promiseFunctionOBJ(objInput,function(t){light=scene.getObjectByName(t),checkboxTRUEcheck(),waitToAddAllFlares()})}function checkboxTRUEcheck(){if(1==activeCheckboxRAYS)if(flareSettingsRAYS)arrayCheck(flareSettingsRAYS);else{console.log("[ GLIFTEK ]: Lens Flare Deluxe Rays settings missing. Using default settings."),(flareSettingsRAYS=[]).name="flareSettingsRAYS";const o=new Map([["type","RAYS"],["shape","RAYS"],["rays",12],["nameInput","default_rays_01"],["symmetrical",!1],["rayWidth",1],["raySharpness",.9],["randomSeed",10],["rotate",0],["feBlur",.2],["opacity",.9],["size",500],["distance",0],["color","teal"]]),e=new Map([["type","RAYS"],["shape","RAYS"],["rays",6],["nameInput","default_rays_01"],["symmetrical",!0],["rayWidth",1],["raySharpness",.9],["randomSeed",0],["rotate",0],["feBlur",.1],["opacity",.98],["size",600],["distance",0],["color","cyan"]]);flareSettingsRAYS.push(o),flareSettingsRAYS.push(e),makeFlares(flareSettingsRAYS)}if(1==activeCheckboxGLOW)if(flareSettingsGLOW)arrayCheck(flareSettingsGLOW);else{console.log("[ GLIFTEK ]: Lens Flare Deluxe Glow settings missing. Using default settings."),(flareSettingsGLOW=[]).name="flareSettingsGLOW";const o=new Map([["type","GLOW"],["shape","GLOW_circle"],["toneCenter",0],["toneInner",.2],["toneMid",.3],["toneOuter",.99],["toneEdge",1],["rotate",0],["feBlur",0],["opacity",.6],["size",300],["distance",1e-4],["color","darkorange"]]),e=new Map([["type","GLOW"],["shape","GLOW_circle"],["toneCenter",0],["toneInner",.1],["toneMid",.2],["toneOuter",.99],["toneEdge",1],["rotate",0],["feBlur",0],["opacity",.5],["size",700],["distance",0],["color","yellow"]]);flareSettingsGLOW.push(o),flareSettingsGLOW.push(e),makeFlares(flareSettingsGLOW)}if(1==activeCheckboxBOKEH)if(flareSettingsBOKEH)arrayCheck(flareSettingsBOKEH);else{console.log("[ GLIFTEK ]: Lens Flare Deluxe Bokeh settings missing. Using default settings."),(flareSettingsBOKEH=[]).name="flareSettingsBOKEH";const o=new Map([["type","BOKEH"],["shape","BOKEH_hexagon"],["vert",0],["rotate",0],["feBlur",.2],["opacity",.6],["size",1],["distance",.9],["color","cyan"]]),e=new Map([["type","BOKEH"],["shape","BOKEH_hexagon"],["vert",2],["rotate",0],["feBlur",.2],["opacity",.6],["size",1],["distance",0],["color","cyan"]]);flareSettingsBOKEH.push(o),flareSettingsBOKEH.push(e),makeFlares(flareSettingsBOKEH)}}function arrayCheck(o){if(Array.isArray(o))Array.isArray(o)&&(o.name="flareSettings"+o[0].get("type"),makeFlares(o));else{const e=[];e.name="flareSettings"+o.get("type"),e.push(o),console.log("settings:",e),makeFlares(e)}}function svgUriEncode(o){let e=encodeURIComponent(" <svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' "+o+"</svg>");return"data:image/svg+xml,".concat(e)}function makeFlares(flareSettings){let textureFlare,flareSettingsIterations=flareSettings.length;for(let i=0;i<flareSettingsIterations;i++){function makeArgsList(o,n){return o.forEach(t=>n.push(item.get(t))),n}function flareCaseFunction(flareType){makeFlareElement(makeTextureFlare(makeArgsList(eval(`LIST_flareArgs${flareType}`),eval(`flareArgs${flareType}`))),eval(`flareMasterSize${flareType}`)*flareMasterSize,itemDistance,ifLastSettingsIteration)}function makeTextureFlare(args){let shapeOrType="BOKEH"==itemType?"type":"shape";const svgCodeName="svgCode_"+item.get(shapeOrType);console.log("svgCodeName, args",svgCodeName,...args);const svgData=eval(svgCodeName)(...args),textureFlare=textureLoader.load(svgData);return textureFlare.name="textureFlare"+itemType+"_"+i,textureFlare}function makeFlareElement(textureFlare,sizeMultiplier,itemDistance,callback,iteration){const flareColor=new THREE.Color(item.get("color")),newFlare=new THREE.LensflareElement(textureFlare,item.get("size")*sizeMultiplier,itemDistance,flareColor);"BOKEH"!==itemType&&(iteration=i),newFlare.name="lensFlare"+itemType+"_"+iteration;let list="LIST_lensFlare"+itemType;eval(list).push(newFlare),callback(itemType)}function ifLastSettingsIteration(){i+1==flareSettingsIterations&&readyToAddFunc(itemType)}function readyToAddFunc(t){"RAYS"===t?readyToAddRAYS=!0:"GLOW"===t?readyToAddGLOW=!0:"BOKEH"===t?readyToAddBOKEH=!0:void 0}const item=flareSettings[i],itemType=item.get("type"),itemDistance=item.get("distance");let args,flareArgsRAYS=[],flareArgsGLOW=[],flareArgsBOKEH=[];switch(itemType){case"RAYS":case"GLOW":flareCaseFunction(itemType);break;case"BOKEH":const o=[60,70,120,70];let e=0===itemDistance?[.6,.7,.9,2]:[.6*itemDistance,.7*itemDistance,.9*itemDistance,2*itemDistance];const t=o.length;for(let n=0;n<t;n++)makeFlareElement(makeTextureFlare(makeArgsList(LIST_flareArgsBOKEH,flareArgsBOKEH)),1.5*(o[n]*flareMasterSizeBOKEH*flareMasterSize),e[n],ifLastSettingsIteration,n);}}}function createLensFlareObject(){(lensflare=new THREE.Lensflare).name=nameInput,light.add(lensflare)}function waitToAddAllFlares(){createLensFlareObject();var t=setInterval(()=>{1==readyToAddRAYS&&1==readyToAddGLOW&&1==readyToAddBOKEH&&(clearInterval(t),function(){function o(){1==activeCheckboxGLOW?addLensFlareElementsToLensFlareObject(LIST_lensFlareGLOW,e):e()}function e(){1==activeCheckboxBOKEH?addLensFlareElementsToLensFlareObject(LIST_lensFlareBOKEH,done):done()}1==activeCheckboxRAYS?addLensFlareElementsToLensFlareObject(LIST_lensFlareRAYS,o):o()}())},100)}function addLensFlareElementsToLensFlareObject(o,e){for(let t,n=0;n<o.length;n++)t=o[n],lensflare.addElement(t),console.log("lensflare",lensflare),n==o.length-1&&e()}function done(){}function svgCode_RAYS(d,p,u,t,a,n,o,r){function i(e){return`<g transform=\n            'rotate(${360/d*e},300,300)'>\n            <use \n            class='rayUse' \n            xlink:href='#raySymbol'\t\t\t\t\n            transform='scale(${function(t){return 0==t?1:10<t||1>t?1:.1*(Math.floor(Math.random()*t)+1)}(a)},${u})'/>\n            </g>`}0!==a&&(10<a||1>a)&&(console.log("[ GLIFTEK ]: Lens Flare Rays Settings puzzle \"random ray lengths\" input must be between 1 and 10. Set to 0 to disable. Setting to 0."),alert("[ GLIFTEK ]: Lens Flare Rays Settings puzzle \"random ray lengths\" input must be between 1 and 10. Set to 0 to disable. Setting to 0"));let l="",_="";if(1==p){_="",0!=d%2&&(d++,console.log("[ GLIFTEK ] Lens Flare Rays Settings: Only an even number of rays can be symmetrical. Changing \"ray count\" up to: ",d));for(let e=0;e<d/2;e++)l+=i(e)}else if(0==p){_="mask:url(#mask)";for(let e=0;e<d;e++)l+=i(e)}return svgUriEncode(`\n            width='600'\n            height='600' \n            viewBox='0 0 600 600'>\n\n            <style type="text/css"> \n            .rayUse {\n                transform-origin: center;\n            }\n            .rayElipse {\n                mix-blend-mode:screen;\n                fill:url(#radial-gradient);\n            }\n            </style>\n\n                <defs>\n\n                    <mask id="mask"> \n                        <rect x='0' y='285' width='300' height='30' fill='#ffffff' /> \n                    </mask>\n\n                    <radialGradient id='radial-gradient' \n\n                        cx='300' \n                        cy='300' \n                        r='150'\n\n                        gradientTransform='translate(-300 290.9) scale(2 0.03)' gradientUnits='userSpaceOnUse'\n                        >\n                        \n                        <stop offset='0.15' \n                        stop-color='#fff' \n                        stop-opacity='1'\n                        />\n\n                        <stop offset='${1-.1*t}' \n                        stop-color='#fff' \n                        stop-opacity='0'\n                        />\n\n                    </radialGradient>\n                \n                    <filter id='blur' x='-.1' y='-.1' >\n                    <feGaussianBlur in='SourceGraphic' stdDeviation='${o}' />\n                    </filter>\n                </defs>\n                <g style="isolation:isolate">\n                    <symbol id='raySymbol' viewBox='0 0 600 600' >\n                        <g style='${_}' \n                        transform='\n                        translate(0,0)\n                        '>\n                            <ellipse class='rayElipse' cx='300' cy='300' rx='300' ry='5' />\n                        </g>\n                    </symbol>\n                </g>\n                \n                <g ${`transform='rotate(${n},300,300)' opacity='${r*flareMasterOpacityRAYS*flareMasterOpacity}' filter='url(#blur)'`}> ${l} </g>\n            \n        `)}function svgCode_GLOW_hexagon(c,e,t,a,l,n,o,r){let i=svgUriEncode(`\n\n        width='100'\n        height='100'\n        viewBox='-10 -10 110 110'>\n\n        <defs>\n        <filter id='blur' x='-.1' y='-.1' >\n        <feGaussianBlur in='SourceGraphic' stdDeviation='${o}' />\n        </filter>\n        </defs>\n        ${BOKEH_hexagon}\n        \n        id='glow' \n        style='fill:gray'\n        filter='url(#blur)' \n        transform='rotate(${n},50,50)'\n        opacity='${r*flareMasterOpacityGLOW*flareMasterOpacity}'\t\t\n        />\n\n        <g > <use xlink:href='#glow' /> </g>\n            \n        `);return console.log("result from svgCode_GLOW_hexagon: ",i),i}function svgCode_GLOW_circle(s,e,t,a,l,n,o,r){return svgUriEncode(`\n\n        width='100'\n        height='100'\n        viewBox='0 0 100 100'>\n\n        <defs>\n        <radialGradient id='radial-gradient' cx='50' cy='50' r='50' gradientUnits='userSpaceOnUse'>\n\n        <stop offset='${s}' style='stop-color: #000; stop-opacity: 0'/>\n        <stop offset='${e}' style='stop-color: #fff; stop-opacity: .5'/>\n        <stop offset='${t}' style='stop-color: #fff; stop-opacity: 1'/>\n        <stop offset='${a}' style='stop-color: #fff; stop-opacity: .5'/>\n        <stop offset='${l}' style='stop-color: #fff; stop-opacity: 0'/>\n\n        </radialGradient>\n\n        <g style='isolation:isolate'>\n\n            <g id='glow'>\n\n                <circle cx='50' cy='50' r='50' style='mix-blend-mode:screen;fill:url(#radial-gradient)' />\n\n            </g>\n\n        </g>\n\n        </defs>\n        <g > ${`<use xlink:href='#glow' opacity='${r*flareMasterOpacityGLOW}'/>`} </g>\n            \n        `)}function svgCode_GLOW_ellipse(s,e,t,a,l,n,o,r){return svgUriEncode(`\n\n        width='100'\n        height='100'\n        viewBox='0 0 100 100'>\n\n        <defs>\n        <radialGradient id='radial-gradient' cx='50' cy='50' r='50' gradientUnits='userSpaceOnUse'>\n\n        <stop offset='${s}' style='stop-color: #000; stop-opacity: 0'/>\n        <stop offset='${e}' style='stop-color: #fff; stop-opacity: .5'/>\n        <stop offset='${t}' style='stop-color: #fff; stop-opacity: 1'/>\n        <stop offset='${a}' style='stop-color: #fff; stop-opacity: .5'/>\n        <stop offset='${l}' style='stop-color: #fff; stop-opacity: 0'/>\n\n        </radialGradient>\n\n        <g style='isolation:isolate'>\n\n            <g id='glow'>\n\n                <ellipse cx='50' cy='50' rx='50' ry='25' style='mix-blend-mode:screen;fill:url(#radial-gradient)' />\n\n            </g>\n\n        </g>\n\n        </defs>\n        <g > ${`<use xlink:href='#glow' opacity='${r*flareMasterOpacityGLOW}'/>`} </g>\n            \n        `)}function svgCode_GLOW_square(s,e,t,a,l,n,o,r){return svgUriEncode(`\n\n        width='100'\n        height='100'\n        viewBox='0 0 100 100'>\n\n        <defs>\n        <radialGradient id='radial-gradient' cx='50' cy='50' r='50' gradientUnits='userSpaceOnUse'>\n        \n        <stop offset='${s}' style='stop-color: #000; stop-opacity: 0'/>\n        <stop offset='${e}' style='stop-color: #fff; stop-opacity: .5'/>\n        <stop offset='${t}' style='stop-color: #fff; stop-opacity: 1'/>\n        <stop offset='${a}' style='stop-color: #fff; stop-opacity: .5'/>\n        <stop offset='${l}' style='stop-color: #fff; stop-opacity: 0'/>\n\n        </radialGradient>\n\n        <g style='isolation:isolate'>\n        <g id='glow'>\n\n        <rect cx='50' cy='50' r='50' style='mix-blend-mode:screen;fill:url(#radial-gradient)' />\n\n        </g>\n        </g>\n        </defs>\n        <g > ${`<use xlink:href='#glow' opacity='${r*flareMasterOpacityGLOW*flareMasterOpacity}'/>`} </g>\n            \n        `)}function svgCode_BOKEH(shape,color,vert,rotate,feBlur,opacity){const width=100,height=100,vBminX=0,vBminY=0,vBwidth=100,vBheight=100,translateX=0,translateY=0,scaleX=1,scaleY=1;let result=svgUriEncode(`\n            width='${100}'\n            height='${100}'\n            viewBox='${0} ${0}\n            ${100} ${100}'>\n            <defs>\n                <filter id="blur" x="-.1" y="-.1" >\n                <feGaussianBlur in='SourceGraphic' stdDeviation='${feBlur}' />\n                </filter>\n            </defs>\n            ${eval(shape)} \n            style='fill:${color}'\n            opacity='\n            ${opacity*flareMasterOpacityBOKEH*flareMasterOpacity}'\n            filter='url(#blur)'\n            transform='\n            translate(${0},${0})\n            scale(${1},${1})\n            rotate(${rotate},${50},${50})\n        '/>\n        `);return result}function loadAllLensFlareTextures(){MAP_LF_Bokeh_Polygons.set("line","<line x1='50' y1='20' x2='80' y2='50' style ='stroke:gray;stroke-width:5'"),MAP_LF_Bokeh_Polygons.set("circle","<circle cx='50' cy='50' r='50' "),MAP_LF_Bokeh_Polygons.set("ellipse","<ellipse cx='50' cy='50' rx='50' ry='25' "),MAP_LF_Bokeh_Polygons.set("triangle","<polygon points='50 20 84.64 80 15.36 80 50 20'"),MAP_LF_Bokeh_Polygons.set("square","<rect x='20' y='20' width='60' height='60'"),MAP_LF_Bokeh_Polygons.set("pentagon","<polygon points='50 13.82 88.04 41.46 73.51 86.18 26.49 86.18 11.96 41.46 50 13.82'"),MAP_LF_Bokeh_Polygons.set("hexagon","<polygon points = '50.04 10 84.66 30.04 84.62 70.04 49.96 90 15.34 69.96 15.38 29.96 50.04 10'"),MAP_LF_Bokeh_Polygons.set("heptagon","<polygon points='50 11.98 81.27 27.04 89 60.88 67.36 88.02 32.65 88.02 11 60.88 18.73 27.04 50 11.98'"),MAP_LF_Bokeh_Polygons.set("octagon","<polygon points='65.31 13.04 86.95 34.69 86.95 65.31 65.31 86.95 34.69 86.95 13.04 65.31 13.04 34.69 34.69 13.04 65.31 13.04'"),MAP_LF_Bokeh_Polygons.set("nonagon","<polygon points='50 11.21 75.71 20.56 89.39 44.26 84.64 71.21 63.68 88.79 36.32 88.79 15.36 71.21 10.61 44.26 24.29 20.56 50 11.21'"),BOKEH_line=MAP_LF_Bokeh_Polygons.get("line"),BOKEH_circle=MAP_LF_Bokeh_Polygons.get("circle"),BOKEH_ellipse=MAP_LF_Bokeh_Polygons.get("ellipse"),BOKEH_triangle=MAP_LF_Bokeh_Polygons.get("triangle"),BOKEH_square=MAP_LF_Bokeh_Polygons.get("square"),BOKEH_pentagon=MAP_LF_Bokeh_Polygons.get("pentagon"),BOKEH_hexagon=MAP_LF_Bokeh_Polygons.get("hexagon"),BOKEH_heptagon=MAP_LF_Bokeh_Polygons.get("heptagon"),BOKEH_octagon=MAP_LF_Bokeh_Polygons.get("octagon"),BOKEH_nonagon=MAP_LF_Bokeh_Polygons.get("nonagon")}function lensFlareJS(){!function(){class _ extends THREE.Mesh{constructor(){super(_.Geometry,new THREE.MeshBasicMaterial({opacity:0,transparent:!0})),this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;const T=new THREE.Vector3,a=new THREE.Vector3,E=new THREE.DataTexture(new Uint8Array(768),16,16,THREE.RGBFormat);E.minFilter=THREE.NearestFilter,E.magFilter=THREE.NearestFilter,E.wrapS=THREE.ClampToEdgeWrapping,E.wrapT=THREE.ClampToEdgeWrapping;const n=new THREE.DataTexture(new Uint8Array(768),16,16,THREE.RGBFormat);n.minFilter=THREE.NearestFilter,n.magFilter=THREE.NearestFilter,n.wrapS=THREE.ClampToEdgeWrapping,n.wrapT=THREE.ClampToEdgeWrapping;const S=_.Geometry,o=new THREE.RawShaderMaterial({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:"\n\n                    precision highp float;\n\n                    uniform vec3 screenPosition;\n                    uniform vec2 scale;\n\n                    attribute vec3 position;\n\n                    void main() {\n\n                        gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );\n\n                    }",fragmentShader:"\n\n                    precision highp float;\n\n                    void main() {\n\n                        gl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );\n\n                    }",depthTest:!0,depthWrite:!1,transparent:!1}),r=new THREE.RawShaderMaterial({uniforms:{map:{value:E},scale:{value:null},screenPosition:{value:null}},vertexShader:"\n\n                    precision highp float;\n\n                    uniform vec3 screenPosition;\n                    uniform vec2 scale;\n\n                    attribute vec3 position;\n                    attribute vec2 uv;\n\n                    varying vec2 vUV;\n\n                    void main() {\n\n                        vUV = uv;\n\n                        gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );\n\n                    }",fragmentShader:"\n\n                    precision highp float;\n\n                    uniform sampler2D map;\n\n                    varying vec2 vUV;\n\n                    void main() {\n\n                        gl_FragColor = texture2D( map, vUV );\n\n                    }",depthTest:!1,depthWrite:!1,transparent:!1}),i=new THREE.Mesh(S,o),s=[],t=e.Shader,c=new THREE.RawShaderMaterial({uniforms:{map:{value:null},occlusionMap:{value:n},color:{value:new THREE.Color(16777215)},scale:{value:new THREE.Vector2},screenPosition:{value:new THREE.Vector3}},vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1}),d=new THREE.Mesh(S,c);this.addElement=function(t){s.push(t)};const g=new THREE.Vector2,f=new THREE.Vector2,l=new THREE.Box2,m=new THREE.Vector4;this.onBeforeRender=function(y,e,h){y.getCurrentViewport(m);const t=m.w/m.z,p=m.z/2,u=m.w/2;let _=16/m.w;if(g.set(_*t,_),l.min.set(m.x,m.y),l.max.set(m.x+(m.z-16),m.y+(m.w-16)),a.setFromMatrixPosition(this.matrixWorld),a.applyMatrix4(h.matrixWorldInverse),!(0<a.z)&&(T.copy(a).applyMatrix4(h.projectionMatrix),f.x=m.x+T.x*p+p-8,f.y=m.y+T.y*u+u-8,l.containsPoint(f))){y.copyFramebufferToTexture(f,E);let e=o.uniforms;e.scale.value=g,e.screenPosition.value=T,y.renderBufferDirect(h,null,S,o,i,null),y.copyFramebufferToTexture(f,n),(e=r.uniforms).scale.value=g,e.screenPosition.value=T,y.renderBufferDirect(h,null,S,r,i,null);const a=2*-T.x,l=2*-T.y;for(let e=0,t=s.length;e<t;e++){const t=s[e],n=c.uniforms;n.color.value.copy(t.color),n.map.value=t.texture,n.screenPosition.value.x=T.x+a*t.distance,n.screenPosition.value.y=T.y+l*t.distance,_=t.size/m.w;const o=m.w/m.z;n.scale.value.set(_*o,_),c.uniformsNeedUpdate=!0,y.renderBufferDirect(h,null,S,c,d,null)}}},this.dispose=function(){o.dispose(),r.dispose(),c.dispose(),E.dispose(),n.dispose();for(let o=0,e=s.length;o<e;o++)s[o].texture.dispose()}}}_.prototype.isLensflare=!0;class e{constructor(o,e=1,t=0,n=new THREE.Color(16777215)){this.texture=o,this.size=e,this.distance=t,this.color=n}}e.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:"\n\n            precision highp float;\n\n            uniform vec3 screenPosition;\n            uniform vec2 scale;\n\n            uniform sampler2D occlusionMap;\n\n            attribute vec3 position;\n            attribute vec2 uv;\n\n            varying vec2 vUV;\n            varying float vVisibility;\n\n            void main() {\n\n                vUV = uv;\n\n                vec2 pos = position.xy;\n\n                vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\n                visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\n\n                vVisibility =        visibility.r / 9.0;\n                vVisibility *= 1.0 - visibility.g / 9.0;\n                vVisibility *=       visibility.b / 9.0;\n\n                gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n\n            }",fragmentShader:"\n\n            precision highp float;\n\n            uniform sampler2D map;\n            uniform vec3 color;\n\n            varying vec2 vUV;\n            varying float vVisibility;\n\n            void main() {\n\n                vec4 texture = texture2D( map, vUV );\n                texture.a *= vVisibility;\n                gl_FragColor = texture;\n                gl_FragColor.rgb *= color;\n\n            }"},_.Geometry=function(){const o=new THREE.BufferGeometry,e=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),t=new THREE.InterleavedBuffer(e,5);return o.setIndex([0,1,2,0,2,3]),o.setAttribute("position",new THREE.InterleavedBufferAttribute(t,3,0,!1)),o.setAttribute("uv",new THREE.InterleavedBufferAttribute(t,2,3,!1)),o}(),THREE.Lensflare=_,THREE.LensflareElement=e}()}function promiseFunctionOBJ(r,e){(function(e){var t=Date.now();return new Promise(function i(a,n){console.log("[ GLIFTEK Plugins ]:\n'",puzzleName,"'puzzle is looking for",r),app.scene.getObjectByName(r)?a(app.scene.getObjectByName(r)):e&&Date.now()-t>=e?(n(new Error("timeout.",r,"not found!")),console.log("[ GLIFTEK Plugins ]:\n 'timeout.'",r,"not found!"),alert("[ GLIFTEK Plugins ]:\n 'timeout.'",r,"not found!")):setTimeout(i.bind(this,a,n),30)})})(1e4).then(function(){e(r)})}function promiseFunctionVAR(r,e){(function(e){var t=Date.now();return new Promise(function i(a,n){console.log("[ GLIFTEK Plugins ]:\n'",puzzleName,"'puzzle is looking for",r),"undefined"===r?e&&Date.now()-t>=e?(n(new Error("timeout.",r,"not found!")),console.log("[ GLIFTEK Plugins ]:\n 'timeout.'",r,"not found!"),alert("[ GLIFTEK Plugins ]:\n 'timeout.'",r,"not found!")):setTimeout(i.bind(this,a,n),30):(a(r),console.log("[ GLIFTEK Plugins ]:",r.name,"found!"))})})(1e4).then(function(){e(r)})}window.lensflareJS_var||(window.lensflareJS_var=lensFlareJS()),checkboxFALSEcheck()}const puzzleName="Lense Flare Deluxe";let readyToAddRAYS=!1,readyToAddGLOW=!1,readyToAddBOKEH=!1;const LIST_flareArgsRAYS=["rays","symmetrical","rayWidth","raySharpness","randomSeed","rotate","feBlur","opacity"],LIST_flareArgsGLOW=["toneCenter","toneInner","toneMid","toneOuter","toneEdge","rotate","feBlur","opacity"],LIST_flareArgsBOKEH=["shape","color","vert","rotate","feBlur","opacity"],varToString=t=>Object.keys(t)[0],renderer=app.renderer;renderer.outputEncoding=THREE.sRGBEncoding,renderer.antialias=!0;const scene=app.scene,camera=app.camera;let textureLoader=new THREE.TextureLoader,clock=new THREE.Clock,LIST_lensFlareRAYS=[];LIST_lensFlareRAYS.name="LIST_lensFlareRAYS";let LIST_lensFlareGLOW=[];LIST_lensFlareGLOW.name="LIST_lensFlareGLOW";let LIST_lensFlareBOKEH=[];LIST_lensFlareBOKEH.name="LIST_lensFlareBOKEH";let lensflare,light,selectedLight,BOKEH_line,BOKEH_circle,BOKEH_ellipse,BOKEH_triangle,BOKEH_square,BOKEH_pentagon,BOKEH_hexagon,BOKEH_heptagon,BOKEH_octagon,BOKEH_nonagon,LIST_lensFlareALL=[LIST_lensFlareRAYS,LIST_lensFlareGLOW,LIST_lensFlareBOKEH],MAP_LF_Bokeh_Polygons=new Map;objInput&&"<none>"!=objInput?mainFunction():console.log("[ GLIFTEK ]: The ","Lense Flare Deluxe","plugin puzzle is missing an input!")}.apply(null,arguments)}function LENS_FLARE_DELUXE_1(){createLenseFlareFunction("myLensFlare_A","Lens_Flare_Point_Light",!0,RAYS_01,1.5,.95,!0,GLOW_01,1,.95,!0,BOKEH_01,.75,.75,.65,.95)}function lensFlareSettingsRAYS(){return function(u,e,l,a,t,i,r,n,d,o,s,p){return new Map([["type","RAYS"],["shape","RAYS"],["rays",u],["nameInput",e],["symmetrical",l],["rayWidth",a],["raySharpness",t],["randomSeed",i],["rotate",r],["feBlur",n],["opacity",d],["size",o],["distance",s],["color",p]])}.apply(null,arguments)}function INIT_RAYS_SETTINGS_1(){RAYS_01=[lensFlareSettingsRAYS(6,"name",!0,3,0,9,0,.1,.9,900,0,"#ffff66"),lensFlareSettingsRAYS(9,"name",!1,3,1,3,0,.1,.9,1200,.001,"#ffcc66"),lensFlareSettingsRAYS(64,"name",!0,3,0,5,23,2,.5,500,.002,"#ffffcc")]}function lensFlareSettingsBOKEH(){return function(r,e,s,t,a,o,n,i){return new Map([["type","BOKEH"],["shape",r],["vert",e],["rotate",s],["feBlur",t],["opacity",a],["size",o],["distance",n],["color",i]])}.apply(null,arguments)}function INIT_BOKEH_SETTINGS_1(){BOKEH_01=[lensFlareSettingsBOKEH("BOKEH_hexagon",0,0,.2,.6,1,.9,"#ff9900"),lensFlareSettingsBOKEH("BOKEH_hexagon",0,0,.8,.5,2,0,"#ffff00")]}function SET_VARIABLES(){lens_flare_counter=1,LIST_bg_images=["./img/bg_clouds_pink_purple.jpg","./img/bg_blue_dark_cloudy.jpg","./img/bg_clouds_godrays_02.jpg"],GLOW_2=null,center_alpha_distance_02=null}function notIgnoredObj(e){return"AmbientLight"!==e.type&&""!==e.name&&!(e.isMesh&&e.isMaterialGeneratedMesh)&&!e.isAuxClippingMesh}function getObjectByName(e){var t,o=void 0!==_pGlob;return(t=_pGlob.objCache[e],t&&t.name===e)?t:(appInstance.scene.traverse(function(n){!t&&notIgnoredObj(n)&&n.name==e&&(t=n,o&&(_pGlob.objCache[e]=t))}),t)}function getAllObjectNames(){var e=[];return appInstance.scene.traverse(function(t){notIgnoredObj(t)&&e.push(t.name)}),e}function getObjectNamesByGroupName(e){var t=[];return appInstance.scene.traverse(function(o){if(notIgnoredObj(o)){var n=o.groupNames;if(!n)return;for(var r,a=0;a<n.length;a++)r=n[a],r==e&&t.push(o.name)}}),t}function retrieveObjectNames(e){var t=[];return retrieveObjectNamesAcc(e,t),t.filter(function(e){return e})}function retrieveObjectNamesAcc(e,t){if("string"==typeof e)t.push(e);else if(Array.isArray(e)&&"GROUP"==e[0])for(var o=getObjectNamesByGroupName(e[1]),n=0;n<o.length;n++)t.push(o[n]);else if(Array.isArray(e)&&"ALL_OBJECTS"==e[0])for(var o=getAllObjectNames(),n=0;n<o.length;n++)t.push(o[n]);else if(Array.isArray(e))for(var n=0;n<e.length;n++)retrieveObjectNamesAcc(e[n],t)}function getCoordSystem(){var e=appInstance.scene;return e&&"v3d"in e.userData&&"coordSystem"in e.userData.v3d?e.userData.v3d.coordSystem:"Z_UP_RIGHT"}function coordsTransform(e,t,o,n){if(t==o)return e;var r=e.y,i=e.z;return"Z_UP_RIGHT"==t&&"Y_UP_RIGHT"==o?(e.y=i,e.z=n?r:-r):"Y_UP_RIGHT"==t&&"Z_UP_RIGHT"==o?(e.y=n?i:-i,e.z=r):console.error("coordsTransform: Unsupported coordinate space"),e}function RotationInterface(){this._userRotation=new v3d.Euler(0,0,0,"ZYX"),this._actualRotation=new v3d.Euler}function setObjTransform(e,t,o,n){function r(e,o,r){n?"scale"==t?e[t][o]*=r:e[t][o]+=r:e[t][o]=r}var a=o[0],s=o[1],l=o[2],c=retrieveObjectNames(e),d=_pGlob.vec3Tmp.set(+(""!==a),+(""!==s),+(""!==l)),p=_pGlob.vec3Tmp2.set(a||0,s||0,l||0);"rotation"===t&&p.multiplyScalar(v3d.MathUtils.DEG2RAD);var u=getCoordSystem();coordsTransform(d,u,"Y_UP_RIGHT",!0),coordsTransform(p,u,"Y_UP_RIGHT","scale"===t);for(var _,m=0;m<c.length;m++)if(_=c[m],_){var g=getObjectByName(_);if(g){if("rotation"===t&&"Z_UP_RIGHT"==u){var f=eulerV3DToBlenderShortest(g.rotation,_pGlob.eulerTmp);coordsTransform(f,u,"Y_UP_RIGHT"),d.x&&(f.x=n?f.x+p.x:p.x),d.y&&(f.y=n?f.y+p.y:p.y),d.z&&(f.z=n?f.z+p.z:p.z),f.order="YZX",f.reorder(g.rotation.order),g.rotation.copy(f)}else if("rotation"===t&&"Y_UP_RIGHT"==u){var y=RotationInterface.initObject(g),f=y.getUserRotation(_pGlob.eulerTmp);d.x&&(f.x=n?f.x+p.x:p.x),d.y&&(f.y=n?f.y+p.y:p.y),d.z&&(f.z=n?f.z+p.z:p.z),y.setUserRotation(f),y.getActualRotation(g.rotation)}else d.x&&r(g,"x",p.x),d.y&&r(g,"y",p.y),d.z&&r(g,"z",p.z);g.updateMatrixWorld(!0)}}}function tweenCamera(e,t,o,n,r){var i=appInstance.getCamera();if(Array.isArray(e)){var a=_pGlob.vec3Tmp.fromArray(e);a=coordsTransform(a,getCoordSystem(),"Y_UP_RIGHT")}else if(e){var s=getObjectByName(e);if(!s)return;var a=s.getWorldPosition(_pGlob.vec3Tmp)}else var a=i.getWorldPosition(_pGlob.vec3Tmp);if(Array.isArray(t)){var l=_pGlob.vec3Tmp2.fromArray(t);l=coordsTransform(l,getCoordSystem(),"Y_UP_RIGHT")}else{var c=getObjectByName(t);if(!c)return;var l=c.getWorldPosition(_pGlob.vec3Tmp2)}o=Math.max(0,o),appInstance.controls&&appInstance.controls.tween?!appInstance.controls.inTween&&appInstance.controls.tween(a,l,o,n,r):(i.parent&&i.parent.worldToLocal(a),i.position.copy(a),i.lookAt(l),n())}function SET_CAM_AND_LIGHT(){setObjTransform("Lens_Flare_Point_Light","position",[2.75,224638.07,7844.53],!0),tweenCamera("","Lens_Flare_Point_Light",1e-4,function(){},0)}function lensFlareSettingsGLOW(){return function(u,e,l,t,a,o,n,i,p,d,c,s,r){return new Map([["type","GLOW"],["nameInput",u],["shape",e],["toneCenter",l],["toneInner",t],["toneMid",a],["toneOuter",o],["toneEdge",n],["rotate",i],["feBlur",p],["opacity",d],["size",c],["distance",s],["color",r]])}.apply(null,arguments)}function INIT_GLOW_SETTINGS_1(){GLOW_01=[lensFlareSettingsGLOW("name","GLOW_circle",0,0,.7,.85,1,0,.4,.4,150,0,"#ffff66"),lensFlareSettingsGLOW("name","GLOW_circle",0,0,.7,.85,1,0,.6,.4,300,0,"#ff9900")]}function objConstraintAddLimit(e,t,o,n,r,a,s,l){var c;if("DISTANCE"==o){if(!a)return;var d=getObjectByName(a);if(!d)return}c=retrieveObjectNames(t);for(var p,u=0;u<c.length;u++)if(p=c[u],p){var _=getObjectByName(p);if(_&&_.constraints){for(var m=_.constraints.length-1;0<=m;m--)_.constraints[m].name==e&&_.constraints.splice(m,1);var g=getCoordSystem();switch(o){case"POS_X":case"POS_Y":case"POS_Z":var f=new v3d.LimitLocationConstraint;if(f.name=e,"Z_UP_RIGHT"==g)var y="POS_X"==o?0:"POS_Y"==o?2:1;else var y="POS_X"==o?0:"POS_Y"==o?1:2;"Z_UP_RIGHT"==g&&"POS_Y"==o?(f.min.setComponent(y,-r),f.max.setComponent(y,-n)):(f.min.setComponent(y,n),f.max.setComponent(y,r)),_.constraints.push(f);break;case"ROT_X":case"ROT_Y":case"ROT_Z":var f=new v3d.LimitRotationConstraint;f.name=e,f.axis="Z_UP_RIGHT"==g?"ROT_X"==o?"X":"ROT_Y"==o?"Z":"Y":"ROT_X"==o?"X":"ROT_Y"==o?"Y":"Z","Z_UP_RIGHT"==g&&"ROT_Y"==o?(f.min=v3d.MathUtils.degToRad(-r),f.max=v3d.MathUtils.degToRad(-n)):(f.min=v3d.MathUtils.degToRad(n),f.max=v3d.MathUtils.degToRad(r)),_.constraints.push(f);break;case"SCALE_X":case"SCALE_Y":case"SCALE_Z":var f=new v3d.LimitScaleConstraint;if(f.name=e,"Z_UP_RIGHT"==g)var y="SCALE_X"==o?0:"SCALE_Y"==o?2:1;else var y="SCALE_X"==o?0:"SCALE_Y"==o?1:2;f.min.setComponent(y,n),f.max.setComponent(y,r),_.constraints.push(f);break;case"DISTANCE":var f=new v3d.LimitDistanceConstraint(d);f.name=e,f.distance=s,f.limitMode=l,_.constraints.push(f);}}}}function CAMERA_CONSTRAINTS(){objConstraintAddLimit("myConst_Cam_pos_X","Camera","POS_X",80,80,"",0,"LIMITDIST_ONSURFACE"),objConstraintAddLimit("myConst_Cam_pos_Y","Camera","POS_Y",224540,224540,"",0,"LIMITDIST_ONSURFACE"),objConstraintAddLimit("myConst_Cam_pos_Z","Camera","POS_Z",7820,7870,"",0,"LIMITDIST_ONSURFACE"),objConstraintAddLimit("myConst_Cam_rot_X","Camera","ROT_X",0,0,"",0,"LIMITDIST_ONSURFACE"),objConstraintAddLimit("myConst_Cam_rot_Y","Camera","ROT_Y",0,2.5,"",0,"LIMITDIST_ONSURFACE"),objConstraintAddLimit("myConst_Cam_rot_Z","Camera","ROT_Z",6,70,"",0,"LIMITDIST_ONSURFACE")}function removeObject(e){for(var t,o=retrieveObjectNames(e),n=0;n<o.length;n++)if(t=o[n],t){var r=getObjectByName(t);r&&r.parent&&(r.parent.remove(r),_pGlob.objCache={})}}function CHANGE_BG_AND_FLARE(){1==lens_flare_counter?(setImageBackground("./img/bg_clouds_pink_purple.jpg"),removeObject("myLensFlare_C"),LENS_FLARE_DELUXE_1()):2==lens_flare_counter?(setImageBackground("./img/bg_blue_dark_cloudy.jpg"),removeObject("myLensFlare_A"),LENS_FLARE_DELUXE_2()):3==lens_flare_counter&&(setImageBackground("./img/city_lights_01.jpg"),removeObject("myLensFlare_B"),LENS_FLARE_DELUXE_3())}function getElements(e,t){var o=[];if(Array.isArray(e)&&"CONTAINER"!=e[0]&&"WINDOW"!=e[0]&&"DOCUMENT"!=e[0]&&"BODY"!=e[0]&&"QUERYSELECTOR"!=e[0])for(var n=0;n<e.length;n++)o.push(getElement(e[n],t));else o.push(getElement(e,t));return o}function getElement(e,t){var o;if(!(Array.isArray(e)&&"CONTAINER"==e[0]))o=Array.isArray(e)&&"WINDOW"==e[0]?t?parent:window:Array.isArray(e)&&"DOCUMENT"==e[0]?t?parent.document:document:Array.isArray(e)&&"BODY"==e[0]?t?parent.document.body:document.body:Array.isArray(e)&&"QUERYSELECTOR"==e[0]?t?parent.document.querySelector(e):document.querySelector(e):t?parent.document.getElementById(e):document.getElementById(e);else if(null!==appInstance)o=appInstance.container;else if("undefined"!=typeof _initGlob){var e=_initGlob.container;o=t?parent.document.getElementById(e):document.getElementById(e)}return o}function setHTMLElemStyle(e,t,o,n){for(var r,a=getElements(o,n),s=0;s<a.length;s++)r=a[s],r&&r.style&&(r.style[e]=t)}function initObjectPicking(e,t,o,n){function r(t){if(appInstance.getCamera()){t.preventDefault();var o=0,r=0;if(t instanceof MouseEvent){if(n&&-1==n.indexOf(t.button))return;o=t.offsetX/i.clientWidth,r=t.offsetY/i.clientHeight}else if(t instanceof TouchEvent){var a=i.getBoundingClientRect();o=(t.changedTouches[0].clientX-a.left)/a.width,r=(t.changedTouches[0].clientY-a.top)/a.height}_pGlob.screenCoords.x=2*o-1,_pGlob.screenCoords.y=2*-r+1,l.setFromCamera(_pGlob.screenCoords,appInstance.getCamera(!0));var s=[];appInstance.scene.traverse(function(e){s.push(e)});var c=l.intersectObjects(s);e(c,t)}}var i=appInstance.renderer.domElement;if(i.addEventListener(t,r),v3d.PL.editorEventListeners&&v3d.PL.editorEventListeners.push([i,t,r]),"mousedown"==t){var a=o?"touchstart":"touchend";i.addEventListener(a,r),v3d.PL.editorEventListeners&&v3d.PL.editorEventListeners.push([i,a,r])}else if("dblclick"==t){function e(e){var t=new Date().getTime(),o=t-s;return 600>o&&0<o?(r(e),void(s=0)):void(s=new Date().getTime())}var s=0,a=o?"touchstart":"touchend";i.addEventListener(a,e),v3d.PL.editorEventListeners&&v3d.PL.editorEventListeners.push([i,a,e])}var l=new v3d.Raycaster}function objectsIncludeObj(e,t){if(!t)return!1;for(var o=0;o<e.length;o++){if(t==e[o])return!0;var n=getObjectByName(e[o]);if(n&&"Group"==n.type)for(var r=0;r<n.children.length;r++)if(t==n.children[r].name)return!0}return!1}function getPickedObjectName(e){return e.isMesh&&e.isMaterialGeneratedMesh&&e.parent?e.parent.name:e.name}function registerOnHover(e,t,o,n){_pGlob.objHoverInfo=_pGlob.objHoverInfo||[],_pGlob.objHoverInfo.push({objSelector:e,callbacks:[o,n],xRay:t})}function registerOnClick(e,t,o,n,r,a){_pGlob.objClickInfo=_pGlob.objClickInfo||[],_pGlob.objClickInfo.push({objSelector:e,callbacks:[r,a]}),initObjectPicking(function(o,n){for(var s=!1,l=t?o.length:Math.min(1,o.length),c=0;c<l;c++){var d=o[c].object,p=getPickedObjectName(d),u=retrieveObjectNames(e);objectsIncludeObj(u,p)&&(_pGlob.pickedObject=p,s=!0,r(n))}s||(_pGlob.pickedObject="",a(n))},o?"dblclick":"mousedown",!1,n)}function CLICK_NEXT_BUTTON(){registerOnHover("hitbox",!0,function(){setHTMLElemStyle("cursor","pointer",["CONTAINER"],!1)},function(){setHTMLElemStyle("cursor","default",["CONTAINER"],!1)}),registerOnClick("hitbox",!0,!1,[0,1,2],function(){SWITCH_FLARE()},function(){})}function whenMoved(e,t,o,n,r){function i(e,t,o){if(_pGlob.objMovementInfos[e]){var n=_pGlob.objMovementInfos[e];n.prevPosX=t.position.x,n.prevPosY=t.position.y,n.prevPosZ=t.position.z,n.prevRotX=t.rotation.x,n.prevRotY=t.rotation.y,n.prevRotZ=t.rotation.z,n.prevScaX=t.scale.x,n.prevScaY=t.scale.y,n.prevScaZ=t.scale.z,n.prevIsMoving=o}else{var n={prevPosX:t.position.x,prevPosY:t.position.y,prevPosZ:t.position.z,prevRotX:t.rotation.x,prevRotY:t.rotation.y,prevRotZ:t.rotation.z,prevScaX:t.scale.x,prevScaY:t.scale.y,prevScaZ:t.scale.z,prevIsMoving:o};_pGlob.objMovementInfos[e]=n}return n}function a(e,a,s){var l=_pGlob.objMovementInfos[e]||i(e,a,!1),c=t*s,d=Math.abs(a.position.x-l.prevPosX)>c||Math.abs(a.position.y-l.prevPosY)>c||Math.abs(a.position.z-l.prevPosZ)>c||Math.abs(a.rotation.x-l.prevRotX)>c||Math.abs(a.rotation.y-l.prevRotY)>c||Math.abs(a.rotation.z-l.prevRotZ)>c||Math.abs(a.scale.x-l.prevScaX)>c||Math.abs(a.scale.y-l.prevScaY)>c||Math.abs(a.scale.z-l.prevScaZ)>c;!l.prevIsMoving&&d?(o(e),i(e,a,!0)):l.prevIsMoving&&d?(n(e),i(e,a,!0)):l.prevIsMoving&&!d?(r(e),i(e,a,!1)):i(e,a,!1)}_pGlob.objMovementInfos=_pGlob.objMovementInfos||{},function(e){function t(t){for(var o=retrieveObjectNames(e),n=0;n<o.length;n++){var r=o[n],s=getObjectByName(r);if(!s)return;a(r,s,t)}}appInstance.renderCallbacks.push(t),v3d.PL.editorRenderCallbacks&&v3d.PL.editorRenderCallbacks.push([appInstance,t])}(e)}function DISABLE_RENDERING(){disableRendering(!0),whenMoved("Camera",.01,function(){enableRendering()},function(){},function(){disableRendering(!0)})}function LENS_FLARE_DELUXE_2(){createLenseFlareFunction("myLensFlare_B","Lens_Flare_Point_Light",!0,RAYS_2,.4,.75,!0,GLOW_2,.125,.6,!0,BOKEH_2,1,.95,2.25,.8)}function INIT_RAYS_SETTINGS_2(){RAYS_2=[lensFlareSettingsRAYS(2,"anamorphic",!0,.7,8,0,0,0,.9,1e4,0,"#3366ff"),lensFlareSettingsRAYS(32,"shimmer_1",!1,.5,3,2.5,23,0,.8,2400,.002,"#3366ff"),lensFlareSettingsRAYS(32,"shimmer_2",!1,.5,3,2.5,45,0,.8,2400,.002,"#33ccff"),lensFlareSettingsRAYS(64,"shimmer_3",!1,.25,0,4,0,0,.8,1600,.003,"#99ffff")]}function INIT_BOKEH_SETTINGS_2(){BOKEH_2=[lensFlareSettingsBOKEH("BOKEH_triangle",0,15,.2,.5,1,.9,"#ccffff"),lensFlareSettingsBOKEH("BOKEH_triangle",0,15,.2,.3,.5,.5,"#66ffff")]}function INIT_GLOW_SETTINGS_2(){GLOW_2=[lensFlareSettingsGLOW("inner glow","GLOW_hexagon",0,.2,.7,1,1,0,4,.9,350,0,"#ccffff"),lensFlareSettingsGLOW("outer circle","GLOW_circle",.55,.65,.85,.95,1,0,7,.4,1500,0,"#00ffff"),lensFlareSettingsGLOW("accent elipse","GLOW_ellipse",.55,.65,.85,.95,1,0,7,.2,1500,0,"#00ffff")]}function LENS_FLARE_DELUXE_3(){createLenseFlareFunction("myLensFlare_C","Lens_Flare_Point_Light",!0,RAYS_3,.4,.9,!0,GLOW_3,.5,.9,!0,BOKEH_3,1,.95,1,.8)}function INIT_RAYS_SETTINGS_3(){RAYS_3=[lensFlareSettingsRAYS(32,"shimmer_1",!1,1,3,2.5,23,0,.8,6e3,.002,"#ff6600"),lensFlareSettingsRAYS(32,"shimmer_2",!1,5,3,8,45,0,.8,2400,.002,"#993300")]}function INIT_BOKEH_SETTINGS_3(){BOKEH_3=[lensFlareSettingsBOKEH("BOKEH_ellipse",0,0,.2,.5,1,.9,"#ffff99"),lensFlareSettingsBOKEH("BOKEH_ellipse",0,0,.2,.3,.5,.5,"#ffff66")]}function INIT_GLOW_SETTINGS_3(){GLOW_3=[lensFlareSettingsGLOW("inner glow","GLOW_circle",0,.2,.5,.6,.7,0,10,.9,600,0,"#ffcc66"),lensFlareSettingsGLOW("name","GLOW_circle",0,.2,.7,.8,.9,0,4,.5,800,0,"#cc9933")]}var app=appInstance;initOptions=initOptions||{},"fadeAnnotations"in initOptions&&(_pGlob.fadeAnnotations=initOptions.fadeAnnotations),this.procedures.SWITCH_FLARE=SWITCH_FLARE,this.procedures.MAIN=MAIN,this.procedures.LENS_FLARES_PROCEDURES=LENS_FLARES_PROCEDURES,this.procedures.FADE_IN=FADE_IN,this.procedures.SWITCH_FLARE_FADE=SWITCH_FLARE_FADE,this.procedures.LENS_FLARE_DELUXE_1=LENS_FLARE_DELUXE_1,this.procedures.INIT_RAYS_SETTINGS_1=INIT_RAYS_SETTINGS_1,this.procedures.INIT_BOKEH_SETTINGS_1=INIT_BOKEH_SETTINGS_1,this.procedures.SET_VARIABLES=SET_VARIABLES,this.procedures.SET_CAM_AND_LIGHT=SET_CAM_AND_LIGHT,this.procedures.INIT_GLOW_SETTINGS_1=INIT_GLOW_SETTINGS_1,this.procedures.CAMERA_CONSTRAINTS=CAMERA_CONSTRAINTS,this.procedures.CHANGE_BG_AND_FLARE=CHANGE_BG_AND_FLARE,this.procedures.CLICK_NEXT_BUTTON=CLICK_NEXT_BUTTON,this.procedures.DISABLE_RENDERING=DISABLE_RENDERING,this.procedures.LENS_FLARE_DELUXE_2=LENS_FLARE_DELUXE_2,this.procedures.INIT_RAYS_SETTINGS_2=INIT_RAYS_SETTINGS_2,this.procedures.INIT_BOKEH_SETTINGS_2=INIT_BOKEH_SETTINGS_2,this.procedures.INIT_GLOW_SETTINGS_2=INIT_GLOW_SETTINGS_2,this.procedures.LENS_FLARE_DELUXE_3=LENS_FLARE_DELUXE_3,this.procedures.INIT_RAYS_SETTINGS_3=INIT_RAYS_SETTINGS_3,this.procedures.INIT_BOKEH_SETTINGS_3=INIT_BOKEH_SETTINGS_3,this.procedures.INIT_GLOW_SETTINGS_3=INIT_GLOW_SETTINGS_3;var lens_flare_counter,RAYS_01,BOKEH_01,GLOW_01,RAYS_2,BOKEH_2,GLOW_2,RAYS_3,BOKEH_3,GLOW_3,LIST_bg_images,center_alpha_distance_02,PROC={SWITCH_FLARE:SWITCH_FLARE,MAIN:MAIN,LENS_FLARES_PROCEDURES:LENS_FLARES_PROCEDURES,FADE_IN:FADE_IN,SWITCH_FLARE_FADE:SWITCH_FLARE_FADE,LENS_FLARE_DELUXE_1:LENS_FLARE_DELUXE_1,INIT_RAYS_SETTINGS_1:INIT_RAYS_SETTINGS_1,INIT_BOKEH_SETTINGS_1:INIT_BOKEH_SETTINGS_1,SET_VARIABLES:SET_VARIABLES,SET_CAM_AND_LIGHT:SET_CAM_AND_LIGHT,INIT_GLOW_SETTINGS_1:INIT_GLOW_SETTINGS_1,CAMERA_CONSTRAINTS:CAMERA_CONSTRAINTS,CHANGE_BG_AND_FLARE:CHANGE_BG_AND_FLARE,CLICK_NEXT_BUTTON:CLICK_NEXT_BUTTON,DISABLE_RENDERING:DISABLE_RENDERING,LENS_FLARE_DELUXE_2:LENS_FLARE_DELUXE_2,INIT_RAYS_SETTINGS_2:INIT_RAYS_SETTINGS_2,INIT_BOKEH_SETTINGS_2:INIT_BOKEH_SETTINGS_2,INIT_GLOW_SETTINGS_2:INIT_GLOW_SETTINGS_2,LENS_FLARE_DELUXE_3:LENS_FLARE_DELUXE_3,INIT_RAYS_SETTINGS_3:INIT_RAYS_SETTINGS_3,INIT_BOKEH_SETTINGS_3:INIT_BOKEH_SETTINGS_3,INIT_GLOW_SETTINGS_3:INIT_GLOW_SETTINGS_3},eulerV3DToBlenderShortest=function(){var e=new v3d.Euler,t=new v3d.Euler,o=new v3d.Vector3;return function(n,r){var i=e.copy(n).reorder("YZX"),a=t.copy(i).makeAlternative(),s=i.toVector3(o).lengthSq(),l=a.toVector3(o).lengthSq();return r.copy(s<l?i:a),coordsTransform(r,"Y_UP_RIGHT","Z_UP_RIGHT")}}();Object.assign(RotationInterface,{initObject:function(e){void 0===e.userData.v3d.puzzles&&(e.userData.v3d.puzzles={}),void 0===e.userData.v3d.puzzles.rotationInterface&&(e.userData.v3d.puzzles.rotationInterface=new RotationInterface);var t=e.userData.v3d.puzzles.rotationInterface;return t.updateFromObject(e),t}}),Object.assign(RotationInterface.prototype,{updateFromObject:function(e){this._actualRotation.equalsEps(e.rotation,1e-8)||(this._actualRotation.copy(e.rotation),this._updateUserRotFromActualRot())},getActualRotation:function(e){return e.copy(this._actualRotation)},setUserRotation:function(e){this._userRotation.set(e.x,e.y,e.z),this._updateActualRotFromUserRot()},getUserRotation:function(e){return e.copy(this._userRotation)},_updateUserRotFromActualRot:function(){var e=this._userRotation.order;this._userRotation.copy(this._actualRotation).reorder(e)},_updateActualRotFromUserRot:function(){var e=this._actualRotation.order;this._actualRotation.copy(this._userRotation).reorder(e)}}),initObjectPicking(function(e,t){var o=_pGlob.hoveredObject,n="";_pGlob.objHoverInfo=_pGlob.objHoverInfo||[];var r=1/0;_pGlob.objHoverInfo.forEach(function(t){for(var o=t.xRay?e.length:Math.min(1,e.length),a=0;a<o;a++){var s=e[a].object,l=getPickedObjectName(s);objectsIncludeObj(retrieveObjectNames(t.objSelector),l)&&a<=r&&(n=l,r=a)}});o==n||(_pGlob.objHoverInfo.forEach(function(e){objectsIncludeObj(retrieveObjectNames(e.objSelector),o)&&(_pGlob.hoveredObject=o,e.callbacks[1](t))}),_pGlob.objHoverInfo.forEach(function(e){objectsIncludeObj(retrieveObjectNames(e.objSelector),n)&&(_pGlob.hoveredObject=n,e.callbacks[0](t))}),_pGlob.hoveredObject=n)},"mousemove",!1),MAIN()}})();