"use strict";!function(){var LIST_NONE="<none>",_pGlob={objCache:{},fadeAnnotations:!0,pickedObject:"",hoveredObject:"",mediaElements:{},loadedFile:"",states:[],percentage:0,openedFile:"",xrSessionAcquired:!1,xrSessionCallbacks:[]};_pGlob.screenCoords=new v3d.Vector2,_pGlob.intervalTimers={},_pGlob.AXIS_X=new v3d.Vector3(1,0,0),_pGlob.AXIS_Y=new v3d.Vector3(0,1,0),_pGlob.AXIS_Z=new v3d.Vector3(0,0,1),_pGlob.MIN_DRAG_SCALE=.001,_pGlob.SET_OBJ_ROT_EPS=1e-8,_pGlob.vec2Tmp=new v3d.Vector2,_pGlob.vec2Tmp2=new v3d.Vector2,_pGlob.vec3Tmp=new v3d.Vector3,_pGlob.vec3Tmp2=new v3d.Vector3,_pGlob.vec3Tmp3=new v3d.Vector3,_pGlob.vec3Tmp4=new v3d.Vector3,_pGlob.eulerTmp=new v3d.Euler,_pGlob.eulerTmp2=new v3d.Euler,_pGlob.quatTmp=new v3d.Quaternion,_pGlob.quatTmp2=new v3d.Quaternion,_pGlob.colorTmp=new v3d.Color,_pGlob.mat4Tmp=new v3d.Matrix4,_pGlob.planeTmp=new v3d.Plane,_pGlob.raycasterTmp=new v3d.Raycaster;var PL=v3d.PL=v3d.PL||{};v3d.puzzles=PL,PL.procedures=PL.procedures||{},PL.execInitPuzzles=function(e){var t={percentage:0,output:{initOptions:{fadeAnnotations:!0,useBkgTransp:!1,preserveDrawBuf:!1,useCompAssets:!1,useFullscreen:!0,useCustomPreloader:!1,preloaderStartCb:function(){},preloaderProgressCb:function(){},preloaderEndCb:function(){}}}};return t.container=void 0!==e&&"container"in e?e.container:"",t.output.initOptions.fadeAnnotations=!0,t.output.initOptions.useBkgTransp=!0,t.output.initOptions.preserveDrawBuf=!1,t.output.initOptions.useCompAssets=!1,t.output.initOptions.useFullscreen=!0,t.output},PL.init=function(appInstance,initOptions){var app=appInstance;initOptions=initOptions||{},"fadeAnnotations"in initOptions&&(_pGlob.fadeAnnotations=initOptions.fadeAnnotations),this.procedures.MAIN=MAIN,this.procedures["REMOVE CONTEXT MENU"]=REMOVE_CONTEXT_MENU,this.procedures.SET_DICT_OBJECT_COLORS=SET_DICT_OBJECT_COLORS,this.procedures.SETUP_OBJECTS=SETUP_OBJECTS,this.procedures.CLICK_MENU_ITEMS_LOOP=CLICK_MENU_ITEMS_LOOP,this.procedures.SET_LISTS=SET_LISTS,this.procedures.NEXT_COLOR=NEXT_COLOR,this.procedures.CLICK_MENU_ITEMS=CLICK_MENU_ITEMS,this.procedures.SET_INSTRUCTIONS=SET_INSTRUCTIONS,this.procedures.GET_DATA_FROM_OBJECTS=GET_DATA_FROM_OBJECTS,this.procedures.SET_CONSTRAINTS=SET_CONSTRAINTS,this.procedures.HOVER_MENU_ITEMS=HOVER_MENU_ITEMS,this.procedures.CONFIG_WEB_STORAGE=CONFIG_WEB_STORAGE,this.procedures.SET_DATABASE_NAME_VARS=SET_DATABASE_NAME_VARS,this.procedures.HOVER_OBJECTS=HOVER_OBJECTS,this.procedures.DRAG_OBJECTS_LOOP=DRAG_OBJECTS_LOOP,this.procedures.SAVE_OBJECT_DATA=SAVE_OBJECT_DATA,this.procedures.SAVE_KEY=SAVE_KEY,this.procedures.DRAG_OBJECTS=DRAG_OBJECTS,this.procedures.CLICK_OBJECTS=CLICK_OBJECTS,this.procedures.LOAD_KEY=LOAD_KEY,this.procedures.LOAD_OBJECT_DATA=LOAD_OBJECT_DATA,this.procedures.APPLY_LOADED_DATA_TO_OBJECTS=APPLY_LOADED_DATA_TO_OBJECTS,this.procedures.DELETE_KEY=DELETE_KEY,this.procedures.CLEAR_DATABASE=CLEAR_DATABASE,this.procedures.GET_LENGTH_OF_DATASTORE=GET_LENGTH_OF_DATASTORE,this.procedures.GET_ALL_KEYS=GET_ALL_KEYS,this.procedures.DELETE_DATASTORE=DELETE_DATASTORE,this.procedures.DELETE_DATABASE=DELETE_DATABASE,this.procedures.ITERATE_DATASTORE=ITERATE_DATASTORE;var PROC={MAIN:MAIN,"REMOVE CONTEXT MENU":REMOVE_CONTEXT_MENU,SET_DICT_OBJECT_COLORS:SET_DICT_OBJECT_COLORS,SETUP_OBJECTS:SETUP_OBJECTS,CLICK_MENU_ITEMS_LOOP:CLICK_MENU_ITEMS_LOOP,SET_LISTS:SET_LISTS,NEXT_COLOR:NEXT_COLOR,CLICK_MENU_ITEMS:CLICK_MENU_ITEMS,SET_INSTRUCTIONS:SET_INSTRUCTIONS,GET_DATA_FROM_OBJECTS:GET_DATA_FROM_OBJECTS,SET_CONSTRAINTS:SET_CONSTRAINTS,HOVER_MENU_ITEMS:HOVER_MENU_ITEMS,CONFIG_WEB_STORAGE:CONFIG_WEB_STORAGE,SET_DATABASE_NAME_VARS:SET_DATABASE_NAME_VARS,HOVER_OBJECTS:HOVER_OBJECTS,DRAG_OBJECTS_LOOP:DRAG_OBJECTS_LOOP,SAVE_OBJECT_DATA:SAVE_OBJECT_DATA,SAVE_KEY:SAVE_KEY,DRAG_OBJECTS:DRAG_OBJECTS,CLICK_OBJECTS:CLICK_OBJECTS,LOAD_KEY:LOAD_KEY,LOAD_OBJECT_DATA:LOAD_OBJECT_DATA,APPLY_LOADED_DATA_TO_OBJECTS:APPLY_LOADED_DATA_TO_OBJECTS,DELETE_KEY:DELETE_KEY,CLEAR_DATABASE:CLEAR_DATABASE,GET_LENGTH_OF_DATASTORE:GET_LENGTH_OF_DATASTORE,GET_ALL_KEYS:GET_ALL_KEYS,DELETE_DATASTORE:DELETE_DATASTORE,DELETE_DATABASE:DELETE_DATABASE,ITERATE_DATASTORE:ITERATE_DATASTORE},current_color,current_object,obj,save_object,loaded_DICTIONARY,DICT_load_object,DICT_object_colors,i,selected_item,next_color,EXEC_TEXT_instructions,DICT_save_object,my_saved_key,DICT_save_all_objects,m,load_object,length_of_CSV,LIST_keys_from_database,LIST_hitboxes,LIST_hovered_items,selected_object_Hitbox,DICT_save_object_POSITION,LIST_objects,my_database,my_dataStore,my_description,j,DICT_save_object_ROTATION,DICT_save_object_SCALE,LIST_text_items,load_object_color,LIST_colors,load_object_material,color_of_clicked_menu_item;function MAIN(){SET_LISTS(),REMOVE_CONTEXT_MENU(),SET_INSTRUCTIONS(),SET_DATABASE_NAME_VARS(),SETUP_OBJECTS(),SET_CONSTRAINTS(),CONFIG_WEB_STORAGE()}function REMOVE_CONTEXT_MENU(){var e=Object.defineProperties({},{obj:{get:function(){return obj},set:function(e){obj=e}},save_object:{get:function(){return save_object},set:function(e){save_object=e}},loaded_DICTIONARY:{get:function(){return loaded_DICTIONARY},set:function(e){loaded_DICTIONARY=e}},DICT_load_object:{get:function(){return DICT_load_object},set:function(e){DICT_load_object=e}},current_color:{get:function(){return current_color},set:function(e){current_color=e}},current_object:{get:function(){return current_object},set:function(e){current_object=e}},DICT_object_colors:{get:function(){return DICT_object_colors},set:function(e){DICT_object_colors=e}},i:{get:function(){return i},set:function(e){i=e}},selected_item:{get:function(){return selected_item},set:function(e){selected_item=e}},EXEC_TEXT_instructions:{get:function(){return EXEC_TEXT_instructions},set:function(e){EXEC_TEXT_instructions=e}},DICT_save_object:{get:function(){return DICT_save_object},set:function(e){DICT_save_object=e}},my_saved_key:{get:function(){return my_saved_key},set:function(e){my_saved_key=e}},DICT_save_all_objects:{get:function(){return DICT_save_all_objects},set:function(e){DICT_save_all_objects=e}},m:{get:function(){return m},set:function(e){m=e}},load_object:{get:function(){return load_object},set:function(e){load_object=e}},next_color:{get:function(){return next_color},set:function(e){next_color=e}},length_of_CSV:{get:function(){return length_of_CSV},set:function(e){length_of_CSV=e}},LIST_keys_from_database:{get:function(){return LIST_keys_from_database},set:function(e){LIST_keys_from_database=e}},LIST_hitboxes:{get:function(){return LIST_hitboxes},set:function(e){LIST_hitboxes=e}},LIST_hovered_items:{get:function(){return LIST_hovered_items},set:function(e){LIST_hovered_items=e}},selected_object_Hitbox:{get:function(){return selected_object_Hitbox},set:function(e){selected_object_Hitbox=e}},my_database:{get:function(){return my_database},set:function(e){my_database=e}},my_dataStore:{get:function(){return my_dataStore},set:function(e){my_dataStore=e}},my_description:{get:function(){return my_description},set:function(e){my_description=e}},DICT_save_object_POSITION:{get:function(){return DICT_save_object_POSITION},set:function(e){DICT_save_object_POSITION=e}},LIST_objects:{get:function(){return LIST_objects},set:function(e){LIST_objects=e}},j:{get:function(){return j},set:function(e){j=e}},DICT_save_object_ROTATION:{get:function(){return DICT_save_object_ROTATION},set:function(e){DICT_save_object_ROTATION=e}},DICT_save_object_SCALE:{get:function(){return DICT_save_object_SCALE},set:function(e){DICT_save_object_SCALE=e}},LIST_text_items:{get:function(){return LIST_text_items},set:function(e){LIST_text_items=e}},load_object_color:{get:function(){return load_object_color},set:function(e){load_object_color=e}},LIST_colors:{get:function(){return LIST_colors},set:function(e){LIST_colors=e}},load_object_material:{get:function(){return load_object_material},set:function(e){load_object_material=e}},color_of_clicked_menu_item:{get:function(){return color_of_clicked_menu_item},set:function(e){color_of_clicked_menu_item=e}}});Function("app","v3d","VARS","PROC",'window.addEventListener("contextmenu", e => e.preventDefault());')(appInstance,v3d,e,PROC)}function dictSet(e,t,n){e&&"object"==typeof e&&(e[t]=n)}function SET_DICT_OBJECT_COLORS(){dictSet(DICT_object_colors={},"Cube","red"),dictSet(DICT_object_colors,"Cone","green"),dictSet(DICT_object_colors,"Torus","blue")}function SETUP_OBJECTS(){SET_DICT_OBJECT_COLORS(),DRAG_OBJECTS_LOOP(),HOVER_MENU_ITEMS(),CLICK_OBJECTS(),CLICK_MENU_ITEMS_LOOP()}function CLICK_MENU_ITEMS_LOOP(){for(var e in LIST_hitboxes)CLICK_MENU_ITEMS(i=LIST_hitboxes[e])}function notIgnoredObj(e){return!("AmbientLight"===e.type||""===e.name||e.isMesh&&e.isMaterialGeneratedMesh||e.isAuxClippingMesh)}function getObjectByName(e){var t,n=void 0!==_pGlob;return(t=n?_pGlob.objCache[e]:null)&&t.name===e?t:(appInstance.scene.traverse(function(o){!t&&notIgnoredObj(o)&&o.name==e&&(t=o,n&&(_pGlob.objCache[e]=t))}),t)}function getAllObjectNames(){var e=[];return appInstance.scene.traverse(function(t){notIgnoredObj(t)&&e.push(t.name)}),e}function getObjectNamesByGroupName(e){var t=[];return appInstance.scene.traverse(function(n){if(notIgnoredObj(n)){var o=n.groupNames;if(!o)return;for(var r=0;r<o.length;r++){o[r]==e&&t.push(n.name)}}}),t}function retrieveObjectNames(e){var t=[];return retrieveObjectNamesAcc(e,t),t.filter(function(e){return e})}function retrieveObjectNamesAcc(e,t){if("string"==typeof e)t.push(e);else if(Array.isArray(e)&&"GROUP"==e[0])for(var n=getObjectNamesByGroupName(e[1]),o=0;o<n.length;o++)t.push(n[o]);else if(Array.isArray(e)&&"ALL_OBJECTS"==e[0])for(n=getAllObjectNames(),o=0;o<n.length;o++)t.push(n[o]);else if(Array.isArray(e))for(o=0;o<e.length;o++)retrieveObjectNamesAcc(e[o],t)}function isMeshObj(e){if(e.isMesh)return!0;for(var t=0;t<e.children.length;t++){var n=e.children[t];if(n.isMesh&&n.isMaterialGeneratedMesh)return!0}return!1}function getObjectsFromCollect(e,t,n){if(notIgnoredObj(e)){switch(t){case"ALL":n.indexOf(e.name)<0&&n.push(e.name);break;case"ANNOTATION":e.isAnnotation&&n.indexOf(e.name)<0&&n.push(e.name);break;case"BONE":e.isBone&&n.indexOf(e.name)<0&&n.push(e.name);break;case"CAMERA":e.isCamera&&n.indexOf(e.name)<0&&n.push(e.name);break;case"EMPTY":e.isAnnotationControl||e.isBone||e.isCamera||e.isGroup||e.isLine||e.isLOD||e.isLight||isMeshObj(e)||e.isPoints||e.isScene||e.isSprite||!(n.indexOf(e.name)<0)||n.push(e.name);break;case"LIGHT":e.isLight&&n.indexOf(e.name)<0&&n.push(e.name);break;case"MESH":isMeshObj(e)&&n.indexOf(e.name)<0&&n.push(e.name);break;default:console.error("getObjectsFrom: Unknown object type: "+t)}for(var o=0;o<e.children.length;o++){getObjectsFromCollect(e.children[o],t,n)}}}function getObjectsFrom(e,t){for(var n=[],o=retrieveObjectNames(e),r=0;r<o.length;r++){var i=o[r];if(i){var a=getObjectByName(i);a&&getObjectsFromCollect(a,t,n)}}return n}function changeVis(e,t){for(var n=retrieveObjectNames(e),o=0;o<n.length;o++){var r=n[o];if(r){var i=getObjectByName(r);i&&(i.visible=t)}}}function SET_LISTS(){selected_item=null,LIST_hovered_items=getObjectsFrom(["GROUP","HOVERED_ITEMS"],"MESH"),LIST_objects=getObjectsFrom(["GROUP","OBJECTS"],"MESH"),LIST_hitboxes=getObjectsFrom(["GROUP","HITBOXES"],"MESH"),LIST_text_items=getObjectsFrom(["GROUP","TEXT_ITEMS"],"MESH"),LIST_colors=["red","green","blue"],changeVis("RESET_SCENE",!1),changeVis("RESET_SCENE_HITBOX ",!1)}function NEXT_COLOR(e,t){return"red"==e?next_color="green":"green"==e?next_color="blue":"blue"==e&&(next_color="red"),dictSet(DICT_object_colors,t,next_color),next_color}function getObjectMaterial(e){for(var t=retrieveObjectNames(e),n=0;n<t.length;n++){var o=t[n];if(o){var r=getObjectByName(o);if(r&&(r=r.resolveMultiMaterial()[0]).material&&"string"==typeof r.material.name)return r.material.name}}return""}function matGetColors(e){var t=v3d.SceneUtils.getMaterialByName(appInstance,e);return t?t.isMeshNodeMaterial?Object.keys(t.nodeRGBMap):t.isMeshStandardMaterial?["color","emissive"]:[]:[]}function getMaterialColor(e,t,n){if(!(matGetColors(e).indexOf(t)<0)){var o=v3d.SceneUtils.getMaterialsByName(appInstance,e);if(o.length){var r=o[0],i=_pGlob.colorTmp;if(r.isMeshNodeMaterial){var a=r.nodeRGBMap[t];i.r=r.nodeRGB[a].x,i.g=r.nodeRGB[a].y,i.b=r.nodeRGB[a].z}else i.copy(r[t]);switch(n){case"R":case"G":case"B":return i[n.toLowerCase()];case"RGB":return i.toArray();case"CSS_HEX":case"CSS_RGB":return i.convertLinearToSRGB(),"CSS_HEX"==n?"#"+i.getHexString():i.getStyle()}}}}function setMaterialColor(e,t,n,o,r,i){if(!(matGetColors(e).indexOf(t)<0)){if(i){var a=new v3d.Color(i);a.convertSRGBToLinear(),n=a.r,o=a.g,r=a.b}for(var c=v3d.SceneUtils.getMaterialsByName(appInstance,e),s=0;s<c.length;s++){var u=c[s];if(u.isMeshNodeMaterial){var l=u.nodeRGBMap[t];u.nodeRGB[l].x=n,u.nodeRGB[l].y=o,u.nodeRGB[l].z=r}else u[t].r=n,u[t].g=o,u[t].b=r;u.needsUpdate=!0,null!==appInstance.scene&&u===appInstance.scene.worldMaterial&&appInstance.updateEnvironment(u)}}}function registerSetTimeout(e,t){window.setTimeout(t,1e3*e)}function initObjectPicking(e,t,n,o){var r=appInstance.renderer.domElement;if(r.addEventListener(t,u),v3d.PL.editorEventListeners&&v3d.PL.editorEventListeners.push([r,t,u]),"mousedown"==t){var i=n?"touchstart":"touchend";r.addEventListener(i,u),v3d.PL.editorEventListeners&&v3d.PL.editorEventListeners.push([r,i,u])}else if("dblclick"==t){var a=0;function c(e){var t=(new Date).getTime()-a;if(t<600&&t>0)return u(e),void(a=0);a=(new Date).getTime()}i=n?"touchstart":"touchend";r.addEventListener(i,c),v3d.PL.editorEventListeners&&v3d.PL.editorEventListeners.push([r,i,c])}var s=new v3d.Raycaster;function u(t){if(appInstance.getCamera()){t.preventDefault();var n=0,i=0;if(t instanceof MouseEvent){if(o&&-1==o.indexOf(t.button))return;n=t.offsetX/r.clientWidth,i=t.offsetY/r.clientHeight}else if(t instanceof TouchEvent){var a=r.getBoundingClientRect();n=(t.changedTouches[0].clientX-a.left)/a.width,i=(t.changedTouches[0].clientY-a.top)/a.height}_pGlob.screenCoords.x=2*n-1,_pGlob.screenCoords.y=2*-i+1,s.setFromCamera(_pGlob.screenCoords,appInstance.getCamera(!0));var c=[];appInstance.scene.traverse(function(e){c.push(e)});var u=s.intersectObjects(c);e(u,t)}}}function objectsIncludeObj(e,t){if(!t)return!1;for(var n=0;n<e.length;n++){if(t==e[n])return!0;var o=getObjectByName(e[n]);if(o&&"Group"==o.type)for(var r=0;r<o.children.length;r++)if(t==o.children[r].name)return!0}return!1}function getPickedObjectName(e){return e.isMesh&&e.isMaterialGeneratedMesh&&e.parent?e.parent.name:e.name}function registerOnClick(e,t,n,o,r,i){_pGlob.objClickInfo=_pGlob.objClickInfo||[],_pGlob.objClickInfo.push({objSelector:e,callbacks:[r,i]}),initObjectPicking(function(n,o){for(var a=!1,c=t?n.length:Math.min(1,n.length),s=0;s<c;s++){var u=getPickedObjectName(n[s].object);objectsIncludeObj(retrieveObjectNames(e),u)&&(_pGlob.pickedObject=u,a=!0,r(o))}a||(_pGlob.pickedObject="",i(o))},n?"dblclick":"mousedown",!1,o)}function CLICK_MENU_ITEMS(e){registerOnClick(e,!1,!1,[0,1,2],function(){selected_object_Hitbox=e,console.log("selected_object_Hitbox: "),console.log(selected_object_Hitbox),selected_item=e.slice(0,e.length-8),console.log("selected item: "),console.log(selected_item),color_of_clicked_menu_item=getMaterialColor(getObjectMaterial(selected_item),"Color","CSS_HEX"),setMaterialColor(getObjectMaterial(selected_item),"Color",0,0,0,"white"),registerSetTimeout(1,function(){setMaterialColor(getObjectMaterial(selected_item),"Color",0,0,0,color_of_clicked_menu_item)});var t=Object.defineProperties({},{obj:{get:function(){return e},set:function(t){e=t}},save_object:{get:function(){return save_object},set:function(e){save_object=e}},loaded_DICTIONARY:{get:function(){return loaded_DICTIONARY},set:function(e){loaded_DICTIONARY=e}},DICT_load_object:{get:function(){return DICT_load_object},set:function(e){DICT_load_object=e}},current_color:{get:function(){return current_color},set:function(e){current_color=e}},current_object:{get:function(){return current_object},set:function(e){current_object=e}},DICT_object_colors:{get:function(){return DICT_object_colors},set:function(e){DICT_object_colors=e}},i:{get:function(){return i},set:function(e){i=e}},selected_item:{get:function(){return selected_item},set:function(e){selected_item=e}},EXEC_TEXT_instructions:{get:function(){return EXEC_TEXT_instructions},set:function(e){EXEC_TEXT_instructions=e}},DICT_save_object:{get:function(){return DICT_save_object},set:function(e){DICT_save_object=e}},my_saved_key:{get:function(){return my_saved_key},set:function(e){my_saved_key=e}},DICT_save_all_objects:{get:function(){return DICT_save_all_objects},set:function(e){DICT_save_all_objects=e}},m:{get:function(){return m},set:function(e){m=e}},load_object:{get:function(){return load_object},set:function(e){load_object=e}},next_color:{get:function(){return next_color},set:function(e){next_color=e}},length_of_CSV:{get:function(){return length_of_CSV},set:function(e){length_of_CSV=e}},LIST_keys_from_database:{get:function(){return LIST_keys_from_database},set:function(e){LIST_keys_from_database=e}},LIST_hitboxes:{get:function(){return LIST_hitboxes},set:function(e){LIST_hitboxes=e}},LIST_hovered_items:{get:function(){return LIST_hovered_items},set:function(e){LIST_hovered_items=e}},selected_object_Hitbox:{get:function(){return selected_object_Hitbox},set:function(e){selected_object_Hitbox=e}},my_database:{get:function(){return my_database},set:function(e){my_database=e}},my_dataStore:{get:function(){return my_dataStore},set:function(e){my_dataStore=e}},my_description:{get:function(){return my_description},set:function(e){my_description=e}},DICT_save_object_POSITION:{get:function(){return DICT_save_object_POSITION},set:function(e){DICT_save_object_POSITION=e}},LIST_objects:{get:function(){return LIST_objects},set:function(e){LIST_objects=e}},j:{get:function(){return j},set:function(e){j=e}},DICT_save_object_ROTATION:{get:function(){return DICT_save_object_ROTATION},set:function(e){DICT_save_object_ROTATION=e}},DICT_save_object_SCALE:{get:function(){return DICT_save_object_SCALE},set:function(e){DICT_save_object_SCALE=e}},LIST_text_items:{get:function(){return LIST_text_items},set:function(e){LIST_text_items=e}},load_object_color:{get:function(){return load_object_color},set:function(e){load_object_color=e}},LIST_colors:{get:function(){return LIST_colors},set:function(e){LIST_colors=e}},load_object_material:{get:function(){return load_object_material},set:function(e){load_object_material=e}},color_of_clicked_menu_item:{get:function(){return color_of_clicked_menu_item},set:function(e){color_of_clicked_menu_item=e}}});Function("app","v3d","VARS","PROC","let selectedItem = VARS['selected_item'];\nlet command = `v3d.puzzles.procedures.${selectedItem}()`;\neval(command);")(appInstance,v3d,t,PROC)},function(){})}function SET_INSTRUCTIONS(){EXEC_TEXT_instructions="Welcome to the [ GLIFTEK ] Web Storage Plugin Demo.\\n\nInstructions:\\n\nLeft Click: Move objects\\n\nMiddle Click: Scale Objects\\n\nRight Click: Rotate Objects\\n\n\nTo access your browser's offline web storage interface,\\n\nopen your Broswer Dev Tools (f12 on most) and select:\\n\n\nFirefox: Storage Tab\\n\nChrome: Application Tab, Storage Section\\n\nEdge: Application Tab, Storage Section\\n\nOpera: Ctrl+Shift+I, Application Tab, Storage Section\\n\n\nLinks to browser support stats of the three storage drivers\\n\nused in this plugin:\\n\nIndexedDB - https://caniuse.com/indexeddb\\n\nLocalStorage - https://caniuse.com/mdn-api_window_localstorage\\n\nWebSQL - https://caniuse.com/sql-storage\\n"}function getCoordSystem(){var e=appInstance.scene;return e&&"v3d"in e.userData&&"coordSystem"in e.userData.v3d?e.userData.v3d.coordSystem:"Z_UP_RIGHT"}function coordsTransform(e,t,n,o){if(t==n)return e;var r=e.y,i=e.z;return"Z_UP_RIGHT"==t&&"Y_UP_RIGHT"==n?(e.y=i,e.z=o?r:-r):"Y_UP_RIGHT"==t&&"Z_UP_RIGHT"==n?(e.y=o?i:-i,e.z=r):console.error("coordsTransform: Unsupported coordinate space"),e}var eulerV3DToBlenderShortest=(eulerTmp=new v3d.Euler,eulerTmp2=new v3d.Euler,vec3Tmp=new v3d.Vector3,function(e,t){var n=eulerTmp.copy(e).reorder("YZX"),o=eulerTmp2.copy(n).makeAlternative(),r=n.toVector3(vec3Tmp).lengthSq(),i=o.toVector3(vec3Tmp).lengthSq();return t.copy(r<i?n:o),coordsTransform(t,"Y_UP_RIGHT","Z_UP_RIGHT")}),eulerTmp,eulerTmp2,vec3Tmp;function RotationInterface(){this._userRotation=new v3d.Euler(0,0,0,"ZYX"),this._actualRotation=new v3d.Euler}function getObjTransform(e,t,n){if(e){var o=getObjectByName(e);if(o){var r,i=getCoordSystem();if("rotation"===t&&"Z_UP_RIGHT"==i)r=eulerV3DToBlenderShortest(o.rotation,_pGlob.eulerTmp);else if("rotation"===t&&"Y_UP_RIGHT"==i){r=RotationInterface.initObject(o).getUserRotation(_pGlob.eulerTmp)}else r=coordsTransform(o[t].clone(),"Y_UP_RIGHT",i,"scale"===t);return"rotation"===t&&(r.x=v3d.MathUtils.radToDeg(r.x),r.y=v3d.MathUtils.radToDeg(r.y),r.z=v3d.MathUtils.radToDeg(r.z)),"xyz"==n?r.toArray().slice(0,3):r[n]}}}function GET_DATA_FROM_OBJECTS(e){return DICT_save_object_POSITION={},DICT_save_object_ROTATION={},DICT_save_object_SCALE={},dictSet(DICT_save_object={},"name",e),dictSet(DICT_save_object_POSITION,"x",getObjTransform(e,"position","x")),dictSet(DICT_save_object_POSITION,"y",getObjTransform(e,"position","y")),dictSet(DICT_save_object_POSITION,"z",getObjTransform(e,"position","z")),dictSet(DICT_save_object_ROTATION,"x",getObjTransform(e,"rotation","x")),dictSet(DICT_save_object_ROTATION,"y",getObjTransform(e,"rotation","y")),dictSet(DICT_save_object_ROTATION,"z",getObjTransform(e,"rotation","z")),dictSet(DICT_save_object_SCALE,"x",getObjTransform(e,"scale","x")),dictSet(DICT_save_object_SCALE,"y",getObjTransform(e,"scale","y")),dictSet(DICT_save_object_SCALE,"z",getObjTransform(e,"scale","z")),dictSet(DICT_save_object,"position",DICT_save_object_POSITION),dictSet(DICT_save_object,"rotation",DICT_save_object_ROTATION),dictSet(DICT_save_object,"scale",DICT_save_object_SCALE),dictSet(DICT_save_object,"color",getMaterialColor(getObjectMaterial(e),"Color","CSS_HEX")),DICT_save_object}function objConstraintAddLimit(e,t,n,o,r,i,a,c){var s;if("DISTANCE"==n){if(!i)return;var u=getObjectByName(i);if(!u)return}s=retrieveObjectNames(t);for(var l=0;l<s.length;l++){var f=s[l];if(f){var _=getObjectByName(f);if(_&&_.constraints){for(var d=_.constraints.length-1;d>=0;d--)_.constraints[d].name==e&&_.constraints.splice(d,1);var b=getCoordSystem();switch(n){case"POS_X":case"POS_Y":case"POS_Z":if((p=new v3d.LimitLocationConstraint).name=e,"Z_UP_RIGHT"==b)var v="POS_X"==n?0:"POS_Y"==n?2:1;else v="POS_X"==n?0:"POS_Y"==n?1:2;"Z_UP_RIGHT"==b&&"POS_Y"==n?(p.min.setComponent(v,-r),p.max.setComponent(v,-o)):(p.min.setComponent(v,o),p.max.setComponent(v,r)),_.constraints.push(p);break;case"ROT_X":case"ROT_Y":case"ROT_Z":(p=new v3d.LimitRotationConstraint).name=e,p.axis="Z_UP_RIGHT"==b?"ROT_X"==n?"X":"ROT_Y"==n?"Z":"Y":"ROT_X"==n?"X":"ROT_Y"==n?"Y":"Z","Z_UP_RIGHT"==b&&"ROT_Y"==n?(p.min=v3d.MathUtils.degToRad(-r),p.max=v3d.MathUtils.degToRad(-o)):(p.min=v3d.MathUtils.degToRad(o),p.max=v3d.MathUtils.degToRad(r)),_.constraints.push(p);break;case"SCALE_X":case"SCALE_Y":case"SCALE_Z":if((p=new v3d.LimitScaleConstraint).name=e,"Z_UP_RIGHT"==b)v="SCALE_X"==n?0:"SCALE_Y"==n?2:1;else v="SCALE_X"==n?0:"SCALE_Y"==n?1:2;p.min.setComponent(v,o),p.max.setComponent(v,r),_.constraints.push(p);break;case"DISTANCE":var p;(p=new v3d.LimitDistanceConstraint(u)).name=e,p.distance=a,p.limitMode=c,_.constraints.push(p)}}}}}function SET_CONSTRAINTS(){objConstraintAddLimit("myConst1",LIST_objects,"POS_X",-8,8,void 0,void 0,void 0),objConstraintAddLimit("myConst2",LIST_objects,"POS_Y",-3,4,void 0,void 0,void 0)}function getElements(e,t){var n=[];if(Array.isArray(e)&&"CONTAINER"!=e[0]&&"WINDOW"!=e[0]&&"DOCUMENT"!=e[0]&&"BODY"!=e[0]&&"QUERYSELECTOR"!=e[0])for(var o=0;o<e.length;o++)n.push(getElement(e[o],t));else n.push(getElement(e,t));return n}function getElement(e,t){var n;if(Array.isArray(e)&&"CONTAINER"==e[0]){if(null!==appInstance)n=appInstance.container;else if("undefined"!=typeof _initGlob){e=_initGlob.container;n=t?parent.document.getElementById(e):document.getElementById(e)}}else n=Array.isArray(e)&&"WINDOW"==e[0]?t?parent:window:Array.isArray(e)&&"DOCUMENT"==e[0]?t?parent.document:document:Array.isArray(e)&&"BODY"==e[0]?t?parent.document.body:document.body:Array.isArray(e)&&"QUERYSELECTOR"==e[0]?t?parent.document.querySelector(e):document.querySelector(e):t?parent.document.getElementById(e):document.getElementById(e);return n}function setHTMLElemStyle(e,t,n,o){for(var r=getElements(n,o),i=0;i<r.length;i++){var a=r[i];a&&a.style&&(a.style[e]=t)}}function registerOnHover(e,t,n,o){_pGlob.objHoverInfo=_pGlob.objHoverInfo||[],_pGlob.objHoverInfo.push({objSelector:e,callbacks:[n,o],xRay:t})}function HOVER_MENU_ITEMS(){registerOnHover(LIST_hovered_items,!1,function(){setHTMLElemStyle("cursor","pointer",["CONTAINER"],!1)},function(){setHTMLElemStyle("cursor","default",["CONTAINER"],!1)})}function configureWebStorage(){return function(databaseName,size,storeName,description,driverDropdown){const puzzleName="Configure Web Storage";function mainFunction(){function driverCheck(){let driverName=eval("localforage."+driverDropdown);!0!==localforage.supports(driverName)?(console.log("[ GLIFTEK ]: The",puzzleName,"plugin says: Driver",driverDropdown,"(",driverName,") is NOT supported by this browser.\nSwitching to IndexedDB (asyncStorage)."),driverName=eval("localforage.INDEXEDDB"),makeDB(driverName)):(console.log("[ GLIFTEK ]: The",puzzleName,"plugin says: Using driver",driverDropdown,"(",driverName,") is supported by this browser."),makeDB(driverName))}function makeDB(e){window.userWebStorage=localforage.createInstance({driver:e,size:size,storeName:storeName,name:databaseName})}function loadLocalForageJS(){!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).localforage=e()}}(function(){return function e(t,n,o){function r(a,c){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!c&&s)return s(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return r(t[a][1][e]||e)},l,l.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(e,t,n){(function(e){function n(){u=!0;for(var e,t,n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}u=!1}var o,r=e.MutationObserver||e.WebKitMutationObserver;if(r){var i=0,a=new r(n),c=e.document.createTextNode("");a.observe(c,{characterData:!0}),o=function(){c.data=i=++i%2}}else if(e.setImmediate||void 0===e.MessageChannel)o="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){n(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(n,0)};else{var s=new e.MessageChannel;s.port1.onmessage=n,o=function(){s.port2.postMessage(0)}}var u,l=[];t.exports=function(e){1!==l.push(e)||u||o()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){function o(){}function r(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=b,this.queue=[],this.outcome=void 0,e!==o&&s(this,e)}function i(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function a(e,t,n){l(function(){var o;try{o=t(n)}catch(t){return f.reject(e,t)}o===e?f.reject(e,new TypeError("Cannot resolve promise with itself")):f.resolve(e,o)})}function c(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function s(e,t){function n(t){r||(r=!0,f.reject(e,t))}function o(t){r||(r=!0,f.resolve(e,t))}var r=!1,i=u(function(){t(o,n)});"error"===i.status&&n(i.value)}function u(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}var l=e(1),f={},_=["REJECTED"],d=["FULFILLED"],b=["PENDING"];t.exports=r,r.prototype.catch=function(e){return this.then(null,e)},r.prototype.then=function(e,t){if("function"!=typeof e&&this.state===d||"function"!=typeof t&&this.state===_)return this;var n=new this.constructor(o);return this.state!==b?a(n,this.state===d?e:t,this.outcome):this.queue.push(new i(n,e,t)),n},i.prototype.callFulfilled=function(e){f.resolve(this.promise,e)},i.prototype.otherCallFulfilled=function(e){a(this.promise,this.onFulfilled,e)},i.prototype.callRejected=function(e){f.reject(this.promise,e)},i.prototype.otherCallRejected=function(e){a(this.promise,this.onRejected,e)},f.resolve=function(e,t){var n=u(c,t);if("error"===n.status)return f.reject(e,n.value);var o=n.value;if(o)s(e,o);else{e.state=d,e.outcome=t;for(var r=-1,i=e.queue.length;++r<i;)e.queue[r].callFulfilled(t)}return e},f.reject=function(e,t){e.state=_,e.outcome=t;for(var n=-1,o=e.queue.length;++n<o;)e.queue[n].callRejected(t);return e},r.resolve=function(e){return e instanceof this?e:f.resolve(new this(o),e)},r.reject=function(e){var t=new this(o);return f.reject(t,e)},r.all=function(e){function t(e,t){n.resolve(e).then(function(e){a[t]=e,++c!==r||i||(i=!0,f.resolve(u,a))},function(e){i||(i=!0,f.reject(u,e))})}var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var a=new Array(r),c=0,s=-1,u=new this(o);++s<r;)t(e[s],s);return u},r.race=function(e){function t(e){n.resolve(e).then(function(e){i||(i=!0,f.resolve(c,e))},function(e){i||(i=!0,f.reject(c,e))})}var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var a=-1,c=new this(o);++a<r;)t(e[a]);return c}},{1:1}],3:[function(e,t,n){(function(t){"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){function o(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(r){if("TypeError"!==r.name)throw r;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),o=0;o<e.length;o+=1)n.append(e[o]);return n.getBlob(t.type)}}function r(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function i(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function a(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function c(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function s(e){for(var t=e.length,n=new ArrayBuffer(t),o=new Uint8Array(n),r=0;r<t;r++)o[r]=e.charCodeAt(r);return n}function u(e){return"boolean"==typeof w?N.resolve(w):function(e){return new N(function(t){var n=e.transaction(R,x),r=o([""]);n.objectStore(R).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}}).catch(function(){return!1})}(e).then(function(e){return w=e})}function l(e){var t=G[e.name],n={};n.promise=new N(function(e,t){n.resolve=e,n.reject=t}),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then(function(){return n.promise}):t.dbReady=n.promise}function f(e){var t=G[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function _(e,t){var n=G[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function d(e,t){return new N(function(n,o){if(G[e.name]=G[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);l(e),e.db.close()}var r=[e.name];t&&r.push(e.version);var i=L.open.apply(L,r);t&&(i.onupgradeneeded=function(t){var n=i.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(R)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),i.onerror=function(e){e.preventDefault(),o(i.error)},i.onsuccess=function(){n(i.result),f(e)}})}function b(e){return d(e,!1)}function v(e){return d(e,!0)}function p(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),o=e.version<e.db.version,r=e.version>e.db.version;if(o&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),r||n){if(n){var i=e.db.version+1;i>e.version&&(e.version=i)}return!0}return!1}function g(e){return o([s(atob(e.data))],{type:e.type})}function m(e){return e&&e.__local_forage_encoded_blob}function T(e){var t=this,n=t._initReady().then(function(){var e=G[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return i(n,e,e),n}function h(e,t,n,o){void 0===o&&(o=1);try{var r=e.db.transaction(e.storeName,t);n(null,r)}catch(r){if(o>0&&(!e.db||"InvalidStateError"===r.name||"NotFoundError"===r.name))return N.resolve().then(function(){if(!e.db||"NotFoundError"===r.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),v(e)}).then(function(){return function(e){l(e);for(var t=G[e.name],n=t.forages,o=0;o<n.length;o++){var r=n[o];r._dbInfo.db&&(r._dbInfo.db.close(),r._dbInfo.db=null)}return e.db=null,b(e).then(function(t){return e.db=t,p(e)?v(e):t}).then(function(o){e.db=t.db=o;for(var r=0;r<n.length;r++)n[r]._dbInfo.db=o}).catch(function(t){throw _(e,t),t})}(e).then(function(){h(e,t,n,o-1)})}).catch(n);n(r)}}function S(e){var t,n,o,r,i,a=.75*e.length,c=e.length,s=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var u=new ArrayBuffer(a),l=new Uint8Array(u);for(t=0;t<c;t+=4)n=k.indexOf(e[t]),o=k.indexOf(e[t+1]),r=k.indexOf(e[t+2]),i=k.indexOf(e[t+3]),l[s++]=n<<2|o>>4,l[s++]=(15&o)<<4|r>>2,l[s++]=(3&r)<<6|63&i;return u}function E(e){var t,n=new Uint8Array(e),o="";for(t=0;t<n.length;t+=3)o+=k[n[t]>>2],o+=k[(3&n[t])<<4|n[t+1]>>4],o+=k[(15&n[t+1])<<2|n[t+2]>>6],o+=k[63&n[t+2]];return n.length%3==2?o=o.substring(0,o.length-1)+"=":n.length%3==1&&(o=o.substring(0,o.length-2)+"=="),o}function I(e,t,n,o){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,o)}function y(e,t,n,o,r,i){e.executeSql(n,o,r,function(e,a){a.code===a.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],function(e,c){c.rows.length?i(e,a):I(e,t,function(){e.executeSql(n,o,r,i)},i)},i):i(e,a)},i)}function O(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function C(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||localStorage.length>0}function A(e,t){e[t]=function(){var n=arguments;return e.ready().then(function(){return e[t].apply(e,n)})}}function j(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(se(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();"undefined"==typeof Promise&&e(3);var N=Promise,R="local-forage-detect-blob-support",w=void 0,G={},B=Object.prototype.toString,M="readonly",x="readwrite",P={_driver:"asyncStorage",_initStorage:function(e){function t(){return N.resolve()}var n=this,o={db:null};if(e)for(var r in e)o[r]=e[r];var i=G[o.name];i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},G[o.name]=i),i.forages.push(n),n._initReady||(n._initReady=n.ready,n.ready=T);for(var a=[],c=0;c<i.forages.length;c++){var s=i.forages[c];s!==n&&a.push(s._initReady().catch(t))}var u=i.forages.slice(0);return N.all(a).then(function(){return o.db=i.db,b(o)}).then(function(e){return o.db=e,p(o,n._defaultConfig.version)?v(o):e}).then(function(e){o.db=i.db=e,n._dbInfo=o;for(var t=0;t<u.length;t++){var r=u[t];r!==n&&(r._dbInfo.db=o.db,r._dbInfo.version=o.version)}})},_support:function(){try{if(!L||!L.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,o=new N(function(t,o){n.ready().then(function(){h(n._dbInfo,M,function(r,i){if(r)return o(r);try{var a=i.objectStore(n._dbInfo.storeName).openCursor(),c=1;a.onsuccess=function(){var n=a.result;if(n){var o=n.value;m(o)&&(o=g(o));var r=e(o,n.key,c++);void 0!==r?t(r):n.continue()}else t()},a.onerror=function(){o(a.error)}}catch(e){o(e)}})}).catch(o)});return r(o,t),o},getItem:function(e,t){var n=this;e=a(e);var o=new N(function(t,o){n.ready().then(function(){h(n._dbInfo,M,function(r,i){if(r)return o(r);try{var a=i.objectStore(n._dbInfo.storeName).get(e);a.onsuccess=function(){var e=a.result;void 0===e&&(e=null),m(e)&&(e=g(e)),t(e)},a.onerror=function(){o(a.error)}}catch(e){o(e)}})}).catch(o)});return r(o,t),o},setItem:function(e,t,n){var o=this;e=a(e);var i=new N(function(n,r){var i;o.ready().then(function(){return i=o._dbInfo,"[object Blob]"===B.call(t)?u(i.db).then(function(e){return e?t:function(e){return new N(function(t,n){var o=new FileReader;o.onerror=n,o.onloadend=function(n){var o=btoa(n.target.result||"");t({__local_forage_encoded_blob:!0,data:o,type:e.type})},o.readAsBinaryString(e)})}(t)}):t}).then(function(t){h(o._dbInfo,x,function(i,a){if(i)return r(i);try{var c=a.objectStore(o._dbInfo.storeName);null===t&&(t=void 0);var s=c.put(t,e);a.oncomplete=function(){void 0===t&&(t=null),n(t)},a.onabort=a.onerror=function(){var e=s.error?s.error:s.transaction.error;r(e)}}catch(e){r(e)}})}).catch(r)});return r(i,n),i},removeItem:function(e,t){var n=this;e=a(e);var o=new N(function(t,o){n.ready().then(function(){h(n._dbInfo,x,function(r,i){if(r)return o(r);try{var a=i.objectStore(n._dbInfo.storeName).delete(e);i.oncomplete=function(){t()},i.onerror=function(){o(a.error)},i.onabort=function(){var e=a.error?a.error:a.transaction.error;o(e)}}catch(e){o(e)}})}).catch(o)});return r(o,t),o},clear:function(e){var t=this,n=new N(function(e,n){t.ready().then(function(){h(t._dbInfo,x,function(o,r){if(o)return n(o);try{var i=r.objectStore(t._dbInfo.storeName).clear();r.oncomplete=function(){e()},r.onabort=r.onerror=function(){var e=i.error?i.error:i.transaction.error;n(e)}}catch(e){n(e)}})}).catch(n)});return r(n,e),n},length:function(e){var t=this,n=new N(function(e,n){t.ready().then(function(){h(t._dbInfo,M,function(o,r){if(o)return n(o);try{var i=r.objectStore(t._dbInfo.storeName).count();i.onsuccess=function(){e(i.result)},i.onerror=function(){n(i.error)}}catch(e){n(e)}})}).catch(n)});return r(n,e),n},key:function(e,t){var n=this,o=new N(function(t,o){e<0?t(null):n.ready().then(function(){h(n._dbInfo,M,function(r,i){if(r)return o(r);try{var a=i.objectStore(n._dbInfo.storeName),c=!1,s=a.openKeyCursor();s.onsuccess=function(){var n=s.result;n?0===e?t(n.key):c?t(n.key):(c=!0,n.advance(e)):t(null)},s.onerror=function(){o(s.error)}}catch(e){o(e)}})}).catch(o)});return r(o,t),o},keys:function(e){var t=this,n=new N(function(e,n){t.ready().then(function(){h(t._dbInfo,M,function(o,r){if(o)return n(o);try{var i=r.objectStore(t._dbInfo.storeName).openKeyCursor(),a=[];i.onsuccess=function(){var t=i.result;t?(a.push(t.key),t.continue()):e(a)},i.onerror=function(){n(i.error)}}catch(e){n(e)}})}).catch(n)});return r(n,e),n},dropInstance:function(e,t){t=c.apply(this,arguments);var n,o=this.config();if((e="function"!=typeof e&&e||{}).name||(e.name=e.name||o.name,e.storeName=e.storeName||o.storeName),e.name){var i=e.name===o.name&&this._dbInfo.db?N.resolve(this._dbInfo.db):b(e).then(function(t){var n=G[e.name],o=n.forages;n.db=t;for(var r=0;r<o.length;r++)o[r]._dbInfo.db=t;return t});n=e.storeName?i.then(function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;l(e);var o=G[e.name],r=o.forages;t.close();for(var i=0;i<r.length;i++){var a=r[i];a._dbInfo.db=null,a._dbInfo.version=n}return new N(function(t,o){var r=L.open(e.name,n);r.onerror=function(e){r.result.close(),o(e)},r.onupgradeneeded=function(){r.result.deleteObjectStore(e.storeName)},r.onsuccess=function(){var e=r.result;e.close(),t(e)}}).then(function(e){o.db=e;for(var t=0;t<r.length;t++){var n=r[t];n._dbInfo.db=e,f(n._dbInfo)}}).catch(function(t){throw(_(e,t)||N.resolve()).catch(function(){}),t})}}):i.then(function(t){l(e);var n=G[e.name],o=n.forages;t.close();for(var r=0;r<o.length;r++)o[r]._dbInfo.db=null;return new N(function(t,n){var o=L.deleteDatabase(e.name);o.onerror=o.onblocked=function(e){var t=o.result;t&&t.close(),n(e)},o.onsuccess=function(){var e=o.result;e&&e.close(),t(e)}}).then(function(e){n.db=e;for(var t=0;t<o.length;t++)f(o[t]._dbInfo)}).catch(function(t){throw(_(e,t)||N.resolve()).catch(function(){}),t})})}else n=N.reject("Invalid arguments");return r(n,t),n}},k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",z="~~local_forage_type~",X=/^~~local_forage_type~([^~]+)~/,F="__lfsc__:",Y=F.length,U="arbf",W="blob",H="si08",K="ui08",V="uic8",J="si16",Z="si32",q="ur16",Q="ui32",$="fl32",ee="fl64",te=Y+U.length,ne=Object.prototype.toString,oe={serialize:function(e,t){var n="";if(e&&(n=ne.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===ne.call(e.buffer))){var o,r=F;e instanceof ArrayBuffer?(o=e,r+=U):(o=e.buffer,"[object Int8Array]"===n?r+=H:"[object Uint8Array]"===n?r+=K:"[object Uint8ClampedArray]"===n?r+=V:"[object Int16Array]"===n?r+=J:"[object Uint16Array]"===n?r+=q:"[object Int32Array]"===n?r+=Z:"[object Uint32Array]"===n?r+=Q:"[object Float32Array]"===n?r+=$:"[object Float64Array]"===n?r+=ee:t(new Error("Failed to get type for BinaryArray"))),t(r+E(o))}else if("[object Blob]"===n){var i=new FileReader;i.onload=function(){var n=z+e.type+"~"+E(this.result);t(F+W+n)},i.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,Y)!==F)return JSON.parse(e);var t,n=e.substring(te),r=e.substring(Y,te);if(r===W&&X.test(n)){var i=n.match(X);t=i[1],n=n.substring(i[0].length)}var a=S(n);switch(r){case U:return a;case W:return o([a],{type:t});case H:return new Int8Array(a);case K:return new Uint8Array(a);case V:return new Uint8ClampedArray(a);case J:return new Int16Array(a);case q:return new Uint16Array(a);case Z:return new Int32Array(a);case Q:return new Uint32Array(a);case $:return new Float32Array(a);case ee:return new Float64Array(a);default:throw new Error("Unkown type: "+r)}},stringToBuffer:S,bufferToString:E},re={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var o in e)n[o]="string"!=typeof e[o]?e[o].toString():e[o];var r=new N(function(e,o){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return o(e)}n.db.transaction(function(r){I(r,n,function(){t._dbInfo=n,e()},function(e,t){o(t)})},o)});return n.serializer=oe,r},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,o=new N(function(t,o){n.ready().then(function(){var r=n._dbInfo;r.db.transaction(function(n){y(n,r,"SELECT * FROM "+r.storeName,[],function(n,o){for(var i=o.rows,a=i.length,c=0;c<a;c++){var s=i.item(c),u=s.value;if(u&&(u=r.serializer.deserialize(u)),void 0!==(u=e(u,s.key,c+1)))return void t(u)}t()},function(e,t){o(t)})})}).catch(o)});return r(o,t),o},getItem:function(e,t){var n=this;e=a(e);var o=new N(function(t,o){n.ready().then(function(){var r=n._dbInfo;r.db.transaction(function(n){y(n,r,"SELECT * FROM "+r.storeName+" WHERE key = ? LIMIT 1",[e],function(e,n){var o=n.rows.length?n.rows.item(0).value:null;o&&(o=r.serializer.deserialize(o)),t(o)},function(e,t){o(t)})})}).catch(o)});return r(o,t),o},setItem:function(e,t,n){return function e(t,n,o,i){var c=this;t=a(t);var s=new N(function(r,a){c.ready().then(function(){void 0===n&&(n=null);var s=n,u=c._dbInfo;u.serializer.serialize(n,function(n,l){l?a(l):u.db.transaction(function(e){y(e,u,"INSERT OR REPLACE INTO "+u.storeName+" (key, value) VALUES (?, ?)",[t,n],function(){r(s)},function(e,t){a(t)})},function(n){if(n.code===n.QUOTA_ERR){if(i>0)return void r(e.apply(c,[t,s,o,i-1]));a(n)}})})}).catch(a)});return r(s,o),s}.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=a(e);var o=new N(function(t,o){n.ready().then(function(){var r=n._dbInfo;r.db.transaction(function(n){y(n,r,"DELETE FROM "+r.storeName+" WHERE key = ?",[e],function(){t()},function(e,t){o(t)})})}).catch(o)});return r(o,t),o},clear:function(e){var t=this,n=new N(function(e,n){t.ready().then(function(){var o=t._dbInfo;o.db.transaction(function(t){y(t,o,"DELETE FROM "+o.storeName,[],function(){e()},function(e,t){n(t)})})}).catch(n)});return r(n,e),n},length:function(e){var t=this,n=new N(function(e,n){t.ready().then(function(){var o=t._dbInfo;o.db.transaction(function(t){y(t,o,"SELECT COUNT(key) as c FROM "+o.storeName,[],function(t,n){var o=n.rows.item(0).c;e(o)},function(e,t){n(t)})})}).catch(n)});return r(n,e),n},key:function(e,t){var n=this,o=new N(function(t,o){n.ready().then(function(){var r=n._dbInfo;r.db.transaction(function(n){y(n,r,"SELECT key FROM "+r.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,n){var o=n.rows.length?n.rows.item(0).key:null;t(o)},function(e,t){o(t)})})}).catch(o)});return r(o,t),o},keys:function(e){var t=this,n=new N(function(e,n){t.ready().then(function(){var o=t._dbInfo;o.db.transaction(function(t){y(t,o,"SELECT key FROM "+o.storeName,[],function(t,n){for(var o=[],r=0;r<n.rows.length;r++)o.push(n.rows.item(r).key);e(o)},function(e,t){n(t)})})}).catch(n)});return r(n,e),n},dropInstance:function(e,t){t=c.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var o,i=this;return r(o=e.name?new N(function(t){var o;o=e.name===n.name?i._dbInfo.db:openDatabase(e.name,"","",0),t(e.storeName?{db:o,storeNames:[e.storeName]}:function(e){return new N(function(t,n){e.transaction(function(o){o.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(n,o){for(var r=[],i=0;i<o.rows.length;i++)r.push(o.rows.item(i).name);t({db:e,storeNames:r})},function(e,t){n(t)})},function(e){n(e)})})}(o))}).then(function(e){return new N(function(t,n){e.db.transaction(function(o){function r(e){return new N(function(t,n){o.executeSql("DROP TABLE IF EXISTS "+e,[],function(){t()},function(e,t){n(t)})})}for(var i=[],a=0,c=e.storeNames.length;a<c;a++)i.push(r(e.storeNames[a]));N.all(i).then(function(){t()}).catch(function(e){n(e)})},function(e){n(e)})})}):N.reject("Invalid arguments"),t),o}},ie={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=O(e,this._defaultConfig),C()?(this._dbInfo=t,t.serializer=oe,N.resolve()):N.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,o=n.ready().then(function(){for(var t=n._dbInfo,o=t.keyPrefix,r=o.length,i=localStorage.length,a=1,c=0;c<i;c++){var s=localStorage.key(c);if(0===s.indexOf(o)){var u=localStorage.getItem(s);if(u&&(u=t.serializer.deserialize(u)),void 0!==(u=e(u,s.substring(r),a++)))return u}}});return r(o,t),o},getItem:function(e,t){var n=this;e=a(e);var o=n.ready().then(function(){var t=n._dbInfo,o=localStorage.getItem(t.keyPrefix+e);return o&&(o=t.serializer.deserialize(o)),o});return r(o,t),o},setItem:function(e,t,n){var o=this;e=a(e);var i=o.ready().then(function(){void 0===t&&(t=null);var n=t;return new N(function(r,i){var a=o._dbInfo;a.serializer.serialize(t,function(t,o){if(o)i(o);else try{localStorage.setItem(a.keyPrefix+e,t),r(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||i(e),i(e)}})})});return r(i,n),i},removeItem:function(e,t){var n=this;e=a(e);var o=n.ready().then(function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)});return r(o,t),o},clear:function(e){var t=this,n=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var o=localStorage.key(n);0===o.indexOf(e)&&localStorage.removeItem(o)}});return r(n,e),n},length:function(e){var t=this.keys().then(function(e){return e.length});return r(t,e),t},key:function(e,t){var n=this,o=n.ready().then(function(){var t,o=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(o.keyPrefix.length)),t});return r(o,t),o},keys:function(e){var t=this,n=t.ready().then(function(){for(var e=t._dbInfo,n=localStorage.length,o=[],r=0;r<n;r++){var i=localStorage.key(r);0===i.indexOf(e.keyPrefix)&&o.push(i.substring(e.keyPrefix.length))}return o});return r(n,e),n},dropInstance:function(e,t){if(t=c.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var o,i=this;return r(o=e.name?new N(function(t){t(e.storeName?O(e,i._defaultConfig):e.name+"/")}).then(function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}}):N.reject("Invalid arguments"),t),o}},ae=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},ce=function(e,t){for(var n=e.length,o=0;o<n;){if(ae(e[o],t))return!0;o++}return!1},se=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},ue={},le={},fe={INDEXEDDB:P,WEBSQL:re,LOCALSTORAGE:ie},_e=[fe.INDEXEDDB._driver,fe.WEBSQL._driver,fe.LOCALSTORAGE._driver],de=["dropInstance"],be=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(de),ve={description:"",driver:_e.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},pe=new(function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),fe)if(fe.hasOwnProperty(n)){var o=fe[n],r=o._driver;this[n]=r,ue[r]||this.defineDriver(o)}this._defaultConfig=j({},ve),this._config=j({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":D(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var o=new N(function(t,n){try{var o=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);for(var a=be.concat("_initStorage"),c=0,s=a.length;c<s;c++){var u=a[c];if((!ce(de,u)||e[u])&&"function"!=typeof e[u])return void n(i)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=N.reject(t);return r(n,arguments[arguments.length-1]),n}},n=0,o=de.length;n<o;n++){var i=de[n];e[i]||(e[i]=t(i))}}();var l=function(n){ue[o]&&console.info("Redefining LocalForage driver: "+o),ue[o]=e,le[o]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(l,n):l(!!e._support):l(!0)}catch(e){n(e)}});return i(o,t,n),o},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var o=ue[e]?N.resolve(ue[e]):N.reject(new Error("Driver not found."));return i(o,t,n),o},e.prototype.getSerializer=function(e){var t=N.resolve(oe);return i(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return i(n,e,e),n},e.prototype.setDriver=function(e,t,n){function o(){a._config.driver=a.driver()}function r(e){return a._extend(e),o(),a._ready=a._initStorage(a._config),a._ready}var a=this;se(e)||(e=[e]);var c=this._getSupportedDrivers(e),s=null!==this._driverSet?this._driverSet.catch(function(){return N.resolve()}):N.resolve();return this._driverSet=s.then(function(){var e=c[0];return a._dbInfo=null,a._ready=null,a.getDriver(e).then(function(e){a._driver=e._driver,o(),a._wrapLibraryMethodsWithReady(),a._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var i=e[t];return t++,a._dbInfo=null,a._ready=null,a.getDriver(i).then(r).catch(n)}o();var c=new Error("No available storage method found.");return a._driverSet=N.reject(c),a._driverSet}()}}(c)})}).catch(function(){o();var e=new Error("No available storage method found.");return a._driverSet=N.reject(e),a._driverSet}),i(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!le[e]},e.prototype._extend=function(e){j(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,o=e.length;n<o;n++){var r=e[n];this.supports(r)&&t.push(r)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=be.length;e<t;e++)A(this,be[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=pe},{3:3}]},{},[4])(4)})}window.localForageJS=loadLocalForageJS(),console.log("loading localForageJS..."),driverCheck()}databaseName?mainFunction():console.log("[ GLIFTEK ]: The",puzzleName,"plugin puzzle is missing an input!")}.apply(null,arguments)}function CONFIG_WEB_STORAGE(){configureWebStorage(my_database,4980736,my_dataStore,my_description,"INDEXEDDB")}function SET_DATABASE_NAME_VARS(){my_saved_key="all_objects_data_save_01",my_dataStore="myDataStore_01",my_database="myAppsDatabase",my_description="GLIFTEK Web Storage plugin demo.\nSaves objects data to browser storage for later retrivial."}function outline(e,t){var n=retrieveObjectNames(e);if(appInstance.postprocessing&&appInstance.postprocessing.outlinePass)for(var o=appInstance.postprocessing.outlinePass.selectedObjects,r=0;r<n.length;r++){var i=getObjectByName(n[r]);if(i)if("ENABLE"==t)-1==o.indexOf(i)&&o.push(i);else{var a=o.indexOf(i);a>-1&&o.splice(a,1)}}}function HOVER_OBJECTS(){registerOnHover(LIST_objects,!1,function(){outline(_pGlob.hoveredObject,"ENABLE")},function(){outline(_pGlob.hoveredObject,"DISABLE")})}function DRAG_OBJECTS_LOOP(){for(var e in LIST_objects)DRAG_OBJECTS(i=LIST_objects[e])}function SAVE_OBJECT_DATA(){for(var e in DICT_save_all_objects={},LIST_objects)j=LIST_objects[e],dictSet(DICT_save_all_objects,j,GET_DATA_FROM_OBJECTS(j));return DICT_save_all_objects}function setKeyToWebStorage(){return function(e,t,n,o){const r="Set Key (to web storage dataStore)";e?function(){!function(){if(void 0!==window.userWebStorage)window.userWebStorage.config({name:o,storeName:n}),window.userWebStorage.setItem(e,t).then(function(){console.log(t,"saved to web storage.")}).catch(function(e){console.log(e),console.log("web storage failed to save.")});else{const e="[ GLIFTEK Plugins ] - "+r+':\nA "Configure Web Storage" puzzle is needed before\nusing this plugin.';console.log(e),alert(e)}}()}():console.log("[ GLIFTEK ]: The",r,"plugin puzzle is missing an input!")}.apply(null,arguments)}function SAVE_KEY(){console.log('procedure "SAVE_KEY" running.'),setKeyToWebStorage(my_saved_key,SAVE_OBJECT_DATA(),my_dataStore,my_database)}function intersectPlaneCSS(e,t,n,o){var r=_pGlob.vec2Tmp,i=_pGlob.raycasterTmp;return r.x=t/appInstance.getWidth()*2-1,r.y=-n/appInstance.getHeight()*2+1,i.setFromCamera(r,appInstance.getCamera(!0)),i.ray.intersectPlane(e,o)}function dragMove(e,t,n,o){var r=appInstance.getCamera();if(r&&_pGlob.objDragOverInfoByBlock){var i=retrieveObjectNames(e),a=_pGlob.objDragOverInfoByBlock[o];if(a){var c=getObjectByName(a.draggedObjName);if(c){n in _pGlob.dragMoveOrigins||(_pGlob.dragMoveOrigins[n]=[]);for(var s=_pGlob.dragMoveOrigins[n],u=i.length-s.length,l=0;l<u;l++)s.push(new v3d.Vector3);for(l=0;l<i.length;l++){var f=getObjectByName(i[l]);if(f){var _=s[l];a.isMoved||_.copy(f.position);var d=getCoordSystem();if("X"==t||"Y"==t||"Z"==t){if("Z_UP_RIGHT"==d)var b="X"==t?_pGlob.AXIS_X:"Y"==t?_pGlob.AXIS_Z:_pGlob.AXIS_Y,v="X"==t?"x":"Y"==t?"z":"y";else b="X"==t?_pGlob.AXIS_X:"Y"==t?_pGlob.AXIS_Y:_pGlob.AXIS_Z,v="X"==t?"x":"Y"==t?"y":"z";(E=r.getWorldDirection(_pGlob.vec3Tmp)).cross(b).cross(b);var p=intersectPlaneCSS(S=_pGlob.planeTmp.setFromNormalAndCoplanarPoint(E,c.position),a.downX,a.downY,_pGlob.vec3Tmp),g=intersectPlaneCSS(S,a.currX,a.currY,_pGlob.vec3Tmp2);p&&g&&(f.position[v]=_[v]+g[v]-p[v])}else if("XY"==t||"XZ"==t||"YZ"==t){if("Z_UP_RIGHT"==d)var m="XY"==t?_pGlob.AXIS_Y:"XZ"==t?_pGlob.AXIS_Z:_pGlob.AXIS_X,T="XY"==t?"x":"XZ"==t?"x":"y",h="XY"==t?"z":"XZ"==t?"y":"z";else m="XY"==t?_pGlob.AXIS_Z:"XZ"==t?_pGlob.AXIS_Y:_pGlob.AXIS_X,T="XY"==t?"x":"XZ"==t?"x":"y",h="XY"==t?"y":"z";p=intersectPlaneCSS(S=_pGlob.planeTmp.setFromNormalAndCoplanarPoint(m,c.position),a.downX,a.downY,_pGlob.vec3Tmp),g=intersectPlaneCSS(S,a.currX,a.currY,_pGlob.vec3Tmp2);p&&g&&(f.position[T]=_[T]+g[T]-p[T],f.position[h]=_[h]+g[h]-p[h])}else if("XYZ"==t){var S,E=r.getWorldDirection(_pGlob.vec3Tmp);p=intersectPlaneCSS(S=_pGlob.planeTmp.setFromNormalAndCoplanarPoint(E,c.position),a.downX,a.downY,_pGlob.vec3Tmp),g=intersectPlaneCSS(S,a.currX,a.currY,_pGlob.vec3Tmp2);p&&g&&f.position.addVectors(_,g).sub(p)}f.updateMatrixWorld(!0)}}}}}}function eventGetOffsetCoords(e,t,n){if(e instanceof MouseEvent)n.set(e.offsetX,e.offsetY);else if(window.TouchEvent&&e instanceof TouchEvent){var o=e.target.getBoundingClientRect(),r=e.touches;"touchstart"!=e.type&&"touchend"!=e.type&&"touchmove"!=e.type||(r=e.changedTouches);for(var i=r[0],a=0;a<r.length;a++)if(r[a].identifier==t){i=r[a];break}n.set(i.clientX-o.left,i.clientY-o.top)}return n}function eventTouchIdGetFirst(e){return e instanceof MouseEvent?-1:window.TouchEvent&&e instanceof TouchEvent?"touchstart"==e.type||"touchend"==e.type||"touchmove"==e.type?e.changedTouches[0].identifier:e.touches[0].identifier:-1}function eventTouchIdChangedFilter(e,t){if(window.TouchEvent&&e instanceof TouchEvent&&("touchstart"==e.type||"touchend"==e.type||"touchmove"==e.type)){for(var n=!1,o=0;o<e.changedTouches.length;o++)if(e.changedTouches[o].identifier==t){n=!0;break}return n}return!0}function initDragOverInfo(){return{draggedObjName:"",downX:0,downY:0,prevX:0,prevY:0,currX:0,currY:0,isDowned:!1,isMoved:!1,touchId:-1}}function registerOnDrag(e,t,n,o,r,i,a){for(var c=function(e){appInstance.controls&&(appInstance.controls.enabled=!1),a in _pGlob.objDragOverInfoByBlock||(_pGlob.objDragOverInfoByBlock[a]=initDragOverInfo());var t=_pGlob.objDragOverInfoByBlock[a];if(!t.isDowned){var n=eventTouchIdGetFirst(e.downEvent),c=eventGetOffsetCoords(e.downEvent,n,_pGlob.vec2Tmp);t.downX=t.prevX=t.currX=c.x,t.downY=t.prevY=t.currY=c.y,t.touchId=n,t.isDowned=!0,t.isMoved=!1,t.draggedObjName=e.draggedObjName,o(e.downEvent);var s=appInstance.container,u=function(e){if(eventTouchIdChangedFilter(e,t.touchId)){var n=eventGetOffsetCoords(e,t.touchId,_pGlob.vec2Tmp);t.prevX=t.currX,t.prevY=t.currY,t.currX=n.x,t.currY=n.y,r(e),t.isMoved=!0}},l=function(e){if(eventTouchIdChangedFilter(e,t.touchId)){var n=eventGetOffsetCoords(e,t.touchId,_pGlob.vec2Tmp);t.currX=n.x,t.currY=n.y,t.prevX=t.currX,t.prevY=t.currY,i(e),t.isDowned=!1,s.removeEventListener("mousemove",u),s.removeEventListener("touchmove",u),s.removeEventListener("mouseup",l),s.removeEventListener("touchend",l),appInstance.controls&&(appInstance.controls.enabled=!0)}};s.addEventListener("mousemove",u),s.addEventListener("touchmove",u),s.addEventListener("mouseup",l),s.addEventListener("touchend",l)}},s=retrieveObjectNames(e),u=0;u<s.length;u++){var l=s[u];_pGlob.objDragOverInfoGlobal.push({objName:l,callback:c,xRay:t,mouseButtons:n})}}function DRAG_OBJECTS(e){registerOnDrag(e,!1,[0,1,2],function(){outline(e,"ENABLE")},function(){dragMove(e,"XY",")lwA9%AEkfaYLV^270lD","3Kf?{81_=}r?ypP|Mj6X")},function(){outline(e,"DISABLE")},"3Kf?{81_=}r?ypP|Mj6X")}function dictGet(e,t){if(e&&"object"==typeof e)return e[t]}function CLICK_OBJECTS(){registerOnClick(LIST_objects,!1,!1,[0,1,2],function(){setMaterialColor(getObjectMaterial(_pGlob.pickedObject),"Color",0,0,0,NEXT_COLOR(dictGet(DICT_object_colors,_pGlob.pickedObject),_pGlob.pickedObject))},function(){})}function getKeyFromWebStorage(){return function(e,t,n){let o;const r="Get Key (from web storage dataStore)";return e?function(){!function(){if(void 0!==window.userWebStorage)window.userWebStorage.config({name:n,storeName:t}),o=window.userWebStorage.getItem(e).then(function(t){return t?(console.log(e,"loaded from web storage."),t):t?void 0:(console.log(e," does not exist."),e+" does not exist in "+n+".")}).catch(function(e){console.log(e),console.log("web storage failed to load.")});else{const e="[ GLIFTEK Plugins ] - "+r+':\nA "Configure Web Storage" puzzle is needed before\nusing this plugin.';console.log(e),alert(e)}}()}():console.log("[ GLIFTEK ]: The",r,"plugin puzzle is missing an input!"),o}.apply(null,arguments)}function waitPromise(e,t,n){e?e.then(function(e){window.pv=e,_pGlob.promiseValue=e,t()},function(e){_pGlob.promiseValue=e,n()}):(_pGlob.promiseValue="Incorrect promise value",n())}function LOAD_KEY(){console.log('procedure "LOAD_KEY" running.'),waitPromise(getKeyFromWebStorage(my_saved_key,my_dataStore,my_database),function(){LOAD_OBJECT_DATA(_pGlob.promiseValue)},function(){console.log("load from local storage failed.")})}function LOAD_OBJECT_DATA(e){for(var t in e)APPLY_LOADED_DATA_TO_OBJECTS(m=e[t])}function createVector(e,t,n){return[e,t,n]}function setObjTransform(e,t,n,o){var r=n[0],i=n[1],a=n[2],c=retrieveObjectNames(e);function s(e,n,r){o?"scale"!=t?e[t][n]+=r:e[t][n]*=r:e[t][n]=r}var u=_pGlob.vec3Tmp.set(Number(""!==r),Number(""!==i),Number(""!==a)),l=_pGlob.vec3Tmp2.set(r||0,i||0,a||0);"rotation"===t&&l.multiplyScalar(v3d.MathUtils.DEG2RAD);var f=getCoordSystem();coordsTransform(u,f,"Y_UP_RIGHT",!0),coordsTransform(l,f,"Y_UP_RIGHT","scale"===t);for(var _=0;_<c.length;_++){var d=c[_];if(d){var b=getObjectByName(d);if(b){if("rotation"===t&&"Z_UP_RIGHT"==f)coordsTransform(p=eulerV3DToBlenderShortest(b.rotation,_pGlob.eulerTmp),f,"Y_UP_RIGHT"),u.x&&(p.x=o?p.x+l.x:l.x),u.y&&(p.y=o?p.y+l.y:l.y),u.z&&(p.z=o?p.z+l.z:l.z),p.order="YZX",p.reorder(b.rotation.order),b.rotation.copy(p);else if("rotation"===t&&"Y_UP_RIGHT"==f){var v=RotationInterface.initObject(b),p=v.getUserRotation(_pGlob.eulerTmp);u.x&&(p.x=o?p.x+l.x:l.x),u.y&&(p.y=o?p.y+l.y:l.y),u.z&&(p.z=o?p.z+l.z:l.z),v.setUserRotation(p),v.getActualRotation(b.rotation)}else u.x&&s(b,"x",l.x),u.y&&s(b,"y",l.y),u.z&&s(b,"z",l.z);b.updateMatrixWorld(!0)}}}}function APPLY_LOADED_DATA_TO_OBJECTS(e){setObjTransform(load_object=dictGet(e,"name"),"position",createVector(dictGet(dictGet(e,"position"),"x"),dictGet(dictGet(e,"position"),"y"),dictGet(dictGet(e,"position"),"z")),!1),setObjTransform(load_object,"rotation",createVector(dictGet(dictGet(e,"rotation"),"x"),dictGet(dictGet(e,"rotation"),"y"),dictGet(dictGet(e,"rotation"),"z")),!1),setObjTransform(load_object,"scale",createVector(dictGet(dictGet(e,"scale"),"x"),dictGet(dictGet(e,"scale"),"y"),dictGet(dictGet(e,"scale"),"z")),!1),load_object_color=dictGet(e,"color"),setMaterialColor(load_object_material=getObjectMaterial(load_object),"Color",0,0,0,load_object_color)}function deleteKeyFromDataStore(){return function(e,t,n){const o="Delete Key (from web storage dataStore)";e?function(){!function(){if(void 0!==window.userWebStorage)window.userWebStorage.config({name:n,storeName:t}),window.userWebStorage.removeItem(e).then(function(){console.log(e,"deleted from web storage.")}).catch(function(t){console.log(t),console.log("web storage failed to delete",e,".")});else{const e="[ GLIFTEK Plugins ] - "+o+':\nA "Configure Web Storage" puzzle is needed before\nusing this plugin.';console.log(e),alert(e)}}()}():console.log("[ GLIFTEK ]: The",o,"plugin puzzle is missing an input!")}.apply(null,arguments)}function DELETE_KEY(){deleteKeyFromDataStore(my_saved_key,my_database)}function clearWebStorageDatabase(){return function(e){const t="Clear Web Storage";e?function(){!function(){if(void 0!==window.userWebStorage)window.userWebStorage.config({name:e}),window.userWebStorage.clear().then(function(){console.log("all data cleared from",e)}).catch(function(e){console.log(e),console.log("web storage failed to clear.")});else{const e="[ GLIFTEK Plugins ] - "+t+':\nA "Configure Web Storage" puzzle is needed before\nusing this plugin.';console.log(e),alert(e)}}()}():console.log("[ GLIFTEK ]: The",t,"plugin puzzle is missing an input!")}.apply(null,arguments)}function CLEAR_DATABASE(){clearWebStorageDatabase(my_database)}function getLengthOfDataStore(){return function(e,t){let n;const o="Get Length Of DataStore";return e?function(){!function(){if(void 0!==window.userWebStorage)window.userWebStorage.config({name:t,storeName:e}),n=window.userWebStorage.length().then(function(n){console.log("Number of key / value pairs in dataStore",e,"in",t,"is",n)}).catch(function(e){console.log(e),console.log("get web storage database length failed.")});else{const e="[ GLIFTEK Plugins ] - "+o+':\nA "Configure Web Storage" puzzle is needed before\nusing this plugin.';console.log(e),alert(e)}}()}():console.log("[ GLIFTEK ]: The",o,"plugin puzzle is missing an input!"),n}.apply(null,arguments)}function GET_LENGTH_OF_DATASTORE(){length_of_CSV=getLengthOfDataStore(my_dataStore,my_database)}function getKeysOfDataStore(){return function(e,t){let n;const o="Get Keys Of DataStore";return e?function(){!function(){if(void 0!==window.userWebStorage)window.userWebStorage.config({name:t,storeName:e}),n=window.userWebStorage.keys().then(function(t){return console.log("keys in",e,":",t),t}).catch(function(e){console.log(e),console.log("get keys of web storage database failed.")});else{const e="[ GLIFTEK Plugins ] - "+o+':\nA "Configure Web Storage" puzzle is needed before\nusing this plugin.';console.log(e),alert(e)}}()}():console.log("[ GLIFTEK ]: The",o,"plugin puzzle is missing an input!"),n}.apply(null,arguments)}function GET_ALL_KEYS(){LIST_keys_from_database=getKeysOfDataStore(my_dataStore,my_database),console.log("LIST_keys_from_database: "),console.log(LIST_keys_from_database)}function removeDataStore(){return function(e,t){const n="Delete DataStore";e?function(){!function(){if(void 0!==window.userWebStorage)window.userWebStorage.dropInstance({name:t,storeName:e}).then(function(){console.log("store",e,"removed from web storage database",t,".")}).catch(function(t){console.log(t),console.log("web storage failed to remove",e,".")});else{const e="[ GLIFTEK Plugins ] - "+n+':\nA "Configure Web Storage" puzzle is needed before\nusing this plugin.';console.log(e),alert(e)}}()}():console.log("[ GLIFTEK ]: The",n,"plugin puzzle is missing an input!")}.apply(null,arguments)}function DELETE_DATASTORE(){removeDataStore(my_dataStore,my_database)}function removeDatabaseFromWebStorage(){return function(e){const t="Remove Database From Web Storage";e?function(){!function(){if(void 0!==window.userWebStorage)window.userWebStorage.dropInstance({name:e}).then(function(){console.log("database",e,"removed from web storage.")}).catch(function(t){console.log(t),console.log("web storage failed to remove",e,".")});else{const e="[ GLIFTEK Plugins ] - "+t+':\nA "Configure Web Storage" puzzle is needed before\nusing this plugin.';console.log(e),alert(e)}}()}():console.log("[ GLIFTEK ]: The",t,"plugin puzzle is missing an input!")}.apply(null,arguments)}function DELETE_DATABASE(){removeDatabaseFromWebStorage(my_database)}function iterateThroughWebStorage(){return function(e,t,n,o,r){e?(console.log("key",t),console.log("value: ",e),console.log("iterationNumber: ",n),console.log("storeName",o),console.log("databaseName: ",r),window.userWebStorage.config({driver:localforage.LOCALSTORAGE,name:r,storeName:o}),window.userWebStorage.iterate(function(e,t,n){console.log([t,e])}).then(function(){console.log("Iteration has completed")}).catch(function(e){console.log(e)}),window.userWebStorage.iterate(function(e,t,n){if(!(n<3))return[t,e];console.log([t,e])}).then(function(e){console.log("Iteration has completed, last iterated pair:"),console.log(e)}).catch(function(e){console.log(e)})):console.log("[ GLIFTEK ]: The","Iterate Through Web Storage","plugin puzzle is missing an input!")}.apply(null,arguments)}function ITERATE_DATASTORE(){iterateThroughWebStorage(my_saved_key,"someValue",0,my_dataStore,my_database)}Object.assign(RotationInterface,{initObject:function(e){void 0===e.userData.v3d.puzzles&&(e.userData.v3d.puzzles={}),void 0===e.userData.v3d.puzzles.rotationInterface&&(e.userData.v3d.puzzles.rotationInterface=new RotationInterface);var t=e.userData.v3d.puzzles.rotationInterface;return t.updateFromObject(e),t}}),Object.assign(RotationInterface.prototype,{updateFromObject:function(e){this._actualRotation.equalsEps(e.rotation,1e-8)||(this._actualRotation.copy(e.rotation),this._updateUserRotFromActualRot())},getActualRotation:function(e){return e.copy(this._actualRotation)},setUserRotation:function(e){this._userRotation.set(e.x,e.y,e.z),this._updateActualRotFromUserRot()},getUserRotation:function(e){return e.copy(this._userRotation)},_updateUserRotFromActualRot:function(){var e=this._userRotation.order;this._userRotation.copy(this._actualRotation).reorder(e)},_updateActualRotFromUserRot:function(){var e=this._actualRotation.order;this._actualRotation.copy(this._userRotation).reorder(e)}}),initObjectPicking(function(e,t){var n=_pGlob.hoveredObject,o="";_pGlob.objHoverInfo=_pGlob.objHoverInfo||[];var r=1/0;_pGlob.objHoverInfo.forEach(function(t){for(var n=t.xRay?e.length:Math.min(1,e.length),i=0;i<n;i++){var a=getPickedObjectName(e[i].object);objectsIncludeObj(retrieveObjectNames(t.objSelector),a)&&i<=r&&(o=a,r=i)}}),n!=o&&(_pGlob.objHoverInfo.forEach(function(e){objectsIncludeObj(retrieveObjectNames(e.objSelector),n)&&(_pGlob.hoveredObject=n,e.callbacks[1](t))}),_pGlob.objHoverInfo.forEach(function(e){objectsIncludeObj(retrieveObjectNames(e.objSelector),o)&&(_pGlob.hoveredObject=o,e.callbacks[0](t))}),_pGlob.hoveredObject=o)},"mousemove",!1),_pGlob.dragMoveOrigins={},_pGlob.objDragOverInfoGlobal=[],_pGlob.objDragOverInfoByBlock={},initObjectPicking(function(e,t){_pGlob.objDragOverInfoGlobal.forEach(function(n){if(!(t instanceof MouseEvent&&-1==n.mouseButtons.indexOf(t.button)))for(var o=n.xRay?e.length:Math.min(1,e.length),r=0;r<o;r++){var i=getPickedObjectName(e[r].object);objectsIncludeObj([n.objName],i)&&n.callback({downEvent:t,draggedObjName:i})}})},"mousedown",!0),_pGlob.promiseValue="",MAIN()}}();