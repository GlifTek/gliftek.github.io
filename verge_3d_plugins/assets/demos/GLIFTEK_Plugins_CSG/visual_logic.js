'use strict';(function(){var LIST_NONE="<none>",_pGlob={};_pGlob.objCache={},_pGlob.fadeAnnotations=!0,_pGlob.pickedObject="",_pGlob.hoveredObject="",_pGlob.mediaElements={},_pGlob.loadedFile="",_pGlob.states=[],_pGlob.percentage=0,_pGlob.openedFile="",_pGlob.xrSessionAcquired=!1,_pGlob.xrSessionCallbacks=[],_pGlob.screenCoords=new v3d.Vector2,_pGlob.intervalTimers={},_pGlob.AXIS_X=new v3d.Vector3(1,0,0),_pGlob.AXIS_Y=new v3d.Vector3(0,1,0),_pGlob.AXIS_Z=new v3d.Vector3(0,0,1),_pGlob.MIN_DRAG_SCALE=.001,_pGlob.SET_OBJ_ROT_EPS=1e-8,_pGlob.vec2Tmp=new v3d.Vector2,_pGlob.vec2Tmp2=new v3d.Vector2,_pGlob.vec3Tmp=new v3d.Vector3,_pGlob.vec3Tmp2=new v3d.Vector3,_pGlob.vec3Tmp3=new v3d.Vector3,_pGlob.vec3Tmp4=new v3d.Vector3,_pGlob.eulerTmp=new v3d.Euler,_pGlob.eulerTmp2=new v3d.Euler,_pGlob.quatTmp=new v3d.Quaternion,_pGlob.quatTmp2=new v3d.Quaternion,_pGlob.colorTmp=new v3d.Color,_pGlob.mat4Tmp=new v3d.Matrix4,_pGlob.planeTmp=new v3d.Plane,_pGlob.raycasterTmp=new v3d.Raycaster;var PL=v3d.PL=v3d.PL||{};v3d.puzzles=PL,PL.procedures=PL.procedures||{},PL.execInitPuzzles=function(a){var b={};b.percentage=0,b.output={initOptions:{fadeAnnotations:!0,useBkgTransp:!1,preserveDrawBuf:!1,useCompAssets:!1,useFullscreen:!0,useCustomPreloader:!1,preloaderStartCb:function(){},preloaderProgressCb:function(){},preloaderEndCb:function(){}}},b.container=void 0!==a&&"container"in a?a.container:"";return b.output.initOptions.fadeAnnotations=!0,b.output.initOptions.useBkgTransp=!0,b.output.initOptions.preserveDrawBuf=!1,b.output.initOptions.useCompAssets=!1,b.output.initOptions.useFullscreen=!0,b.output},PL.init=function(appInstance,initOptions){function notIgnoredObj(a){return"AmbientLight"!==a.type&&""!==a.name&&!(a.isMesh&&a.isMaterialGeneratedMesh)&&!a.isAuxClippingMesh}function getObjectByName(a){var b,c=void 0!==_pGlob;return(b=_pGlob.objCache[a],b&&b.name===a)?b:(appInstance.scene.traverse(function(d){!b&&notIgnoredObj(d)&&d.name==a&&(b=d,c&&(_pGlob.objCache[a]=b))}),b)}function getAllObjectNames(){var a=[];return appInstance.scene.traverse(function(b){notIgnoredObj(b)&&a.push(b.name)}),a}function getObjectNamesByGroupName(a){var b=[];return appInstance.scene.traverse(function(c){if(notIgnoredObj(c)){var d=c.groupNames;if(!d)return;for(var e,f=0;f<d.length;f++)e=d[f],e==a&&b.push(c.name)}}),b}function retrieveObjectNames(a){var b=[];return retrieveObjectNamesAcc(a,b),b.filter(function(a){return a})}function retrieveObjectNamesAcc(a,b){if("string"==typeof a)b.push(a);else if(Array.isArray(a)&&"GROUP"==a[0])for(var c=getObjectNamesByGroupName(a[1]),d=0;d<c.length;d++)b.push(c[d]);else if(Array.isArray(a)&&"ALL_OBJECTS"==a[0])for(var c=getAllObjectNames(),d=0;d<c.length;d++)b.push(c[d]);else if(Array.isArray(a))for(var d=0;d<a.length;d++)retrieveObjectNamesAcc(a[d],b)}function removeObject(a){for(var b,c=retrieveObjectNames(a),d=0;d<c.length;d++)if(b=c[d],b){var e=getObjectByName(b);e&&e.parent&&(e.parent.remove(e),_pGlob.objCache={})}}function changeVis(a,b){for(var c,d=retrieveObjectNames(a),e=0;e<d.length;e++)if(c=d[e],c){var f=getObjectByName(c);f&&(f.visible=b)}}function findUniqueObjectName(a){function b(a){return!!getObjectByName(a)}for(;b(a);){var c=a.match(/^(.*?)(\d+)$/);c?a=c[1]+(parseInt(c[2],10)+1):a+="2"}return a}function cloneObject(a){if(a){var b=getObjectByName(a);if(b){var c=b.clone();return c.name=findUniqueObjectName(b.name),appInstance.scene.add(c),c.name}}}function MAKE_CLONES(){removeObject("myNewObject"),changeVis("Cube_Blue",!0),changeVis("Cube_Red",!0),Cube_Blue_New=cloneObject("Cube_Blue"),Cube_Red_New=cloneObject("Cube_Red"),changeVis("Cube_Blue",!1),changeVis("Cube_Red",!1),CONSTRAINTS()}function createGridHelper(){return function(a,b,c,d){(function(){"undefined"==typeof gridHelperNumber?window.gridHelperNumber=1:gridHelperNumber++;let e=new v3d.GridHelper(a,b,d,c);e.raycast=function(){},e.up.set(0,0,1),e.name="gridHelper_"+gridHelperNumber,app.scene.add(e)})()}.apply(null,arguments)}function getCoordSystem(){var a=appInstance.scene;return a&&"v3d"in a.userData&&"coordSystem"in a.userData.v3d?a.userData.v3d.coordSystem:"Z_UP_RIGHT"}function coordsTransform(a,b,c,d){if(b==c)return a;var e=a.y,f=a.z;return"Z_UP_RIGHT"==b&&"Y_UP_RIGHT"==c?(a.y=f,a.z=d?e:-e):"Y_UP_RIGHT"==b&&"Z_UP_RIGHT"==c?(a.y=d?f:-f,a.z=e):console.error("coordsTransform: Unsupported coordinate space"),a}function intersectPlaneCSS(a,b,c,d){var e=_pGlob.vec2Tmp,f=_pGlob.raycasterTmp;return e.x=2*(b/appInstance.getWidth())-1,e.y=2*-(c/appInstance.getHeight())+1,f.setFromCamera(e,appInstance.getCamera(!0)),f.ray.intersectPlane(a,d)}function dragMove(a,b,c,d){var e=appInstance.getCamera();if(e&&_pGlob.objDragOverInfoByBlock){var f=retrieveObjectNames(a),g=_pGlob.objDragOverInfoByBlock[d];if(g){var h=getObjectByName(g.draggedObjName);if(h){c in _pGlob.dragMoveOrigins||(_pGlob.dragMoveOrigins[c]=[]);for(var j=_pGlob.dragMoveOrigins[c],k=f.length-j.length,l=0;l<k;l++)j.push(new v3d.Vector3);for(var m,l=0;l<f.length;l++)if(m=getObjectByName(f[l]),!!m){var n=j[l];g.isMoved||n.copy(m.position);var o=getCoordSystem();if("X"==b||"Y"==b||"Z"==b){if("Z_UP_RIGHT"==o)var p="X"==b?_pGlob.AXIS_X:"Y"==b?_pGlob.AXIS_Z:_pGlob.AXIS_Y,q="X"==b?"x":"Y"==b?"z":"y";else var p="X"==b?_pGlob.AXIS_X:"Y"==b?_pGlob.AXIS_Y:_pGlob.AXIS_Z,q="X"==b?"x":"Y"==b?"y":"z";var r=e.getWorldDirection(_pGlob.vec3Tmp);r.cross(p).cross(p);var s=_pGlob.planeTmp.setFromNormalAndCoplanarPoint(r,h.position),t=intersectPlaneCSS(s,g.downX,g.downY,_pGlob.vec3Tmp),u=intersectPlaneCSS(s,g.currX,g.currY,_pGlob.vec3Tmp2);t&&u&&(m.position[q]=n[q]+u[q]-t[q])}else if("XY"==b||"XZ"==b||"YZ"==b){if("Z_UP_RIGHT"==o)var v="XY"==b?_pGlob.AXIS_Y:"XZ"==b?_pGlob.AXIS_Z:_pGlob.AXIS_X,w="XY"==b?"x":"XZ"==b?"x":"y",x="XY"==b?"z":"XZ"==b?"y":"z";else var v="XY"==b?_pGlob.AXIS_Z:"XZ"==b?_pGlob.AXIS_Y:_pGlob.AXIS_X,w="XY"==b?"x":"XZ"==b?"x":"y",x="XY"==b?"y":"XZ"==b?"z":"z";var s=_pGlob.planeTmp.setFromNormalAndCoplanarPoint(v,h.position),t=intersectPlaneCSS(s,g.downX,g.downY,_pGlob.vec3Tmp),u=intersectPlaneCSS(s,g.currX,g.currY,_pGlob.vec3Tmp2);t&&u&&(m.position[w]=n[w]+u[w]-t[w],m.position[x]=n[x]+u[x]-t[x])}else if("XYZ"==b){var r=e.getWorldDirection(_pGlob.vec3Tmp),s=_pGlob.planeTmp.setFromNormalAndCoplanarPoint(r,h.position),t=intersectPlaneCSS(s,g.downX,g.downY,_pGlob.vec3Tmp),u=intersectPlaneCSS(s,g.currX,g.currY,_pGlob.vec3Tmp2);t&&u&&m.position.addVectors(n,u).sub(t)}m.updateMatrixWorld(!0)}}}}}function initObjectPicking(a,b,c,d){function e(b){if(appInstance.getCamera()){b.preventDefault();var c=0,e=0;if(b instanceof MouseEvent){if(d&&-1==d.indexOf(b.button))return;c=b.offsetX/f.clientWidth,e=b.offsetY/f.clientHeight}else if(b instanceof TouchEvent){var g=f.getBoundingClientRect();c=(b.changedTouches[0].clientX-g.left)/g.width,e=(b.changedTouches[0].clientY-g.top)/g.height}_pGlob.screenCoords.x=2*c-1,_pGlob.screenCoords.y=2*-e+1,i.setFromCamera(_pGlob.screenCoords,appInstance.getCamera(!0));var h=[];appInstance.scene.traverse(function(a){h.push(a)});var j=i.intersectObjects(h);a(j,b)}}var f=appInstance.renderer.domElement;if(f.addEventListener(b,e),v3d.PL.editorEventListeners&&v3d.PL.editorEventListeners.push([f,b,e]),"mousedown"==b){var g=c?"touchstart":"touchend";f.addEventListener(g,e),v3d.PL.editorEventListeners&&v3d.PL.editorEventListeners.push([f,g,e])}else if("dblclick"==b){function a(a){var b=new Date().getTime(),c=b-h;return 600>c&&0<c?(e(a),void(h=0)):void(h=new Date().getTime())}var h=0,g=c?"touchstart":"touchend";f.addEventListener(g,a),v3d.PL.editorEventListeners&&v3d.PL.editorEventListeners.push([f,g,a])}var i=new v3d.Raycaster}function objectsIncludeObj(a,b){if(!b)return!1;for(var c=0;c<a.length;c++){if(b==a[c])return!0;var d=getObjectByName(a[c]);if(d&&"Group"==d.type)for(var e=0;e<d.children.length;e++)if(b==d.children[e].name)return!0}return!1}function getPickedObjectName(a){return a.isMesh&&a.isMaterialGeneratedMesh&&a.parent?a.parent.name:a.name}function eventGetOffsetCoords(a,b,c){if(a instanceof MouseEvent)c.set(a.offsetX,a.offsetY);else if(window.TouchEvent&&a instanceof TouchEvent){var d=a.target.getBoundingClientRect(),e=a.touches;("touchstart"==a.type||"touchend"==a.type||"touchmove"==a.type)&&(e=a.changedTouches);for(var f=e[0],g=0;g<e.length;g++)if(e[g].identifier==b){f=e[g];break}c.set(f.clientX-d.left,f.clientY-d.top)}return c}function eventTouchIdGetFirst(a){if(a instanceof MouseEvent)return-1;return window.TouchEvent&&a instanceof TouchEvent?"touchstart"==a.type||"touchend"==a.type||"touchmove"==a.type?a.changedTouches[0].identifier:a.touches[0].identifier:-1}function eventTouchIdChangedFilter(a,b){if(window.TouchEvent&&a instanceof TouchEvent&&("touchstart"==a.type||"touchend"==a.type||"touchmove"==a.type)){for(var c=!1,d=0;d<a.changedTouches.length;d++)if(a.changedTouches[d].identifier==b){c=!0;break}return c}return!0}function initDragOverInfo(){return{draggedObjName:"",downX:0,downY:0,prevX:0,prevY:0,currX:0,currY:0,isDowned:!1,isMoved:!1,touchId:-1}}function registerOnDrag(a,b,c,d,f,g,h){for(var j,k=function(a){appInstance.controls&&(appInstance.controls.enabled=!1),(h in _pGlob.objDragOverInfoByBlock)||(_pGlob.objDragOverInfoByBlock[h]=initDragOverInfo());var b=_pGlob.objDragOverInfoByBlock[h];if(!b.isDowned){var c=eventTouchIdGetFirst(a.downEvent),e=eventGetOffsetCoords(a.downEvent,c,_pGlob.vec2Tmp);b.downX=b.prevX=b.currX=e.x,b.downY=b.prevY=b.currY=e.y,b.touchId=c,b.isDowned=!0,b.isMoved=!1,b.draggedObjName=a.draggedObjName,d(a.downEvent);var i=appInstance.container,j=function(a){if(eventTouchIdChangedFilter(a,b.touchId)){var c=eventGetOffsetCoords(a,b.touchId,_pGlob.vec2Tmp);b.prevX=b.currX,b.prevY=b.currY,b.currX=c.x,b.currY=c.y,f(a),b.isMoved=!0}},k=function(a){if(eventTouchIdChangedFilter(a,b.touchId)){var c=eventGetOffsetCoords(a,b.touchId,_pGlob.vec2Tmp);b.currX=c.x,b.currY=c.y,b.prevX=b.currX,b.prevY=b.currY,g(a),b.isDowned=!1,i.removeEventListener("mousemove",j),i.removeEventListener("touchmove",j),i.removeEventListener("mouseup",k),i.removeEventListener("touchend",k),appInstance.controls&&(appInstance.controls.enabled=!0)}};i.addEventListener("mousemove",j),i.addEventListener("touchmove",j),i.addEventListener("mouseup",k),i.addEventListener("touchend",k)}},e=retrieveObjectNames(a),l=0;l<e.length;l++)j=e[l],_pGlob.objDragOverInfoGlobal.push({objName:j,callback:k,xRay:b,mouseButtons:c})}function MAIN(){dropdown_value=null,MAKE_CLONES(),HOVER_CLICK_LOOP(),createGridHelper(10,10,"gray","black"),registerOnDrag(Cube_Blue_New,!1,[0,1,2],function(){},function(){dragMove(Cube_Blue_New,"XY","@3T}C9@?,s`c)%/Rz#77","N8RJ6OAW=bZ5s.c:3YYT")},function(){},"N8RJ6OAW=bZ5s.c:3YYT"),registerOnDrag(Cube_Red_New,!1,[0,1,2],function(){},function(){dragMove(Cube_Red_New,"XY","/GNa(0db;vxM]|OH!f_]","?e3{UQ/QbgynyM]!1^g(")},function(){},"?e3{UQ/QbgynyM]!1^g(")}function isMeshObj(a){if(a.isMesh)return!0;for(var b,c=0;c<a.children.length;c++)if(b=a.children[c],b.isMesh&&b.isMaterialGeneratedMesh)return!0;return!1}function getObjectsFromCollect(a,b,c){if(notIgnoredObj(a)){"ALL"===b?0>c.indexOf(a.name)&&c.push(a.name):"ANNOTATION"===b?a.isAnnotation&&0>c.indexOf(a.name)&&c.push(a.name):"BONE"===b?a.isBone&&0>c.indexOf(a.name)&&c.push(a.name):"CAMERA"===b?a.isCamera&&0>c.indexOf(a.name)&&c.push(a.name):"EMPTY"===b?a.isAnnotationControl||a.isBone||a.isCamera||a.isGroup||a.isLine||a.isLOD||a.isLight||isMeshObj(a)||a.isPoints||a.isScene||a.isSprite||!(0>c.indexOf(a.name))||c.push(a.name):"LIGHT"===b?a.isLight&&0>c.indexOf(a.name)&&c.push(a.name):"MESH"===b?isMeshObj(a)&&0>c.indexOf(a.name)&&c.push(a.name):console.error("getObjectsFrom: Unknown object type: "+b);for(var d,e=0;e<a.children.length;e++)d=a.children[e],getObjectsFromCollect(d,b,c)}}function getObjectsFrom(a,b){for(var c,d=[],e=retrieveObjectNames(a),f=0;f<e.length;f++)if(c=e[f],c){var g=getObjectByName(c);g&&getObjectsFromCollect(g,b,d)}return d}function HOVER_CLICK_LOOP(){var a=getObjectsFrom(["GROUP","Hitboxes"],"MESH");for(var b in a)i=a[b],HOVER_CLICK(i)}function getElements(a,b){var c=[];if(Array.isArray(a)&&"CONTAINER"!=a[0]&&"WINDOW"!=a[0]&&"DOCUMENT"!=a[0]&&"BODY"!=a[0]&&"QUERYSELECTOR"!=a[0])for(var d=0;d<a.length;d++)c.push(getElement(a[d],b));else c.push(getElement(a,b));return c}function getElement(a,b){var c;if(!(Array.isArray(a)&&"CONTAINER"==a[0]))c=Array.isArray(a)&&"WINDOW"==a[0]?b?parent:window:Array.isArray(a)&&"DOCUMENT"==a[0]?b?parent.document:document:Array.isArray(a)&&"BODY"==a[0]?b?parent.document.body:document.body:Array.isArray(a)&&"QUERYSELECTOR"==a[0]?b?parent.document.querySelector(a):document.querySelector(a):b?parent.document.getElementById(a):document.getElementById(a);else if(null!==appInstance)c=appInstance.container;else if("undefined"!=typeof _initGlob){var a=_initGlob.container;c=b?parent.document.getElementById(a):document.getElementById(a)}return c}function setHTMLElemStyle(a,b,c,d){for(var e,f=getElements(c,d),g=0;g<f.length;g++)e=f[g],e&&e.style&&(e.style[a]=b)}function outline(a,b){var c=retrieveObjectNames(a);if(appInstance.postprocessing&&appInstance.postprocessing.outlinePass)for(var d=appInstance.postprocessing.outlinePass.selectedObjects,e=0;e<c.length;e++){var f=c[e],g=getObjectByName(f);if(g)if("ENABLE"==b)-1==d.indexOf(g)&&d.push(g);else{var h=d.indexOf(g);-1<h&&d.splice(h,1)}}}function registerOnHover(a,b,c,d){_pGlob.objHoverInfo=_pGlob.objHoverInfo||[],_pGlob.objHoverInfo.push({objSelector:a,callbacks:[c,d],xRay:b})}function CSGBooleanFunction(){return function(typeDropdown,typeInput,objInput1,objInput2,resultObjectNameInput,whenDone_Statement_Input){function mainFunction(){function checkType(){typeInput&&""!=typeInput?(booleanType=typeInput,CSG_Function()):(booleanType=typeDropdown,CSG_Function())}function checkJSLoaded(){"undefined"==typeof window.CSG_js_loaded?jsFileLoaderTop(wait):"loaded"==window.CSG_js_loaded&&CSG_Function()}function wait(){setTimeout(CSG_Function(),10)}function CSG_Function(){"loaded"==window.CSG_js_loaded;let meshA=app.scene.getObjectByName(objInput1);console.log("objInput1: ",objInput1);let meshB=app.scene.getObjectByName(objInput2);console.log("objInput2: ",objInput2),meshA.updateMatrix(),meshB.updateMatrix();let bspA=CSG.fromMesh(meshA),bspB=CSG.fromMesh(meshB),bspResult_preEval=`bspA.${booleanType}(bspB);`,bspResult=eval(bspResult_preEval),meshResult=CSG.toMesh(bspResult,meshA.matrix,meshA.material);meshResult.name=resultObjectNameInput,app.scene.add(meshResult),console.log("meshResult: ",meshResult),whenDone_Statement_Input()}let booleanType;class CSG{constructor(){this.polygons=[]}clone(){let a=new CSG;return a.polygons=this.polygons.map(function(a){return a.clone()}),a}toPolygons(){return this.polygons}union(c){let d=new Node(this.clone().polygons),a=new Node(c.clone().polygons);return d.clipTo(a),a.clipTo(d),a.invert(),a.clipTo(d),a.invert(),d.build(a.allPolygons()),CSG.fromPolygons(d.allPolygons())}subtract(c){let d=new Node(this.clone().polygons),a=new Node(c.clone().polygons);return d.invert(),d.clipTo(a),a.clipTo(d),a.invert(),a.clipTo(d),a.invert(),d.build(a.allPolygons()),d.invert(),CSG.fromPolygons(d.allPolygons())}intersect(c){let d=new Node(this.clone().polygons),a=new Node(c.clone().polygons);return d.invert(),a.clipTo(d),a.invert(),d.clipTo(a),a.clipTo(d),d.build(a.allPolygons()),d.invert(),CSG.fromPolygons(d.allPolygons())}inverse(){let a=this.clone();return a.polygons.forEach(a=>a.flip()),a}}CSG.fromPolygons=function(a){let b=new CSG;return b.polygons=a,b};class Vector{constructor(a=0,b=0,c=0){this.x=a,this.y=b,this.z=c}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this}clone(){return new Vector(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(b){return this.x+=b.x,this.y+=b.y,this.z+=b.z,this}sub(b){return this.x-=b.x,this.y-=b.y,this.z-=b.z,this}times(b){return this.x*=b,this.y*=b,this.z*=b,this}dividedBy(b){return this.x/=b,this.y/=b,this.z/=b,this}lerp(b,a){return this.add(tv0.copy(b).sub(this).times(a))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(this.x**2+this.y**2+this.z**2)}normalize(){return this.unit()}cross(c){let b=this;const a=b.x,d=b.y,e=b.z,f=c.x,g=c.y,h=c.z;return this.x=d*h-e*g,this.y=e*f-a*h,this.z=a*g-d*f,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z}}let tv0=new Vector,tv1=new Vector;class Vertex{constructor(a,b,c,d){this.pos=new Vector().copy(a),this.normal=new Vector().copy(b),this.uv=new Vector().copy(c),this.uv.z=0,d&&(this.color=new Vector().copy(d))}clone(){return new Vertex(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(a,b){return new Vertex(this.pos.clone().lerp(a.pos,b),this.normal.clone().lerp(a.normal,b),this.uv.clone().lerp(a.uv,b),this.color&&a.color&&this.color.clone().lerp(a.color,b))}}class Plane{constructor(a,b){this.normal=a,this.w=b}clone(){return new Plane(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(a,c,d,e,g){const h=0,k=1,l=2,m=3;let n=0,o=[];for(let b=0;b<a.vertices.length;b++){let c=this.normal.dot(a.vertices[b].pos)-this.w,d=c<-Plane.EPSILON?l:c>Plane.EPSILON?k:h;n|=d,o.push(d)}switch(n){case h:(0<this.normal.dot(a.plane.normal)?c:d).push(a);break;case k:e.push(a);break;case l:g.push(a);break;case m:let p=[],f=[];for(let b=0;b<a.vertices.length;b++){let c=(b+1)%a.vertices.length,d=o[b],e=o[c],g=a.vertices[b],h=a.vertices[c];if(d!=l&&p.push(g),d!=k&&f.push(d==l?g:g.clone()),(d|e)==m){let a=(this.w-this.normal.dot(g.pos))/this.normal.dot(tv0.copy(h.pos).sub(g.pos)),b=g.interpolate(h,a);p.push(b),f.push(b.clone())}}3<=p.length&&e.push(new Polygon(p,a.shared)),3<=f.length&&g.push(new Polygon(f,a.shared));}}}Plane.EPSILON=1e-5,Plane.fromPoints=function(d,a,b){let c=tv0.copy(a).sub(d).cross(tv1.copy(b).sub(d)).normalize();return new Plane(c.clone(),c.dot(d))};class Polygon{constructor(a,b){this.vertices=a,this.shared=b,this.plane=Plane.fromPoints(a[0].pos,a[1].pos,a[2].pos)}clone(){return new Polygon(this.vertices.map(a=>a.clone()),this.shared)}flip(){this.vertices.reverse().map(a=>a.flip()),this.plane.flip()}}class Node{constructor(a){this.plane=null,this.front=null,this.back=null,this.polygons=[],a&&this.build(a)}clone(){let a=new Node;return a.plane=this.plane&&this.plane.clone(),a.front=this.front&&this.front.clone(),a.back=this.back&&this.back.clone(),a.polygons=this.polygons.map(a=>a.clone()),a}invert(){for(let a=0;a<this.polygons.length;a++)this.polygons[a].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();let a=this.front;this.front=this.back,this.back=a}clipPolygons(a){if(!this.plane)return a.slice();let b=[],c=[];for(let d=0;d<a.length;d++)this.plane.splitPolygon(a[d],b,c,b,c);return this.front&&(b=this.front.clipPolygons(b)),c=this.back?this.back.clipPolygons(c):[],b.concat(c)}clipTo(a){this.polygons=a.clipPolygons(this.polygons),this.front&&this.front.clipTo(a),this.back&&this.back.clipTo(a)}allPolygons(){let a=this.polygons.slice();return this.front&&(a=a.concat(this.front.allPolygons())),this.back&&(a=a.concat(this.back.allPolygons())),a}build(a){if(a.length){this.plane||(this.plane=a[0].plane.clone());let b=[],c=[];for(let d=0;d<a.length;d++)this.plane.splitPolygon(a[d],this.polygons,this.polygons,b,c);b.length&&(!this.front&&(this.front=new Node),this.front.build(b)),c.length&&(!this.back&&(this.back=new Node),this.back.build(c))}}}CSG.fromJSON=function(a){return CSG.fromPolygons(a.polygons.map(a=>new Polygon(a.vertices.map(a=>new Vertex(a.pos,a.normal,a.uv)),a.shared)))},"use strict",CSG.fromGeometry=function(a,b){let c=[];if(a.isGeometry){let d=a.faces,e=a.vertices,g=["a","b","c"];for(let h=0;h<d.length;h++){let i=d[h],f=[];for(let b=0;3>b;b++)f.push(new Vertex(e[i[g[b]]],i.vertexNormals[b],a.faceVertexUvs[0][h][b]));c.push(new Polygon(f,b))}}else if(a.isBufferGeometry){let d,e=a.attributes.position,f=a.attributes.normal,g=a.attributes.uv,h=a.attributes.color;if(a.index)d=a.index.array;else{d=Array(0|e.array.length/e.itemSize);for(let a=0;a<d.length;a++)d[a]=a}let i=0|d.length/3;c=Array(i);for(let a,k=0,i=0,j=d.length;k<j;k+=3,i++){a=[,,,];for(let b=0;3>b;b++){let c=d[k+b],i=3*c,j=2*c,l=e.array[i],m=e.array[i+1],n=e.array[i+2],o=f.array[i],p=f.array[i+1],q=f.array[i+2];a[b]=new Vertex({x:l,y:m,z:n},{x:o,y:p,z:q},g&&{x:g.array[j],y:g.array[j+1],z:0},h&&{x:h.array[j],y:h.array[j+1],z:h.array[j+2]})}c[i]=new Polygon(a,b)}}else console.error("Unsupported CSG input type:"+a.type);return CSG.fromPolygons(c)};let ttvv0=new THREE.Vector3,tmpm3=new THREE.Matrix3;CSG.fromMesh=function(a,b){let c=CSG.fromGeometry(a.geometry,b);tmpm3.getNormalMatrix(a.matrix);for(let d,e=0;e<c.polygons.length;e++){d=c.polygons[e];for(let b,c=0;c<d.vertices.length;c++)b=d.vertices[c],b.pos.copy(ttvv0.copy(b.pos).applyMatrix4(a.matrix)),b.normal.copy(ttvv0.copy(b.normal).applyMatrix3(tmpm3))}return c};let nbuf3=a=>({top:0,array:new Float32Array(a),write:function(a){this.array[this.top++]=a.x,this.array[this.top++]=a.y,this.array[this.top++]=a.z}}),nbuf2=a=>({top:0,array:new Float32Array(a),write:function(a){this.array[this.top++]=a.x,this.array[this.top++]=a.y}});CSG.toGeometry=function(a,b=!0){let c,d=a.polygons;if(!b){c=new Geometry;let a=c.vertices,b=c.faceVertexUvs[0];for(let e=0;e<d.length;e++){let f=d[e],g=f.vertices,h=a.length,i=g.length;for(let b=0;b<i;b++)a.push(new THREE.Vector3().copy(g[b].pos));for(let a=3;a<=i;a++){let d=new THREE.Face3,e=[];b.push(e);let i=d.vertexNormals;d.a=h,d.b=h+a-2,d.c=h+a-1,i.push(new THREE.Vector3().copy(g[0].normal)),i.push(new THREE.Vector3().copy(g[a-2].normal)),i.push(new THREE.Vector3().copy(g[a-1].normal)),e.push(new THREE.Vector3().copy(g[0].uv)),e.push(new THREE.Vector3().copy(g[a-2].uv)),e.push(new THREE.Vector3().copy(g[a-1].uv)),d.normal=new THREE.Vector3().copy(f.plane.normal),c.faces.push(d)}}c=new THREE.BufferGeometry().fromGeometry(c),c.verticesNeedUpdate=c.elementsNeedUpdate=c.normalsNeedUpdate=!0}else{let a=0;d.forEach(b=>a+=b.vertices.length-2),c=new THREE.BufferGeometry;let b,e=nbuf3(3*(3*a)),f=nbuf3(3*(3*a)),g=nbuf2(3*(2*a)),h=[];if(d.forEach(c=>{let d=c.vertices,i=d.length;void 0===c.shared||h[c.shared]||(h[c.shared]=[]),i&&void 0!==d[0].color&&!b&&(b=nbuf3(3*(3*a)));for(let a=3;a<=i;a++)void 0!==c.shared&&h[c.shared].push(e.top/3,e.top/3+1,e.top/3+2),e.write(d[0].pos),e.write(d[a-2].pos),e.write(d[a-1].pos),f.write(d[0].normal),f.write(d[a-2].normal),f.write(d[a-1].normal),g&&g.write(d[0].uv)||g.write(d[a-2].uv)||g.write(d[a-1].uv),b&&(b.write(d[0].color)||b.write(d[a-2].color)||b.write(d[a-1].color))}),c.setAttribute("position",new THREE.BufferAttribute(e.array,3)),c.setAttribute("normal",new THREE.BufferAttribute(f.array,3)),g&&c.setAttribute("uv",new THREE.BufferAttribute(g.array,2)),b&&c.setAttribute("color",new THREE.BufferAttribute(b.array,3)),h.length){let a=[],b=0;for(let d=0;d<h.length;d++)c.addGroup(b,h[d].length,d),b+=h[d].length,a=a.concat(h[d]);c.setIndex(a)}}return c},CSG.toMesh=function(a,b,c){let d=CSG.toGeometry(a),e=new THREE.Matrix4().copy(b).invert();d.applyMatrix4(e),d.computeBoundingSphere(),d.computeBoundingBox();let f=new THREE.Mesh(d,c);return f.matrix.copy(b),f.matrix.decompose(f.position,f.quaternion,f.scale),f.rotation.setFromQuaternion(f.quaternion),f.updateMatrixWorld(),f.castShadow=f.receiveShadow=!0,f},checkType()}const puzzleName="CSG Boolean";objInput1?mainFunction():console.log("[ GLIFTEK ]: The","CSG Boolean","plugin puzzle is missing an input!")}.apply(null,arguments)}function registerOnClick(a,b,c,d,e,f){_pGlob.objClickInfo=_pGlob.objClickInfo||[],_pGlob.objClickInfo.push({objSelector:a,callbacks:[e,f]}),initObjectPicking(function(c,d){for(var g=!1,h=b?c.length:Math.min(1,c.length),j=0;j<h;j++){var k=c[j].object,l=getPickedObjectName(k),m=retrieveObjectNames(a);objectsIncludeObj(m,l)&&(_pGlob.pickedObject=l,g=!0,e(d))}g||(_pGlob.pickedObject="",f(d))},c?"dblclick":"mousedown",!1,d)}function HOVER_CLICK(a){registerOnHover(a,!0,function(){setHTMLElemStyle("cursor","pointer",["CONTAINER"],!1),outline(a.slice(a.length-1,1),"ENABLE")},function(){setHTMLElemStyle("cursor","default",["CONTAINER"],!1),outline(a.slice(a.length-1,1),"DISABLE")}),registerOnClick(a,!0,!1,[0,1,2],function(){dropdown_value=a.slice(0,a.length-7),console.log("dropdown_value: "+(dropdown_value+"")),"reset"==dropdown_value?(console.log("button_reset CLICKED!"),RESET_SCREEN()):CSGBooleanFunction("union",dropdown_value,Cube_Blue_New,Cube_Red_New,"myNewObject",function(){DRAG_NEW_OBJECT()})},function(){})}function objConstraintAddLimit(a,b,c,d,e,f,g,h){var k;if("DISTANCE"==c){if(!f)return;var l=getObjectByName(f);if(!l)return}k=retrieveObjectNames(b);for(var m,n=0;n<k.length;n++)if(m=k[n],m){var o=getObjectByName(m);if(o&&o.constraints){for(var p=o.constraints.length-1;0<=p;p--)o.constraints[p].name==a&&o.constraints.splice(p,1);var q=getCoordSystem();switch(c){case"POS_X":case"POS_Y":case"POS_Z":var r=new v3d.LimitLocationConstraint;if(r.name=a,"Z_UP_RIGHT"==q)var s="POS_X"==c?0:"POS_Y"==c?2:1;else var s="POS_X"==c?0:"POS_Y"==c?1:2;"Z_UP_RIGHT"==q&&"POS_Y"==c?(r.min.setComponent(s,-e),r.max.setComponent(s,-d)):(r.min.setComponent(s,d),r.max.setComponent(s,e)),o.constraints.push(r);break;case"ROT_X":case"ROT_Y":case"ROT_Z":var r=new v3d.LimitRotationConstraint;r.name=a,r.axis="Z_UP_RIGHT"==q?"ROT_X"==c?"X":"ROT_Y"==c?"Z":"Y":"ROT_X"==c?"X":"ROT_Y"==c?"Y":"Z","Z_UP_RIGHT"==q&&"ROT_Y"==c?(r.min=v3d.MathUtils.degToRad(-e),r.max=v3d.MathUtils.degToRad(-d)):(r.min=v3d.MathUtils.degToRad(d),r.max=v3d.MathUtils.degToRad(e)),o.constraints.push(r);break;case"SCALE_X":case"SCALE_Y":case"SCALE_Z":var r=new v3d.LimitScaleConstraint;if(r.name=a,"Z_UP_RIGHT"==q)var s="SCALE_X"==c?0:"SCALE_Y"==c?2:1;else var s="SCALE_X"==c?0:"SCALE_Y"==c?1:2;r.min.setComponent(s,d),r.max.setComponent(s,e),o.constraints.push(r);break;case"DISTANCE":var r=new v3d.LimitDistanceConstraint(l);r.name=a,r.distance=g,r.limitMode=h,o.constraints.push(r);}}}}function CONSTRAINTS(){objConstraintAddLimit("myConst1_Blue2","Cube_Blue2","POS_X",-4,4,"",0,"LIMITDIST_ONSURFACE"),objConstraintAddLimit("myConst2_Blue2","Cube_Blue2","POS_Y",-4,4,"",0,"LIMITDIST_ONSURFACE"),objConstraintAddLimit("myConst1_Red2","Cube_Red2","POS_X",-4,4,"",0,"LIMITDIST_ONSURFACE"),objConstraintAddLimit("myConst2_Red2","Cube_Red2","POS_Y",-4,4,"",0,"LIMITDIST_ONSURFACE")}function CONSTRAINTS_NEW(){objConstraintAddLimit("myConst1_New","myNewObject","POS_X",-4,4,"",0,"LIMITDIST_ONSURFACE"),objConstraintAddLimit("myConst2_New","myNewObject","POS_Y",-4,4,"",0,"LIMITDIST_ONSURFACE")}function isObjectVisible(a){for(var b,c=retrieveObjectNames(a),d=0;d<c.length;d++)if(b=c[d],b){var e=getObjectByName(b);if(e&&e.visible)return!0}return!1}function RESET_SCREEN(){isObjectVisible("myNewObject")&&MAKE_CLONES()}function DRAG_NEW_OBJECT(){removeObject(Cube_Blue_New),removeObject(Cube_Red_New),registerOnDrag("myNewObject",!1,[0,1,2],function(){},function(){dragMove("myNewObject","XY","?Sb6K:HaXn-DOBtMs0|E","FrRRqN8wT87.inMM+2mt"),CONSTRAINTS_NEW()},function(){},"FrRRqN8wT87.inMM+2mt")}var app=appInstance;initOptions=initOptions||{},"fadeAnnotations"in initOptions&&(_pGlob.fadeAnnotations=initOptions.fadeAnnotations),this.procedures.MAKE_CLONES=MAKE_CLONES,this.procedures.MAIN=MAIN,this.procedures.HOVER_CLICK_LOOP=HOVER_CLICK_LOOP,this.procedures.HOVER_CLICK=HOVER_CLICK,this.procedures.CONSTRAINTS=CONSTRAINTS,this.procedures.CONSTRAINTS_NEW=CONSTRAINTS_NEW,this.procedures.RESET_SCREEN=RESET_SCREEN,this.procedures.DRAG_NEW_OBJECT=DRAG_NEW_OBJECT;var obj,dropdown_value,i,Cube_Blue_New,Cube_Red_New,PROC={MAKE_CLONES:MAKE_CLONES,MAIN:MAIN,HOVER_CLICK_LOOP:HOVER_CLICK_LOOP,HOVER_CLICK:HOVER_CLICK,CONSTRAINTS:CONSTRAINTS,CONSTRAINTS_NEW:CONSTRAINTS_NEW,RESET_SCREEN:RESET_SCREEN,DRAG_NEW_OBJECT:DRAG_NEW_OBJECT},eulerV3DToBlenderShortest=function(){var a=new v3d.Euler,b=new v3d.Euler,c=new v3d.Vector3;return function(d,e){var f=a.copy(d).reorder("YZX"),g=b.copy(f).makeAlternative(),h=f.toVector3(c).lengthSq(),i=g.toVector3(c).lengthSq();return e.copy(h<i?f:g),coordsTransform(e,"Y_UP_RIGHT","Z_UP_RIGHT")}}();_pGlob.dragMoveOrigins={},_pGlob.objDragOverInfoGlobal=[],_pGlob.objDragOverInfoByBlock={},initObjectPicking(function(a,b){_pGlob.objDragOverInfoGlobal.forEach(function(c){if(!(b instanceof MouseEvent&&-1==c.mouseButtons.indexOf(b.button)))for(var d=c.xRay?a.length:Math.min(1,a.length),e=0;e<d;e++){var f=a[e].object,g=getPickedObjectName(f);objectsIncludeObj([c.objName],g)&&c.callback({downEvent:b,draggedObjName:g})}})},"mousedown",!0),initObjectPicking(function(a,b){var c=_pGlob.hoveredObject,d="";_pGlob.objHoverInfo=_pGlob.objHoverInfo||[];var e=1/0;_pGlob.objHoverInfo.forEach(function(b){for(var c=b.xRay?a.length:Math.min(1,a.length),f=0;f<c;f++){var g=a[f].object,h=getPickedObjectName(g);objectsIncludeObj(retrieveObjectNames(b.objSelector),h)&&f<=e&&(d=h,e=f)}});c==d||(_pGlob.objHoverInfo.forEach(function(a){objectsIncludeObj(retrieveObjectNames(a.objSelector),c)&&(_pGlob.hoveredObject=c,a.callbacks[1](b))}),_pGlob.objHoverInfo.forEach(function(a){objectsIncludeObj(retrieveObjectNames(a.objSelector),d)&&(_pGlob.hoveredObject=d,a.callbacks[0](b))}),_pGlob.hoveredObject=d)},"mousemove",!1),MAIN()}})();