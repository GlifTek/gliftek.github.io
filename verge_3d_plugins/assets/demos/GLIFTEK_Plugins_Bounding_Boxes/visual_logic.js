"use strict";!function(){var e={objCache:{},fadeAnnotations:!0,pickedObject:"",hoveredObject:"",mediaElements:{},loadedFile:"",states:[],percentage:0,openedFile:"",xrSessionAcquired:!1,xrSessionCallbacks:[]};e.screenCoords=new v3d.Vector2,e.intervalTimers={},e.AXIS_X=new v3d.Vector3(1,0,0),e.AXIS_Y=new v3d.Vector3(0,1,0),e.AXIS_Z=new v3d.Vector3(0,0,1),e.MIN_DRAG_SCALE=.001,e.SET_OBJ_ROT_EPS=1e-8,e.vec2Tmp=new v3d.Vector2,e.vec2Tmp2=new v3d.Vector2,e.vec3Tmp=new v3d.Vector3,e.vec3Tmp2=new v3d.Vector3,e.vec3Tmp3=new v3d.Vector3,e.vec3Tmp4=new v3d.Vector3,e.eulerTmp=new v3d.Euler,e.eulerTmp2=new v3d.Euler,e.quatTmp=new v3d.Quaternion,e.quatTmp2=new v3d.Quaternion,e.colorTmp=new v3d.Color,e.mat4Tmp=new v3d.Matrix4,e.planeTmp=new v3d.Plane,e.raycasterTmp=new v3d.Raycaster;var n=v3d.PL=v3d.PL||{};v3d.puzzles=n,n.procedures=n.procedures||{},n.execInitPuzzles=function(e){var n={percentage:0,output:{initOptions:{fadeAnnotations:!0,useBkgTransp:!1,preserveDrawBuf:!1,useCompAssets:!1,useFullscreen:!0,useCustomPreloader:!1,preloaderStartCb:function(){},preloaderProgressCb:function(){},preloaderEndCb:function(){}}}};return n.container=void 0!==e&&"container"in e?e.container:"",n.output.initOptions.fadeAnnotations=!0,n.output.initOptions.useBkgTransp=!0,n.output.initOptions.preserveDrawBuf=!1,n.output.initOptions.useCompAssets=!1,n.output.initOptions.useFullscreen=!0,n.output},n.init=function(n,t){var o=n;"fadeAnnotations"in(t=t||{})&&(e.fadeAnnotations=t.fadeAnnotations),this.procedures.MAIN=b,this.procedures.TEXT_READOUT=E,this.procedures.GET_SELECTED_OBJECT=A,this.procedures.SET_DICT_OBJECT_COLORS=x,this.procedures["do something"]=M,this.procedures.CHANGE_COLORS_OF_ALL=D,this.procedures["do something2"]=F,this.procedures.UPDATE_READOUT=V,this.procedures["do something3"]=W;var r,i,a,s,c,u,d,l;function v(e){return!("AmbientLight"===e.type||""===e.name||e.isMesh&&e.isMaterialGeneratedMesh||e.isAuxClippingMesh)}function f(t){var o,r=void 0!==e;return(o=r?e.objCache[t]:null)&&o.name===t?o:(n.scene.traverse(function(n){!o&&v(n)&&n.name==t&&(o=n,r&&(e.objCache[t]=o))}),o)}function p(e){var t=[];return function e(t,o){if("string"==typeof t)o.push(t);else if(Array.isArray(t)&&"GROUP"==t[0])for(var r=(a=t[1],s=[],n.scene.traverse(function(e){if(v(e)){var n=e.groupNames;if(!n)return;for(var t=0;t<n.length;t++)n[t]==a&&s.push(e.name)}}),s),i=0;i<r.length;i++)o.push(r[i]);else if(Array.isArray(t)&&"ALL_OBJECTS"==t[0])for(var r=function(){var e=[];return n.scene.traverse(function(n){v(n)&&e.push(n.name)}),e}(),i=0;i<r.length;i++)o.push(r[i]);else if(Array.isArray(t))for(var i=0;i<t.length;i++)e(t[i],o);var a,s}(e,t),t.filter(function(e){return e})}function h(e){if(e.isMesh)return!0;for(var n=0;n<e.children.length;n++){var t=e.children[n];if(t.isMesh&&t.isMaterialGeneratedMesh)return!0}return!1}function m(e,n,t){if(v(e)){switch(n){case"ALL":t.indexOf(e.name)<0&&t.push(e.name);break;case"ANNOTATION":e.isAnnotation&&t.indexOf(e.name)<0&&t.push(e.name);break;case"BONE":e.isBone&&t.indexOf(e.name)<0&&t.push(e.name);break;case"CAMERA":e.isCamera&&t.indexOf(e.name)<0&&t.push(e.name);break;case"EMPTY":e.isAnnotationControl||e.isBone||e.isCamera||e.isGroup||e.isLine||e.isLOD||e.isLight||h(e)||e.isPoints||e.isScene||e.isSprite||!(t.indexOf(e.name)<0)||t.push(e.name);break;case"LIGHT":e.isLight&&t.indexOf(e.name)<0&&t.push(e.name);break;case"MESH":h(e)&&t.indexOf(e.name)<0&&t.push(e.name);break;default:console.error("getObjectsFrom: Unknown object type: "+n)}for(var o=0;o<e.children.length;o++){m(e.children[o],n,t)}}}function g(e,n){for(var t=p(e),o=0;o<t.length;o++){var r=t[o];if(r){var i=f(r);i&&(i.visible=n)}}}function b(){for(var e in function(){(function(e,n,t,r){!function(){"undefined"==typeof gridHelperNumber?window.gridHelperNumber=1:gridHelperNumber++;let i=new v3d.GridHelper(e,n,r,t);i.raycast=function(){},i.up.set(0,0,1),i.name="gridHelper_"+gridHelperNumber,o.scene.add(i)}()}).apply(null,arguments)}(10,10,"gray","black"),function(){(function(e,n,t){e?function(){function r(e){for(let i=0;i<e.length;i++){let a,s,c=e[i],u=a=c instanceof v3d.Object3D?c:o.scene.getObjectByName(c),d=new v3d.Box3,l=u.name+"_Box3";if(d.name=l,d.id=u.name,d.userData={},d.userData.collision=!1,d.userData.previousObjectTouched=null,d.userData.touchingObject=null,d.userData.touchingObjects=[],u.geometry.computeBoundingBox(),d.copy(u.geometry.boundingBox).applyMatrix4(u.matrixWorld),window.LIST_Box3s?window.LIST_Box3s.push(d):(window.LIST_Box3s=[],window.LIST_Box3s.push(d)),1==n){let e=d.name+"_Helper";var r=new v3d.Box3Helper(d,t);r.raycast=function(){},r.name=e,o.scene.add(r),s=!0}}}!function(e){Array.isArray(e)?Array.isArray(e)&&r(e):r(e=[e])}(e)}():console.log("[ GLIFTEK ]: The","Create Bounding Box","plugin puzzle is missing an input!")}).apply(null,arguments)}(r=function(e,n){for(var t=[],o=p(e),r=0;r<o.length;r++){var i=o[r];if(i){var a=f(i);a&&m(a,n,t)}}return t}(["GROUP","Cubes"],"ALL"),!0,"#00cccc"),r)l=r[e],g(String(l)+"_Box3_Helper",!1);E(),x(),A()}function y(e,n){var t=[];if(Array.isArray(e)&&"CONTAINER"!=e[0]&&"WINDOW"!=e[0]&&"DOCUMENT"!=e[0]&&"BODY"!=e[0]&&"QUERYSELECTOR"!=e[0])for(var o=0;o<e.length;o++)t.push(_(e[o],n));else t.push(_(e,n));return t}function _(e,t){var o;if(Array.isArray(e)&&"CONTAINER"==e[0]){if(null!==n)o=n.container;else if("undefined"!=typeof _initGlob){e=_initGlob.container;o=t?parent.document.getElementById(e):document.getElementById(e)}}else o=Array.isArray(e)&&"WINDOW"==e[0]?t?parent:window:Array.isArray(e)&&"DOCUMENT"==e[0]?t?parent.document:document:Array.isArray(e)&&"BODY"==e[0]?t?parent.document.body:document.body:Array.isArray(e)&&"QUERYSELECTOR"==e[0]?t?parent.document.querySelector(e):document.querySelector(e):t?parent.document.getElementById(e):document.getElementById(e);return o}function T(e,n,t,o,r){var i=r?window.parent:window,a=i.document.createElement(e);""!==n&&(a.id=n);var s=_(o,r);if(s instanceof i.Element)switch(t){case"TO":s.appendChild(a);break;case"BEFORE":s.insertAdjacentElement("beforebegin",a);break;case"AFTER":s.insertAdjacentElement("afterend",a)}}function O(e,n,t,o){for(var r=y(t,o),i=0;i<r.length;i++){var a=r[i];a&&a.style&&(a.style[e]=n)}}function E(){"Drag objects to touch.",T("div","readout_for_selected_object","TO",["CONTAINER"],!1),O("fontFamily","Arial","readout_for_selected_object",!1),O("zIndex","2","readout_for_selected_object",!1),O("color","white","readout_for_selected_object",!1),"",T("div","readout_for_all_objects","TO",["CONTAINER"],!1),O("fontFamily","Arial","readout_for_all_objects",!1),O("zIndex","2","readout_for_all_objects",!1),O("color","white","readout_for_all_objects",!1)}function w(e){n.ssaaOnPause=e,n.disableRendering(1)}function B(e,n,t,o){for(var r=y(n,t),i=0;i<r.length;i++){var a=r[i];a&&(a.addEventListener(e,o),v3d.PL.editorEventListeners&&v3d.PL.editorEventListeners.push([a,e,o]))}}function A(){w(!1),B("pointerdown",["CONTAINER"],!1,function(e){n.enableRendering(),M()}),B("pointerup",["CONTAINER"],!1,function(e){g(String(i)+"_Box3_Helper",!1),i=null,w(!1)})}function S(e){for(var n=p(e),t=0;t<n.length;t++){var o=n[t];if(o){var r=f(o);if(r&&(r=r.resolveMultiMaterial()[0]).material&&"string"==typeof r.material.name)return r.material.name}}return""}function I(e){var t=v3d.SceneUtils.getMaterialByName(n,e);return t?t.isMeshNodeMaterial?Object.keys(t.nodeRGBMap):t.isMeshStandardMaterial?["color","emissive"]:[]:[]}function j(t,o,r){if(!(I(t).indexOf(o)<0)){var i=v3d.SceneUtils.getMaterialsByName(n,t);if(i.length){var a=i[0],s=e.colorTmp;if(a.isMeshNodeMaterial){var c=a.nodeRGBMap[o];s.r=a.nodeRGB[c].x,s.g=a.nodeRGB[c].y,s.b=a.nodeRGB[c].z}else s.copy(a[o]);switch(r){case"R":case"G":case"B":return s[r.toLowerCase()];case"RGB":return s.toArray();case"CSS_HEX":case"CSS_RGB":return s.convertLinearToSRGB(),"CSS_HEX"==r?"#"+s.getHexString():s.getStyle()}}}}function x(){for(var e in s={},r)c=r[e],n=s,t=c,o=j(S(c),"Principled BSDF Color","CSS_HEX"),n&&"object"==typeof n&&(n[t]=o);var n,t,o}function M(){for(var e in r)F(r[e])}function X(){return function(e){let n=[];return window.LIST_Box3s.forEach(t=>{let o=t.userData.collision;"touching"==e?1==o&&(n.push(t.id),console.log("LIST_touching_or_not_objects after push:",n)):"not_touching"==e&&0==o&&(n.push(t.id),console.log("LIST_touching_or_not_objects after push:",n))}),n}.apply(null,arguments)}function L(e,t,o,r,i,a){if(!(I(e).indexOf(t)<0)){if(a){var s=new v3d.Color(a);s.convertSRGBToLinear(),o=s.r,r=s.g,i=s.b}for(var c=v3d.SceneUtils.getMaterialsByName(n,e),u=0;u<c.length;u++){var d=c[u];if(d.isMeshNodeMaterial){var l=d.nodeRGBMap[t];d.nodeRGB[l].x=o,d.nodeRGB[l].y=r,d.nodeRGB[l].z=i}else d[t].r=o,d[t].g=r,d[t].b=i;d.needsUpdate=!0,null!==n.scene&&d===n.scene.worldMaterial&&n.updateEnvironment(d)}}}function C(e,n){if(e&&"object"==typeof e)return e[n]}function D(){var e=X("touching");for(var n in e)L(S(e[n]),"Principled BSDF Color",0,0,0,"yellow");var t=X("not_touching");for(var o in t)L(S(u=t[o]),"Principled BSDF Color",0,0,0,C(s,u))}var R,Y,N;R=new v3d.Euler,Y=new v3d.Euler,N=new v3d.Vector3;function P(t,o,r,i){var a=e.vec2Tmp,s=e.raycasterTmp;return a.x=o/n.getWidth()*2-1,a.y=-r/n.getHeight()*2+1,s.setFromCamera(a,n.getCamera(!0)),s.ray.intersectPlane(t,i)}function G(e,n){if(!n)return!1;for(var t=0;t<e.length;t++){if(n==e[t])return!0;var o=f(e[t]);if(o&&"Group"==o.type)for(var r=0;r<o.children.length;r++)if(n==o.children[r].name)return!0}return!1}function k(e){return e.isMesh&&e.isMaterialGeneratedMesh&&e.parent?e.parent.name:e.name}function z(e,n,t){if(e instanceof MouseEvent)t.set(e.offsetX,e.offsetY);else if(window.TouchEvent&&e instanceof TouchEvent){var o=e.target.getBoundingClientRect(),r=e.touches;"touchstart"!=e.type&&"touchend"!=e.type&&"touchmove"!=e.type||(r=e.changedTouches);for(var i=r[0],a=0;a<r.length;a++)if(r[a].identifier==n){i=r[a];break}t.set(i.clientX-o.left,i.clientY-o.top)}return t}function H(e,n){if(window.TouchEvent&&e instanceof TouchEvent&&("touchstart"==e.type||"touchend"==e.type||"touchmove"==e.type)){for(var t=!1,o=0;o<e.changedTouches.length;o++)if(e.changedTouches[o].identifier==n){t=!0;break}return t}return!0}function Z(t,o,r,i,a,s,c){for(var u=function(t){n.controls&&(n.controls.enabled=!1),c in e.objDragOverInfoByBlock||(e.objDragOverInfoByBlock[c]={draggedObjName:"",downX:0,downY:0,prevX:0,prevY:0,currX:0,currY:0,isDowned:!1,isMoved:!1,touchId:-1});var o=e.objDragOverInfoByBlock[c];if(!o.isDowned){var r,u=(r=t.downEvent)instanceof MouseEvent?-1:window.TouchEvent&&r instanceof TouchEvent?"touchstart"==r.type||"touchend"==r.type||"touchmove"==r.type?r.changedTouches[0].identifier:r.touches[0].identifier:-1,d=z(t.downEvent,u,e.vec2Tmp);o.downX=o.prevX=o.currX=d.x,o.downY=o.prevY=o.currY=d.y,o.touchId=u,o.isDowned=!0,o.isMoved=!1,o.draggedObjName=t.draggedObjName,i(t.downEvent);var l=n.container,v=function(n){if(H(n,o.touchId)){var t=z(n,o.touchId,e.vec2Tmp);o.prevX=o.currX,o.prevY=o.currY,o.currX=t.x,o.currY=t.y,a(n),o.isMoved=!0}},f=function(t){if(H(t,o.touchId)){var r=z(t,o.touchId,e.vec2Tmp);o.currX=r.x,o.currY=r.y,o.prevX=o.currX,o.prevY=o.currY,s(t),o.isDowned=!1,l.removeEventListener("mousemove",v),l.removeEventListener("touchmove",v),l.removeEventListener("mouseup",f),l.removeEventListener("touchend",f),n.controls&&(n.controls.enabled=!0)}};l.addEventListener("mousemove",v),l.addEventListener("touchmove",v),l.addEventListener("mouseup",f),l.addEventListener("touchend",f)}},d=p(t),l=0;l<d.length;l++){var v=d[l];e.objDragOverInfoGlobal.push({objName:v,callback:u,xRay:o,mouseButtons:r})}}function F(t){Z(t,!1,[0,1,2],function(){},function(){i=t,g(String(i)+"_Box3_Helper",!0),function(t,o,r,i){var a=n.getCamera();if(a&&e.objDragOverInfoByBlock){var s=p(t),c=e.objDragOverInfoByBlock[i];if(c){var u=f(c.draggedObjName);if(u){r in e.dragMoveOrigins||(e.dragMoveOrigins[r]=[]);for(var d,l=e.dragMoveOrigins[r],v=s.length-l.length,h=0;h<v;h++)l.push(new v3d.Vector3);for(h=0;h<s.length;h++){var m=f(s[h]);if(m){var g=l[h];c.isMoved||g.copy(m.position);var b=(d=void 0,(d=n.scene)&&"v3d"in d.userData&&"coordSystem"in d.userData.v3d?d.userData.v3d.coordSystem:"Z_UP_RIGHT");if("X"==o||"Y"==o||"Z"==o){if("Z_UP_RIGHT"==b)var y="X"==o?e.AXIS_X:"Y"==o?e.AXIS_Z:e.AXIS_Y,_="X"==o?"x":"Y"==o?"z":"y";else y="X"==o?e.AXIS_X:"Y"==o?e.AXIS_Y:e.AXIS_Z,_="X"==o?"x":"Y"==o?"y":"z";(S=a.getWorldDirection(e.vec3Tmp)).cross(y).cross(y);var T=P(A=e.planeTmp.setFromNormalAndCoplanarPoint(S,u.position),c.downX,c.downY,e.vec3Tmp),O=P(A,c.currX,c.currY,e.vec3Tmp2);T&&O&&(m.position[_]=g[_]+O[_]-T[_])}else if("XY"==o||"XZ"==o||"YZ"==o){if("Z_UP_RIGHT"==b)var E="XY"==o?e.AXIS_Y:"XZ"==o?e.AXIS_Z:e.AXIS_X,w="XY"==o?"x":"XZ"==o?"x":"y",B="XY"==o?"z":"XZ"==o?"y":"z";else E="XY"==o?e.AXIS_Z:"XZ"==o?e.AXIS_Y:e.AXIS_X,w="XY"==o?"x":"XZ"==o?"x":"y",B="XY"==o?"y":"z";T=P(A=e.planeTmp.setFromNormalAndCoplanarPoint(E,u.position),c.downX,c.downY,e.vec3Tmp),O=P(A,c.currX,c.currY,e.vec3Tmp2),T&&O&&(m.position[w]=g[w]+O[w]-T[w],m.position[B]=g[B]+O[B]-T[B])}else if("XYZ"==o){var A,S=a.getWorldDirection(e.vec3Tmp);T=P(A=e.planeTmp.setFromNormalAndCoplanarPoint(S,u.position),c.downX,c.downY,e.vec3Tmp),O=P(A,c.currX,c.currY,e.vec3Tmp2),T&&O&&m.position.addVectors(g,O).sub(T)}m.updateMatrixWorld(!0)}}}}}}(t,"XY","?1BsHS%9;#@DGTpiI_gD","]v@c60@wY6_Vi]C!3A]p"),W(t)},function(){},"]v@c60@wY6_Vi]C!3A]p")}function U(e,n,t,o){for(var r=y(t,o),i=0;i<r.length;i++){var a=r[i];a&&("style"===e?a.setAttribute(e,n):("href"==e||"src"==e)&&n instanceof Promise?n.then(function(n){a[e]=n}):a[e]=n)}}function V(e){a=function(){return function(e){let n,t;return e&&"<none>"!=e?function(){let r=(n=e instanceof v3d.Object3D?e:o.scene.getObjectByName(e)).name+"_Box3";window.LIST_Box3s.forEach(e=>{e.name==r&&(t=e.userData.touchingObject)})}():console.log("Get Touching Object Puzzle needs an object!"),t}.apply(null,arguments)}(i),U("innerHTML",e?["Selected object ",i," is touching ",a].join(""):"Drag objects to touch.","readout_for_selected_object",!1),d=X("touching"),U("innerHTML","All touching objects: "+String(d),"readout_for_all_objects",!1)}function W(t){!function(t,o,r,i,a){function s(n,t,o){if(e.objMovementInfos[n])(r=e.objMovementInfos[n]).prevPosX=t.position.x,r.prevPosY=t.position.y,r.prevPosZ=t.position.z,r.prevRotX=t.rotation.x,r.prevRotY=t.rotation.y,r.prevRotZ=t.rotation.z,r.prevScaX=t.scale.x,r.prevScaY=t.scale.y,r.prevScaZ=t.scale.z,r.prevIsMoving=o;else{var r={prevPosX:t.position.x,prevPosY:t.position.y,prevPosZ:t.position.z,prevRotX:t.rotation.x,prevRotY:t.rotation.y,prevRotZ:t.rotation.z,prevScaX:t.scale.x,prevScaY:t.scale.y,prevScaZ:t.scale.z,prevIsMoving:o};e.objMovementInfos[n]=r}return r}function c(n,t,c){var u=e.objMovementInfos[n]||s(n,t,!1),d=o*c,l=Math.abs(t.position.x-u.prevPosX)>d||Math.abs(t.position.y-u.prevPosY)>d||Math.abs(t.position.z-u.prevPosZ)>d||Math.abs(t.rotation.x-u.prevRotX)>d||Math.abs(t.rotation.y-u.prevRotY)>d||Math.abs(t.rotation.z-u.prevRotZ)>d||Math.abs(t.scale.x-u.prevScaX)>d||Math.abs(t.scale.y-u.prevScaY)>d||Math.abs(t.scale.z-u.prevScaZ)>d;!u.prevIsMoving&&l?(r(n),s(n,t,!0)):u.prevIsMoving&&l?(i(n),s(n,t,!0)):u.prevIsMoving&&!l?(a(n),s(n,t,!1)):s(n,t,!1)}e.objMovementInfos=e.objMovementInfos||{},function(e){function t(n,t){for(var o=p(e),r=0;r<o.length;r++){var i=o[r],a=f(i);if(!a)return;c(i,a,n)}}n.renderCallbacks.push(t),v3d.PL.editorRenderCallbacks&&v3d.PL.editorRenderCallbacks.push([n,t])}(t)}(t,.01,function(){!function(){(function(e,n,t,r){!function(){let i,a,s,c=t,u=r,d=!1,l=[],v=(i=e instanceof v3d.Object3D?e:o.scene.getObjectByName(e)).name+"_Box3";if(window.LIST_Box3s.forEach(e=>{let n=o.scene.getObjectByName(e.id);e.copy(n.geometry.boundingBox).applyMatrix4(n.matrixWorld),e.name==v&&(a=e)}),Array.isArray(n))s=n,n=null,s.forEach(n=>{if(n!==e){!n instanceof v3d.Mesh&&(n=o.scene.getObjectByName(n));let e=n+"_Box3";window.LIST_Box3s.forEach(t=>{t.name==e&&(n=t,l.push(n))})}});else{let e=n+"_Box3";window.LIST_Box3s.forEach(t=>{t.name==e&&(n=t,l.push(n))})}function f(e){let n=l[e],t=a.userData.touchingObjects,o=a.intersectsBox(n);if(1==o){d=!0,a.userData.collision=!0,a.userData.touchingObject=n.id,a.userData.previousObjectTouched=n.id;let e=t.indexOf(n.id);return console.log("indexOf_object_in_touchingObjects_list",e),-1==e?t.push(n.id):e>-1&&t.splice(e,1),n.userData.collision=!0,n.userData.touchingObject=a.name.slice(0,-5),c(),d}if(0==o){a.userData.collision=!1,a.userData.touchingObject=null,n.userData.collision=!1,n.userData.touchingObject=null;let e=a.userData.touchingObjects,t=e.includes(n.id);console.log("object_in_touchingObjects_list",t),t||e.push(n.id),u()}}console.log("COLLISION SENSOR PLUGIN - LIST_otherObjsBox3:",l);for(let e=0;e<l.length;e++){let n=f(e);if(n)break}}()}).apply(null,arguments)}(t,r,function(){V(!0)},function(){V(!1)}),D()},function(){},function(){})}e.dragMoveOrigins={},e.objDragOverInfoGlobal=[],e.objDragOverInfoByBlock={},function(t,o,r,i){var a=n.renderer.domElement;if(a.addEventListener(o,l),v3d.PL.editorEventListeners&&v3d.PL.editorEventListeners.push([a,o,l]),"mousedown"==o){var s=r?"touchstart":"touchend";a.addEventListener(s,l),v3d.PL.editorEventListeners&&v3d.PL.editorEventListeners.push([a,s,l])}else if("dblclick"==o){var c=0;function u(e){var n=(new Date).getTime()-c;if(n<600&&n>0)return l(e),void(c=0);c=(new Date).getTime()}s=r?"touchstart":"touchend",a.addEventListener(s,u),v3d.PL.editorEventListeners&&v3d.PL.editorEventListeners.push([a,s,u])}var d=new v3d.Raycaster;function l(o){if(n.getCamera()){o.preventDefault();var r=0,s=0;if(o instanceof MouseEvent){if(i&&-1==i.indexOf(o.button))return;r=o.offsetX/a.clientWidth,s=o.offsetY/a.clientHeight}else if(o instanceof TouchEvent){var c=a.getBoundingClientRect();r=(o.changedTouches[0].clientX-c.left)/c.width,s=(o.changedTouches[0].clientY-c.top)/c.height}e.screenCoords.x=2*r-1,e.screenCoords.y=2*-s+1,d.setFromCamera(e.screenCoords,n.getCamera(!0));var u=[];n.scene.traverse(function(e){u.push(e)});var l=d.intersectObjects(u);t(l,o)}}}(function(n,t){e.objDragOverInfoGlobal.forEach(function(e){if(!(t instanceof MouseEvent&&-1==e.mouseButtons.indexOf(t.button)))for(var o=e.xRay?n.length:Math.min(1,n.length),r=0;r<o;r++){var i=k(n[r].object);G([e.objName],i)&&e.callback({downEvent:t,draggedObjName:i})}})},"mousedown",!0),b()}}();